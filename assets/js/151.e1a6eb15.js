(window.webpackJsonp=window.webpackJsonp||[]).push([[151],{496:function(s,t,a){"use strict";a.r(t);var e=a(2),r=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"nginx-反向代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-反向代理"}},[s._v("#")]),s._v(" Nginx-反向代理")]),s._v(" "),t("h2",{attrs:{id:"_1-nginx反向代理概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-nginx反向代理概述"}},[s._v("#")]),s._v(" 1. Nginx反向代理概述")]),s._v(" "),t("p",[s._v("关于正向代理和反向代理，我们在前面的章节已经通过一张图给大家详细的介绍过了，简而言之就是正向代理代理的对象是客户端，反向代理代理的是服务端，这是两者之间最大的区别。")]),s._v(" "),t("p",[s._v("Nginx即可以实现正向代理，也可以实现反向代理。")]),s._v(" "),t("p",[s._v("我们先来通过一个小案例演示下Nginx正向代理的简单应用。")]),s._v(" "),t("p",[s._v("先提需求：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/202303182013147.png",alt:"202303182013147"}})]),s._v(" "),t("p",[s._v("(1)服务端的设置：")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("http")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("  log_format")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("main 'client send request=>clientIp=$remote_addr serverIp=>$host';")]),s._v("\n\tserver{\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\t\tlisten")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("80;")]),s._v("\n\t\tserver_name\tlocalhost;\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\t\taccess_log")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("logs/access.log main;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\t\tlocation")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\t\t\troot")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("html;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\t\t\tindex")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("index.html index.htm;")]),s._v("\n\t\t}\n\t}\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("(2)使用客户端访问服务端，打开日志查看结果")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/202303182013653.png",alt:"202303182013653"}})]),s._v(" "),t("p",[s._v("(3)代理服务器设置：")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v(" 82;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        resolver")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("8.8.8.8;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("                proxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http://$host$request_uri;")]),s._v("\n        }\n    }\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("(4)查看代理服务器的IP(192.168.200.146)和Nginx配置监听的端口(82)")]),s._v(" "),t("p",[s._v("(5)在客户端配置代理服务器")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/202303182013299.png",alt:""}})]),s._v(" "),t("p",[s._v("(6)设置完成后，再次通过浏览器访问服务端")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/202303182013094.png",alt:"1589729479920"}})]),s._v(" "),t("p",[s._v("通过对比，上下两次的日志记录，会发现虽然我们是客户端访问服务端，但是如何使用了代理，那么服务端能看到的只是代理发送过去的请求，这样的化，就使用Nginx实现了正向代理的设置。")]),s._v(" "),t("p",[s._v("但是Nginx正向代理，在实际的应用中不是特别多，所以我们简单了解下，接下来我们继续学习Nginx的反向代理，这是Nginx比较重要的一个功能。")]),s._v(" "),t("h2",{attrs:{id:"_2-nginx反向代理的配置语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-nginx反向代理的配置语法"}},[s._v("#")]),s._v(" 2. Nginx反向代理的配置语法")]),s._v(" "),t("p",[s._v("Nginx反向代理模块的指令是由"),t("code",[s._v("ngx_http_proxy_module")]),s._v("模块进行解析，该模块在安装Nginx的时候已经自己加装到Nginx中了，接下来我们把反向代理中的常用指令一一介绍下：")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[s._v("proxy_pass\nproxy_set_header\nproxy_redirect\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"proxy-pass"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#proxy-pass"}},[s._v("#")]),s._v(" proxy_pass")]),s._v(" "),t("p",[s._v("该指令用来设置被代理服务器地址，可以是主机名称、IP地址加端口号形式。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("语法")]),s._v(" "),t("th",[s._v("proxy_pass URL;")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("—")])]),s._v(" "),t("tr",[t("td",[s._v("位置")]),s._v(" "),t("td",[s._v("location")])])])]),s._v(" "),t("p",[s._v("URL:为要设置的被代理服务器地址，包含传输协议("),t("code",[s._v("http")]),s._v(","),t("code",[s._v("https://")]),s._v(")、主机名称或IP地址加端口号、URI等要素。")]),s._v(" "),t("p",[s._v("举例：")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("proxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http://www.baidu.com;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/server{}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("proxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http://192.168.200.146;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("    http")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("//192.168.200.146/server/index.html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("proxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http://192.168.200.146/;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("    http")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("//192.168.200.146/index.html")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v('大家在编写proxy_pass的时候，后面的值要不要加"/"?')]),s._v(" "),t("p",[s._v("接下来通过例子来说明刚才我们提到的问题：")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\tlisten")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("80;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\tserver_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("localhost;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\tlocation")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\t\t#proxy_pass http://192.168.200.146;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\t\tproxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http://192.168.200.146/;")]),s._v("\n\t}\n}\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("当客户端访问")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http://localhost/index.html,效果是一样的")]),s._v("\nserver{\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\tlisten")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("80;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\tserver_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("localhost;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\tlocation")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/server{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\t\t#proxy_pass http://192.168.200.146;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\t\tproxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http://192.168.200.146/;")]),s._v("\n\t}\n}\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("当客户端访问")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http://localhost/server/index.html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("这个时候，第一个proxy_pass就变成了http")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("//localhost/server/index.html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("第二个proxy_pass就变成了http")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("//localhost/index.html效果就不一样了。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("h3",{attrs:{id:"proxy-set-header"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#proxy-set-header"}},[s._v("#")]),s._v(" proxy_set_header")]),s._v(" "),t("p",[s._v("该指令可以更改Nginx服务器接收到的客户端请求的请求头信息，然后将新的请求头发送给代理的服务器")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("语法")]),s._v(" "),t("th",[s._v("proxy_set_header field value;")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("proxy_set_header Host $proxy_host;"),t("br"),s._v("proxy_set_header Connection close;")])]),s._v(" "),t("tr",[t("td",[s._v("位置")]),s._v(" "),t("td",[s._v("http、server、location")])])])]),s._v(" "),t("p",[s._v("需要注意的是，如果想要看到结果，必须在被代理的服务器上来获取添加的头信息。")]),s._v(" "),t("p",[s._v("被代理服务器： [192.168.200.146]")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v(" 8080;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        server_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("localhost;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        default_type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("text/plain;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("200 $http_username;")]),s._v("\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("代理服务器: [192.168.200.133]")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v(" 8080;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        server_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("localhost;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/server {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("                proxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http://192.168.200.146:8080/;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("                proxy_set_header")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("username TOM;")]),s._v("\n        }\n    }\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("访问测试")]),s._v(" "),t("h3",{attrs:{id:"proxy-redirect"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#proxy-redirect"}},[s._v("#")]),s._v(" proxy_redirect")]),s._v(" "),t("p",[s._v('该指令是用来重置头信息中的"Location"和"Refresh"的值。')]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("语法")]),s._v(" "),t("th",[s._v("proxy_redirect redirect replacement;"),t("br"),s._v("proxy_redirect default;"),t("br"),s._v("proxy_redirect off;")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("proxy_redirect default;")])]),s._v(" "),t("tr",[t("td",[s._v("位置")]),s._v(" "),t("td",[s._v("http、server、location")])])])]),s._v(" "),t("p",[s._v("》为什么要用该指令?")]),s._v(" "),t("p",[s._v("服务端[192.168.200.146]")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("    listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v(" 8081;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("    server_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("localhost;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("    if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("(!-f $request_filename){")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("    \treturn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("302 http://192.168.200.146;")]),s._v("\n    }\n}\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("代理服务端[192.168.200.133]")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\tlisten")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v(" 8081;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\tserver_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("localhost;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\tlocation")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/ {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\t\tproxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http://192.168.200.146:8081/;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\t\tproxy_redirect")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http://192.168.200.146 http://192.168.200.133;")]),s._v("\n\t}\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("》该指令的几组选项")]),s._v(" "),t("p",[s._v("proxy_redirect redirect replacement;")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("redirect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("目标,Location的值")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("replacement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("要替换的值")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("proxy_redirect default;")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[s._v("default;\n将location块的uri变量作为replacement,\n将proxy_pass变量作为redirect进行替换\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("proxy_redirect off;")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[s._v("关闭proxy_redirect的功能\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"_3-nginx反向代理实战"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-nginx反向代理实战"}},[s._v("#")]),s._v(" 3. Nginx反向代理实战")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/202303182014440.png",alt:"1581883378672"}})]),s._v(" "),t("p",[s._v("服务器1,2,3存在两种情况")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("第一种情况")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("三台服务器的内容不一样。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("第二种情况")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("三台服务器的内容是一样。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",[t("li",[s._v("如果服务器1、服务器2和服务器3的内容不一样，那我们可以根据用户请求来分发到不同的服务器。")])]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[s._v("代理服务器\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("         8082;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        server_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("    localhost;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/server1 {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("                proxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http://192.168.200.146:9001/;")]),s._v("\n        }\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/server2 {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("                proxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http://192.168.200.146:9002/;")]),s._v("\n        }\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/server3 {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("                proxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http://192.168.200.146:9003/;")]),s._v("\n        }\n}\n\n服务端\nserver1\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("         9001;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        server_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("    localhost;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        default_type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("text/html;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("200 '<h1>192.168.200.146:9001</h1>'")]),s._v("\n}\nserver2\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("         9002;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        server_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("    localhost;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        default_type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("text/html;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("200 '<h1>192.168.200.146:9002</h1>'")]),s._v("\n}\nserver3\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("         9003;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        server_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("    localhost;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        default_type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("text/html;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("200 '<h1>192.168.200.146:9003</h1>'")]),s._v("\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("如果服务器1、服务器2和服务器3的内容是一样的，该如何处理?")])]),s._v(" "),t("h2",{attrs:{id:"_4-nginx的安全控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-nginx的安全控制"}},[s._v("#")]),s._v(" 4. Nginx的安全控制")]),s._v(" "),t("p",[s._v("关于web服务器的安全是比较大的一个话题，里面所涉及的内容很多，Nginx反向代理是如何来提升web服务器的安全呢？")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[s._v("安全隔离\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("什么是安全隔离?")]),s._v(" "),t("p",[s._v("通过代理分开了客户端到应用程序服务器端的连接，实现了安全措施。在反向代理之前设置防火墙，仅留一个入口供代理服务器访问。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/202303182014621.png",alt:"1589908851340"}})]),s._v(" "),t("h3",{attrs:{id:"如何使用ssl对流量进行加密"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何使用ssl对流量进行加密"}},[s._v("#")]),s._v(" 如何使用SSL对流量进行加密")]),s._v(" "),t("p",[s._v("翻译成大家能熟悉的说法就是将我们常用的http请求转变成https请求，那么这两个之间的区别简单的来说两个都是HTTP协议，只不过https是身披SSL外壳的http.")]),s._v(" "),t("p",[s._v("HTTPS是一种通过计算机网络进行安全通信的传输协议。它经由HTTP进行通信，利用SSL/TLS建立全通信，加密数据包，确保数据的安全性。")]),s._v(" "),t("p",[s._v("SSL(Secure Sockets Layer)安全套接层")]),s._v(" "),t("p",[s._v("TLS(Transport Layer Security)传输层安全")]),s._v(" "),t("p",[s._v("上述这两个是为网络通信提供安全及数据完整性的一种安全协议，TLS和SSL在传输层和应用层对网络连接进行加密。")]),s._v(" "),t("p",[s._v("总结来说为什么要使用https:")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[s._v("http协议是明文传输数据，存在安全问题，而https是加密传输，相当于http+ssl，并且可以防止流量劫持。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("Nginx要想使用SSL，需要满足一个条件即需要添加一个模块"),t("code",[s._v("--with-http_ssl_module")]),s._v(",而该模块在编译的过程中又需要OpenSSL的支持，这个我们之前已经准备好了。")]),s._v(" "),t("h4",{attrs:{id:"nginx添加ssl的支持"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx添加ssl的支持"}},[s._v("#")]),s._v(" nginx添加SSL的支持")]),s._v(" "),t("p",[s._v("（1）完成 "),t("code",[s._v("--with-http_ssl_module")]),s._v("模块的增量添加")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[s._v("》将原有/usr/local/nginx/sbin/nginx进行备份\n》拷贝nginx之前的配置信息\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("》在nginx的安装源码进行配置指定对应模块")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v(" ./configure --with-http_ssl_module")]),s._v("\n》通过make模板进行编译\n》将objs下面的nginx移动到/usr/local/nginx/sbin下\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("》在源码目录下执行")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v(" make upgrade进行升级，这个可以实现不停机添加新模块的功能")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("Nginx的SSL相关指令")]),s._v(" "),t("p",[s._v("因为刚才我们介绍过该模块的指令都是通过ngx_http_ssl_module模块来解析的。")]),s._v(" "),t("p",[s._v("》ssl:该指令用来在指定的服务器开启HTTPS,可以使用 listen 443 ssl,后面这种方式更通用些。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("语法")]),s._v(" "),t("th",[s._v("ssl on | off;")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("ssl off;")])]),s._v(" "),t("tr",[t("td",[s._v("位置")]),s._v(" "),t("td",[s._v("http、server")])])])]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[s._v("server{\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("\tlisten")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("443 ssl;")]),s._v("\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("》ssl_certificate:为当前这个虚拟主机指定一个带有PEM格式证书的证书。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("语法")]),s._v(" "),t("th",[s._v("ssl_certificate file;")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("—")])]),s._v(" "),t("tr",[t("td",[s._v("位置")]),s._v(" "),t("td",[s._v("http、server")])])])]),s._v(" "),t("p",[s._v("》ssl_certificate_key:该指令用来指定PEM secret key文件的路径")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("语法")]),s._v(" "),t("th",[s._v("ssl_ceritificate_key file;")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("—")])]),s._v(" "),t("tr",[t("td",[s._v("位置")]),s._v(" "),t("td",[s._v("http、server")])])])]),s._v(" "),t("p",[s._v("》ssl_session_cache:该指令用来配置用于SSL会话的缓存")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("语法")]),s._v(" "),t("th",[s._v("ssl_sesion_cache off|none|[builtin[:size]] [shared:name:size]")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("ssl_session_cache none;")])]),s._v(" "),t("tr",[t("td",[s._v("位置")]),s._v(" "),t("td",[s._v("http、server")])])])]),s._v(" "),t("p",[s._v("off:禁用会话缓存，客户端不得重复使用会话")]),s._v(" "),t("p",[s._v("none:禁止使用会话缓存，客户端可以重复使用，但是并没有在缓存中存储会话参数")]),s._v(" "),t("p",[s._v("builtin:内置OpenSSL缓存，仅在一个工作进程中使用。")]),s._v(" "),t("p",[s._v("shared:所有工作进程之间共享缓存，缓存的相关信息用name和size来指定")]),s._v(" "),t("p",[s._v("》ssl_session_timeout：开启SSL会话功能后，设置客户端能够反复使用储存在缓存中的会话参数时间。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("语法")]),s._v(" "),t("th",[s._v("ssl_session_timeout time;")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("ssl_session_timeout 5m;")])]),s._v(" "),t("tr",[t("td",[s._v("位置")]),s._v(" "),t("td",[s._v("http、server")])])])]),s._v(" "),t("p",[s._v("》ssl_ciphers:指出允许的密码，密码指定为OpenSSL支持的格式")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("语法")]),s._v(" "),t("th",[s._v("ssl_ciphers ciphers;")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("ssl_ciphers HIGH:!aNULL:!MD5;")])]),s._v(" "),t("tr",[t("td",[s._v("位置")]),s._v(" "),t("td",[s._v("http、server")])])])]),s._v(" "),t("p",[s._v("可以使用"),t("code",[s._v("openssl ciphers")]),s._v("查看openssl支持的格式。")]),s._v(" "),t("p",[s._v("》ssl_prefer_server_ciphers：该指令指定是否服务器密码优先客户端密码")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("语法")]),s._v(" "),t("th",[s._v("ssl_perfer_server_ciphers on|off;")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("ssl_perfer_server_ciphers off;")])]),s._v(" "),t("tr",[t("td",[s._v("位置")]),s._v(" "),t("td",[s._v("http、server")])])])]),s._v(" "),t("h5",{attrs:{id:"生成证书"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成证书"}},[s._v("#")]),s._v(" 生成证书")]),s._v(" "),t("p",[s._v("方式一：使用阿里云/腾讯云等第三方服务进行购买。")]),s._v(" "),t("p",[s._v("方式二:使用openssl生成证书")]),s._v(" "),t("p",[s._v("先要确认当前系统是否有安装openssl")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("openssl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("version")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("安装下面的命令进行生成")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/root/cert")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/root/cert")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("openssl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("genrsa -des3 -out server.key 1024")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("openssl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("req -new -key server.key -out server.csr")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("cp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("server.key server.key.org")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("openssl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("rsa -in server.key.org -out server.key")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("openssl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("x509 -req -days 365 -in server.csr -signkey server.key -out server.crt")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h5",{attrs:{id:"开启ssl实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启ssl实例"}},[s._v("#")]),s._v(" 开启SSL实例")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("    listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("      443 ssl;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("    server_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v(" localhost;")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("    ssl_certificate")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("     server.cert;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("    ssl_certificate_key")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v(" server.key;")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("    ssl_session_cache")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("   shared:SSL:1m;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("    ssl_session_timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v(" 5m;")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("    ssl_ciphers")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v(" HIGH:!aNULL:!MD5;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("    ssl_prefer_server_ciphers")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v(" on;")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("    location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/ {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        root")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("  html;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("        index")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v(" index.html index.htm;")]),s._v("\n    }\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("（4）验证")]),s._v(" "),t("h2",{attrs:{id:"_5-反向代理系统调优"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-反向代理系统调优"}},[s._v("#")]),s._v(" 5. 反向代理系统调优")]),s._v(" "),t("p",[s._v("反向代理值Buffer和Cache")]),s._v(" "),t("p",[s._v('Buffer翻译过来是"缓冲"，Cache翻译过来是"缓存"。')]),s._v(" "),t("p",[t("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/202303182014739.png",alt:"1581879638569"}})]),s._v(" "),t("p",[s._v("总结下：")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("相同点")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n两种方式都是用来提供IO吞吐效率，都是用来提升Nginx代理的性能。\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("不同点")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n缓冲主要用来解决不同设备之间数据传递速度不一致导致的性能低的问题，缓冲中的数据一旦此次操作完成后，就可以删除。\n缓存主要是备份，将被代理服务器的数据缓存一份到代理服务器，这样的话，客户端再次获取相同数据的时候，就只需要从代理服务器上获取，效率较高，缓存中的数据可以重复使用，只有满足特定条件才会删除.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("（1）Proxy Buffer相关指令")]),s._v(" "),t("p",[s._v("》proxy_buffering :该指令用来开启或者关闭代理服务器的缓冲区；")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("语法")]),s._v(" "),t("th",[s._v("proxy_buffering on|off;")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("proxy_buffering on;")])]),s._v(" "),t("tr",[t("td",[s._v("位置")]),s._v(" "),t("td",[s._v("http、server、location")])])])]),s._v(" "),t("p",[s._v("》proxy_buffers:该指令用来指定单个连接从代理服务器读取响应的缓存区的个数和大小。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("语法")]),s._v(" "),t("th",[s._v("proxy_buffers number size;")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("proxy_buffers 8 4k | 8K;(与系统平台有关)")])]),s._v(" "),t("tr",[t("td",[s._v("位置")]),s._v(" "),t("td",[s._v("http、server、location")])])])]),s._v(" "),t("p",[s._v("number:缓冲区的个数")]),s._v(" "),t("p",[s._v("size:每个缓冲区的大小，缓冲区的总大小就是number*size")]),s._v(" "),t("p",[s._v("》proxy_buffer_size:该指令用来设置从被代理服务器获取的第一部分响应数据的大小。保持与proxy_buffers中的size一致即可，当然也可以更小。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("语法")]),s._v(" "),t("th",[s._v("proxy_buffer_size size;")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("proxy_buffer_size 4k | 8k;(与系统平台有关)")])]),s._v(" "),t("tr",[t("td",[s._v("位置")]),s._v(" "),t("td",[s._v("http、server、location")])])])]),s._v(" "),t("p",[s._v("》proxy_busy_buffers_size：该指令用来限制同时处于BUSY状态的缓冲总大小。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("语法")]),s._v(" "),t("th",[s._v("proxy_busy_buffers_size size;")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("proxy_busy_buffers_size 8k|16K;")])]),s._v(" "),t("tr",[t("td",[s._v("位置")]),s._v(" "),t("td",[s._v("http、server、location")])])])]),s._v(" "),t("p",[s._v("》proxy_temp_path:当缓冲区存满后，仍未被Nginx服务器完全接受，响应数据就会被临时存放在磁盘文件上，该指令设置文件路径")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("语法")]),s._v(" "),t("th",[s._v("proxy_temp_path  path;")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("proxy_temp_path proxy_temp;")])]),s._v(" "),t("tr",[t("td",[s._v("位置")]),s._v(" "),t("td",[s._v("http、server、location")])])])]),s._v(" "),t("p",[s._v("注意path最多设置三层。")]),s._v(" "),t("p",[s._v("》proxy_temp_file_write_size：该指令用来设置磁盘上缓冲文件的大小。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("语法")]),s._v(" "),t("th",[s._v("proxy_temp_file_write_size size;")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("默认值")]),s._v(" "),t("td",[s._v("proxy_temp_file_write_size 8K|16K;")])]),s._v(" "),t("tr",[t("td",[s._v("位置")]),s._v(" "),t("td",[s._v("http、server、location")])])])]),s._v(" "),t("p",[s._v("通用网站的配置")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("proxy_buffering")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("on;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("proxy_buffer_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("4 32k;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("proxy_busy_buffers_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("64k;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("proxy_temp_file_write_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("64k;")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("根据项目的具体内容进行相应的调节。")])])}),[],!1,null,null,null);t.default=r.exports}}]);