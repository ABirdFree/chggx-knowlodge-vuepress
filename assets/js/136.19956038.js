(window.webpackJsonp=window.webpackJsonp||[]).push([[136],{484:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"springcloud-h-网关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#springcloud-h-网关"}},[t._v("#")]),t._v(" SpringCloud.H-网关")]),t._v(" "),s("blockquote",[s("p",[t._v("笔记日期：2020.5.20")])]),t._v(" "),s("h2",{attrs:{id:"_1-zuul"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-zuul"}},[t._v("#")]),t._v(" 1. Zuul")]),t._v(" "),s("p",[t._v("停更 (netflix)")]),t._v(" "),s("h2",{attrs:{id:"_2-gateway"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-gateway"}},[t._v("#")]),t._v(" 2. gateway")]),t._v(" "),s("p",[t._v("spring(自己)")]),t._v(" "),s("p",[t._v("https://blog.csdn.net/qq_41211642/article/details/104873418")]),t._v(" "),s("h3",{attrs:{id:"_1-概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-概述"}},[t._v("#")]),t._v(" 1.概述")]),t._v(" "),s("h4",{attrs:{id:"_1-介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-介绍"}},[t._v("#")]),t._v(" 1. 介绍")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("官网:  https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/")])]),t._v(" "),s("li",[s("p",[t._v("Cloud 全家桶中有个很重要的组件就是网关，在1.x版本中都是采用的Zuul网关；但在2.x版本中，zuul的升级一直跳票，SpringCloud最后自己研发了一个网关替代Zuul，那就是Spring Cloud Gateway")])]),t._v(" "),s("li",[s("p",[t._v("Gateway是在Spring 生态系统之上构建的API网关服务，基于"),s("strong",[t._v("Spring 5，SpringBoot 2和Project Reactor等技术")]),t._v("。Gateway旨在提供一种简单而有效的方式来对API进行路由，以及提供一些强大的过滤器功能，例如："),s("strong",[t._v("熔断、限流、重试")]),t._v("等。")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/gateway%E5%A5%BD%E5%A4%84.png?x-oss-process=style/shuiyin_1",alt:""}})]),t._v(" "),s("p",[t._v("总结: "),s("strong",[t._v("Spring Cloud Gateway 使用的Webflux中的reactor-netty响应式编程组件,底层使用了Netty通讯框架.")]),t._v("(利于高并发,"),s("code",[t._v("非阻塞式,响应式编程高性能的框架")]),t._v(")")]),t._v(" "),s("h4",{attrs:{id:"_2-能干什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-能干什么"}},[t._v("#")]),t._v(" 2. 能干什么?")]),t._v(" "),s("p",[s("strong",[t._v("功能：")])]),t._v(" "),s("ul",[s("li",[t._v("反向代理")]),t._v(" "),s("li",[t._v("鉴权")]),t._v(" "),s("li",[t._v("流量控制")]),t._v(" "),s("li",[t._v("熔断")]),t._v(" "),s("li",[t._v("日志监控。。。")])]),t._v(" "),s("h4",{attrs:{id:"_3-微服务架构中网关在哪里"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-微服务架构中网关在哪里"}},[t._v("#")]),t._v(" 3. 微服务架构中网关在哪里?")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155257.png",alt:""}})]),t._v(" "),s("h4",{attrs:{id:"_4-为什么选择gateway"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-为什么选择gateway"}},[t._v("#")]),t._v(" 4.  为什么选择Gateway")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("netflix不太靠谱，zuul 2.0一直跳票，迟迟不发布")]),t._v(" "),s("ul",[s("li",[t._v("一方面因为Zuul 1.0已经进入了维护阶段，而且Gateway是SpringCloud团队研发的，值得信赖。而且很多功能Zuul都没有用起来也非常的简单便捷。")]),t._v(" "),s("li",[t._v("Gateway是基于异步非阻塞模型上进行开发的，性能方面不需要担心。虽然Netflix早就发布了最新的Zuul 2.x，但SpringCloud貌似没有整合计划。而且Netflix相关组件都宣布进入维护期。")]),t._v(" "),s("li",[t._v("多方面综合考虑"),s("strong",[t._v("Gateway")]),t._v("是很理想的网关选择.")])])]),t._v(" "),s("li",[s("p",[t._v("SpringCloud Gateway具有如下特性")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("基于Spring Framework 5，Project Reactor和Spring Boot 2.0构建")])]),t._v(" "),s("li",[s("strong",[t._v("动态路由")]),t._v("：能够匹配任何请求属性")]),t._v(" "),s("li",[t._v("可以对路由指定 Predicate（断言）和Filter（过滤器）")]),t._v(" "),s("li",[t._v("集成Hystrix的断路器功能")]),t._v(" "),s("li",[t._v("集成Spring Cloud 的服务发现功能")]),t._v(" "),s("li",[t._v("易于编写的Predicate（断言）和Filter（过滤器）")]),t._v(" "),s("li",[t._v("请求限流功能")]),t._v(" "),s("li",[t._v("支持路径重写")])])]),t._v(" "),s("li",[s("p",[t._v("SpringCloud Gateway 与 zuul 的区别")]),t._v(" "),s("p",[t._v("在SpringCloud Finchley 正式版之前，SpringCloud推荐的网关是Netflix提供的Zuul：")]),t._v(" "),s("ul",[s("li",[t._v("Zuul 1.x是一个基于阻塞 I/O 的API Gateway")]),t._v(" "),s("li",[t._v("Zuul 1.x基于servlet 2.5使用阻塞架构它不支持任何长连接（如websocket）Zuul的设计模式和Nginx较像，每次I/O 操作都是从工作线程中选择一个执行，请求线程被阻塞到工作线程完成，但是差别是Nginx用C++实现，Zuul用Java实现，而JVM本身会有一次加载较慢的情况，使得zuul的性能相对较差")]),t._v(" "),s("li",[t._v("Zuul 2.x理念更先进，向基于Netty非阻塞和支持长连接，但SpringCloud目前还没有整合。Zuul 2.x的性能较Zuul 1.x有较大提升。在性能方面，根据官方提供的基准测试，SpringCloud Gateway的RPS（每秒请求数）是Zuul的1.6倍")]),t._v(" "),s("li",[t._v("SpringCloud Gateway建立在Spring Framework5、Project Reactor和Spring Boot 2之上，使用非阻塞API")]),t._v(" "),s("li",[t._v("SpringCloud Gateway还支持WebSocket，并且与Spring紧密集成用于更好的开发体验")])])]),t._v(" "),s("li",[s("p",[t._v("Gateway模型")]),t._v(" "),s("p",[t._v("Gateway支持 "),s("strong",[t._v("Reactor")]),t._v(" 和 "),s("strong",[t._v("WebFlux")])]),t._v(" "),s("p",[t._v("传统的Web框架，比如说：struts2，springmvc等都是基于Servlet API与servlet容器基础之上运行的。\n但是Servlet3.1之后有了异步非阻塞的支持，而WebFlux是一个典型非阻塞异步的框架，它的核心是基于Reactor的相关API实现的。相对与传统的Web框架来说，它可以运行在诸如Netty，Undertow及支持Servlet3.1的容器上。"),s("strong",[t._v("非阻塞式+函数式编程")])]),t._v(" "),s("p",[t._v("Spring WebFlux 是 Spring 5.0引入的新的响应式框架，区别于Spring MVC，它不需要依赖Servlet API，它是完全异步非阻塞的，并且基于 Reactor 来实现响应式流规范")])]),t._v(" "),s("li",[s("p",[t._v("zuul 1.x模型")]),t._v(" "),s("p",[t._v("SpringCloud中所集成的Zuul版本，采用的是Tomcat容器，使用的是传统的Servlet IO处理模型。")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Servlet生命周期？\nservlet 由 servlet container 进行生命周期管理\ncontainer 启动时构造 servlet 对象并调用 servlet init() 进行初始化；\ncontainer 运行时接受请求，并为每个请求分配一个线程（一般从线程池中获取空闲线程）然后调用service()；\ncontainer 关闭时调用 servlet destory() 销毁servlet；")])]),t._v(" "),s("li",[s("p",[t._v("上述模式的缺点：\nservlet是一个简单的网络IO模型，当请求进入servlet container时，servlet container就会为其绑定一个线程，在并发不高的场景下这种模型是适用的。但是一旦高并发（比如用jmeter压测），线程数量就会涨，而线程资源代价是昂贵的（上下文切换，内存消耗大）严重影响请求的处理时间。在一些简单业务场景下，不希望为每个request分配一个线程，只需要1个或几个线程就能应对极大并发的请求，这种业务场景下servlet模型没有优势")]),t._v(" "),s("p",[t._v("所以Zuul 1.x是基于servlet之上的一个阻塞式处理模型，即spring实现了处理所有request请求的一个servlet（DispatcherServlet）并由该servlet阻塞式处理。所以SpringCloud Zuul无法摆脱servlet模型的弊端。")])])])])]),t._v(" "),s("h3",{attrs:{id:"_2-gateway-核心概念及工作流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-gateway-核心概念及工作流程"}},[t._v("#")]),t._v(" 2. Gateway 核心概念及工作流程")]),t._v(" "),s("h4",{attrs:{id:"_1-核心概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-核心概念"}},[t._v("#")]),t._v(" 1. 核心概念")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Route(路由)：路由是构建网关的基本模块，它由ID、目标URI，一系列的断言和过滤器组成，如果断言为true则匹配该路由")])]),t._v(" "),s("li",[s("p",[t._v("Predicate(断言)：参考的是Java8的java.util.function.Predicate\n开发人员可以匹配HTTP请求中的所有内容(例如请求头或请求参数)，如果请求与断言相匹配则进行路由")])]),t._v(" "),s("li",[s("p",[t._v("Filter(过滤)：指的是Spring框架中GatewayFilyter的实例，使用过滤器，可以在请求被路由前或者之后进行修改")])])]),t._v(" "),s("p",[t._v("匹配方式就叫断言，实现这个匹配方式就叫filter，对外表现出来就是路由的功能。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155309.png",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("web 请求，通过一些匹配条件，定位到真正的服务节点。并在这个转发过程的前后，进行一些精细化控制。")]),t._v(" "),s("li",[t._v("predicate 就是我们的匹配条件，而filter，就可以理解为一个无所不能的拦截器。有了这两个元素再加上目标uri，就可以实现一个具体的路由。")])]),t._v(" "),s("h4",{attrs:{id:"_2-gateway工作流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-gateway工作流程"}},[t._v("#")]),t._v(" 2. gateway工作流程")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155317.png",alt:""}})]),t._v(" "),s("ul",[s("li",[s("p",[t._v("客户端向Spring Cloud Gateway发出请求。然后在Gateway Handler Mapping中找到与请求相匹配的路由，将其发送到Gateway Web Handler。")])]),t._v(" "),s("li",[s("p",[t._v("Handler再通过指定的过滤器链来讲请求发送到我们实际的服务执行业务逻辑，然后返回。")])]),t._v(" "),s("li",[s("p",[t._v("过滤器之间用虚线分开是因为过滤器可能会在发送代理请求之前（“pre”）或之后（“post”）执行业务逻辑")])]),t._v(" "),s("li",[s("p",[t._v("Filter 在 “pre” 类型的过滤器可以做参数校验、权限校验、流量监控、日志输出、协议转换等；在 “post” 类型的过滤器中可以做响应内容、响应头的修改，日志的输出，流量监控等，有着非常重要的作用")])])]),t._v(" "),s("p",[t._v("核心逻辑 ：路由转发 + 执行过滤器链")]),t._v(" "),s("h2",{attrs:{id:"_3-编码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-编码"}},[t._v("#")]),t._v(" 3. 编码")]),t._v(" "),s("p",[t._v("https://blog.csdn.net/qq_41211642/article/details/104874932")]),t._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--gateway--\x3e")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-starter-gateway"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("ul",[s("li",[t._v("配置文件")])]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9527")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cloud"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 网关配置")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" payment_routh "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#payment_routh    #路由的ID，没有固定规则但要求唯一，简易配合服务名")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8001")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#匹配后提供服务的路由地址")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Path=/payment/get/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("**")]),t._v("          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#断言，路径相匹配的进行路由")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" payment_routh2 "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#payment_routh   #路由的ID，没有固定规则但要求唯一，简易配合服务名")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8001")]),t._v("          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#匹配后提供服务的路由地址")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Path=/payment/lb/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("**")]),t._v("             "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#断言，路径相匹配的进行路由")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cloud"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("register-with-eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fetch-registry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//eureka7001.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7001/eureka\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155328.png",alt:""}})]),t._v(" "),s("p",[t._v("效果")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155334.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155347.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"_4-gateway网关路由有两种配置方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-gateway网关路由有两种配置方式"}},[t._v("#")]),t._v(" 4. Gateway网关路由有两种配置方式")]),t._v(" "),s("p",[t._v("https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#route-metadata-configuration")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155357.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"方式一"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方式一"}},[t._v("#")]),t._v(" 方式一")]),t._v(" "),s("p",[t._v("3中的方式: 在配置文件yml 中配置")]),t._v(" "),s("h3",{attrs:{id:"方式二"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方式二"}},[t._v("#")]),t._v(" 方式二")]),t._v(" "),s("p",[t._v("代码中注入RouteLocator 的Bean")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GatewayConfig")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 通过访问 http://localhost:9527/guonei 来访问 http://news.baidu.com/guonei\n     * 通过路由 百度百度网站\n     * http://news.baidu.com/guonei\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RouteLocator")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("customRouteLocator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RouteLocatorBuilder")]),t._v(" builder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RouteLocatorBuilder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Builder")]),t._v(" routes "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" builder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        routes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path_route_chggx"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                r "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" r"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/**"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://news.baidu.com/guonei"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" routes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br")])]),s("p",[t._v("效果")]),t._v(" "),s("p",[t._v("http://localhost:9527/guonei")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155409.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"_5-动态路由"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-动态路由"}},[t._v("#")]),t._v(" 5. 动态路由")]),t._v(" "),s("h3",{attrs:{id:"_1-为什么使用动态路由"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-为什么使用动态路由"}},[t._v("#")]),t._v(" 1. 为什么使用动态路由?")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155426.png",alt:""}})]),t._v(" "),s("p",[t._v("之前访问的路由地址我们是写死的，在微服务架构中，微服务提供者不可能只有一台服务器，就需要动态路由")]),t._v(" "),s("h3",{attrs:{id:"_2-使用思路"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用思路"}},[t._v("#")]),t._v(" 2. 使用思路")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155419.png",alt:""}})]),t._v(" "),s("ul",[s("li",[s("p",[t._v("之前80客户端发送请求访问8001/8002，通过ribbon负载均衡，将请求分散，现在服务提供者如果是多台，就需要将ribbon替换为gateway，只暴露gateway，客户端请求统一发到gateway，gateway将请求转发给8001/8002。")])]),t._v(" "),s("li",[s("p",[t._v("默认情况下Gateway会根据注册中心注册的服务列表，以注册中心上微服务名为路径创建动态路由进行转发，从而实现动态路由的功能。")])]),t._v(" "),s("li",[s("p",[t._v("现在启动一个eureka7001，两个服务提供者8001/8002")])])]),t._v(" "),s("h3",{attrs:{id:"_3-编码-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-编码-2"}},[t._v("#")]),t._v(" 3. 编码")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("修改配置文件")]),t._v(" "),s("ul",[s("li",[t._v("开启从注册中心动态创建路由的功能,利用微服务名进行路由")]),t._v(" "),s("li",[t._v('使用"lb"动态匹配路由地址')])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155440.png",alt:""}})])])]),t._v(" "),s("p",[t._v("访问 测试")]),t._v(" "),s("p",[t._v("http://localhost:9527/payment/get/1")]),t._v(" "),s("p",[t._v("8001/8002 切换访问")]),t._v(" "),s("h2",{attrs:{id:"_6-predicate"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-predicate"}},[t._v("#")]),t._v(" 6. Predicate")]),t._v(" "),s("p",[t._v("https://blog.csdn.net/qq_41211642/article/details/104879278")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155449.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_0-求时区时间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0-求时区时间"}},[t._v("#")]),t._v(" 0. 求时区时间")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("T2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 默认时区")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ZonedDateTime")]),t._v(" zbj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ZonedDateTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2020-04-02T10:32:44.384+08:00[Asia/Shanghai]")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zbj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用于制定时区获取当前时间")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//        ZonedDateTime zny = ZonedDateTime.now(ZoneId.of("America/New_york"));')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//        System.out.println(zny);")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br")])]),s("h3",{attrs:{id:"_1-after-时间类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-after-时间类型"}},[t._v("#")]),t._v(" 1. After  "),s("sup",[t._v("时间类型")])]),t._v(" "),s("p",[t._v("https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155457.png",alt:""}})]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cloud"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 网关配置")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("discovery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("locator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启从注册中心动态创建路由的功能,利用微服务名进行路由(默认false)")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" payment_routh "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#payment_routh    #路由的ID，没有固定规则但要求唯一，简易配合服务名")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#          uri: http://localhost:8001         #匹配后提供服务的路由地址")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" lb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//cloud"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("payment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 匹配后动态提供服务的路由地址")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Path=/payment/get/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("**")]),t._v("          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#断言，路径相匹配的进行路由")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" payment_routh2 "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#payment_routh   #路由的ID，没有固定规则但要求唯一，简易配合服务名")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#          uri: http://localhost:8001          #匹配后提供服务的路由地址")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" lb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//cloud"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("payment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 匹配后动态提供服务的路由地址")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Path=/payment/lb/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("**")]),t._v("             "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#断言，路径相匹配的进行路由")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" After=2020"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("04"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("02T10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("32"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("44.384+08"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("00"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Asia/Shanghai"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br")])]),s("ul",[s("li",[t._v('调节时间,只有当前时间在"设置时间之后"才能正常访问')])]),t._v(" "),s("h3",{attrs:{id:"_2-before-时间类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-before-时间类型"}},[t._v("#")]),t._v(" 2. Before  "),s("sup",[t._v("时间类型")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155509.png",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v('调节时间,只有当前时间在"设置时间之前"才能正常访问')])]),t._v(" "),s("h3",{attrs:{id:"_3-between-时间类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-between-时间类型"}},[t._v("#")]),t._v(" 3. Between  "),s("sup",[t._v("时间类型")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155516.png",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v('调节时间,只有当前时间在"设置时间之内"才能正常访问')])]),t._v(" "),s("h3",{attrs:{id:"_4-cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-cookie"}},[t._v("#")]),t._v(" 4. Cookie")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155527.png",alt:""}})]),t._v(" "),s("p",[t._v("Cookie Route Predicate: 需要两个参数, ==(Cookie Name,正则表达式)==")]),t._v(" "),s("p",[t._v("路由规则会通过获取对应的Cookie Name值和正则表达式去匹配,如果匹配上就会执行路由,如果没有匹配上则不执行")]),t._v(" "),s("h5",{attrs:{id:"_1-yml配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-yml配置"}},[t._v("#")]),t._v(" 1.  yml配置")]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Path=/payment/lb/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("**")]),t._v("             "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#断言，路径相匹配的进行路由")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" After=2020"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("04"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("02T10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("32"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("44.384+08"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("00"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Asia/Shanghai"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Cookie=username"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("hp\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("h5",{attrs:{id:"_2-不带cookie-curl测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-不带cookie-curl测试"}},[t._v("#")]),t._v(" 2. 不带cookie ==curl测试==")]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[t._v("curl http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("9527/payment/lb\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155533.png",alt:""}})]),t._v(" "),s("h5",{attrs:{id:"_3-带cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-带cookie"}},[t._v("#")]),t._v(" 3. 带cookie")]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[t._v("curl http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("9527/payment/lb "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('cookie "username=hp"\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155546.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_5-header"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-header"}},[t._v("#")]),t._v(" 5. Header")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155549.png",alt:""}})]),t._v(" "),s("p",[t._v("两个参数: ==(属性名,正则表达式)== 这个属性和正则表达式匹配则执行")]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[t._v("          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Path=/payment/lb/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("**")]),t._v("             "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#断言，路径相匹配的进行路由")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" After=2020"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("04"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("02T10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("32"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("44.384+08"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("00"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Asia/Shanghai"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#            - Cookie=username,hp")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Header=X"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \\d+ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# 请求头要有"X-Request-Id"属性,并且值为整数的正则表达式')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("h5",{attrs:{id:"_1-测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-测试"}},[t._v("#")]),t._v(" 1.  测试")]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('curl http://localhost:9527/payment/lb -H "X-Request-Id')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' 1234"\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155554.png",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("负数报错.")])]),t._v(" "),s("h3",{attrs:{id:"_6-host"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-host"}},[t._v("#")]),t._v(" 6. Host")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155606.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_7-method"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-method"}},[t._v("#")]),t._v(" 7. Method")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155613.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_8-path"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-path"}},[t._v("#")]),t._v(" 8. Path")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155624.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_9-query"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-query"}},[t._v("#")]),t._v(" 9. Query")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155630.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_10-remoteaddr"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-remoteaddr"}},[t._v("#")]),t._v(" 10. RemoteAddr")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155644.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_11-weight"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11-weight"}},[t._v("#")]),t._v(" 11. Weight")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155654.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"_7-filter"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-filter"}},[t._v("#")]),t._v(" 7. Filter")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://blog.csdn.net/qq_41211642/article/details/104881451",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考"),s("OutboundLink")],1)]),t._v(" "),s("ul",[s("li",[s("p",[t._v("路由过滤器可用于修改进入的HTTP请求和返回的HTTP响应，路由过滤器只能指定路由进行使用")])]),t._v(" "),s("li",[s("p",[t._v("SpringCloud Gateway内置了多种路由过滤器，他们都由GatewayFilter的工厂类来生成")])]),t._v(" "),s("li",[s("p",[t._v("SpringCloud Gateway的 Filter，生命周期有 pro 和 post，\n种类有GatewayFilter 和 GlobalFilter")])]),t._v(" "),s("li",[s("p",[t._v("常用的GatewayFilter 有31种之多.GlobalFilter 有10个."),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gatewayfilter-factories",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网参考"),s("OutboundLink")],1)])])]),t._v(" "),s("p",[t._v("这里主要介绍一下=="),s("strong",[t._v("自定义全局GlobalFilter")]),t._v("==")]),t._v(" "),s("h3",{attrs:{id:"_1-自定义接口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-自定义接口"}},[t._v("#")]),t._v(" 1. 自定义接口")]),t._v(" "),s("h4",{attrs:{id:"_1-主要接口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-主要接口"}},[t._v("#")]),t._v(" 1. 主要接口")]),t._v(" "),s("p",[s("strong",[t._v("==GlobalFilter,Ordered==")])]),t._v(" "),s("h4",{attrs:{id:"_2-能干啥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-能干啥"}},[t._v("#")]),t._v(" 2. 能干啥?")]),t._v(" "),s("ul",[s("li",[t._v("全局日志记录")]),t._v(" "),s("li",[t._v("统一网关鉴权")]),t._v(" "),s("li",[t._v("......")])]),t._v(" "),s("h4",{attrs:{id:"_3-编码-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-编码-3"}},[t._v("#")]),t._v(" 3.  编码")]),t._v(" "),s("ul",[s("li",[t._v("配置")])]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[t._v("        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" payment_routh2 "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#payment_routh   #路由的ID，没有固定规则但要求唯一，简易配合服务名")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#          uri: http://localhost:8001          #匹配后提供服务的路由地址")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" lb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//cloud"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("payment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 匹配后动态提供服务的路由地址")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" AddRequestParameter=X"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Requesr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 过滤器工厂,会在匹配的请求头,加上一对请求头,名称为X-Request-Id值为1024")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Path=/payment/lb/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("**")]),t._v("             "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#断言，路径相匹配的进行路由")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" After=2020"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("04"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("02T10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("32"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("44.384+08"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("00"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Asia/Shanghai"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#            - Cookie=username,hp")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Header=X"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \\d+ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# 请求头要有"X-Request-Id"属性,并且值为整数的正则表达式')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("ul",[s("li",[t._v("代码")])]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Slf4j")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Component")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyLogGatewayFilter")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GlobalFilter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Ordered")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServerWebExchange")]),t._v(" exchange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GatewayFilterChain")]),t._v(" chain"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"******come in MyLogGatewayFilter: "')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 参数")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" username "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" exchange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRequest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getQueryParams")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getFirst")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"username"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("username"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"******用户名为null,非法用户,o(╥﹏╥)o"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不被接受")]),t._v("\n            exchange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getResponse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setStatusCode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpStatus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NOT_ACCEPTABLE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" exchange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getResponse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setComplete")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" chain"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exchange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 加载过滤器的顺序\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOrder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br")])]),s("p",[t._v("测试:")]),t._v(" "),s("p",[t._v("不带参数")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155706.png",alt:""}})]),t._v(" "),s("p",[t._v("带参数")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223155714.png",alt:""}})])])}),[],!1,null,null,null);s.default=e.exports}}]);