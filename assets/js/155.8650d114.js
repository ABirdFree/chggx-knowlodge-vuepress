(window.webpackJsonp=window.webpackJsonp||[]).push([[155],{503:function(t,s,a){"use strict";a.r(s);var e=a(2),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"nginx-使用技巧"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-使用技巧"}},[t._v("#")]),t._v(" Nginx-使用技巧")]),t._v(" "),s("h2",{attrs:{id:"nginx优化静态文件加载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx优化静态文件加载"}},[t._v("#")]),t._v(" Nginx优化静态文件加载")]),t._v(" "),s("blockquote",[s("p",[t._v("参考文档："),s("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzIxMDcxMjMyOA==&mid=2247483997&idx=2&sn=c5b64fb137e2edb976ac5c0934ba9b30&chksm=9761203aa016a92c57288ad0ccfb766d611e1f0a87de3567dd491dafc2c907a6f3fc70eb757e&cur_album_id=2747217161751986178&scene=189&key=ac2485eae2674e5412fbc9c410926f7ff224a4ba3b3fb823e3d1ff44c17e4d77e4dff40e5162df803ab0ebf41ff8c95990c600380b298c474233619f33e9d32871660a20616ab41acba9f7185b26c1252d2ea79d3bb44a8d24d206734cc5e5bcf29a2048c416be0e46a27d3b0dce4e01eef68cd155950c0c86c3323e5d4a6d3e&ascene=0&uin=Mjk5NDkyOTUx&devicetype=Windows+11+x64&version=63090217&lang=zh_CN&countrycode=CN&exportkey=n_ChQIAhIQaAriH%2F0f68eQAumUWOS1ExLgAQIE97dBBAEAAAAAAHp1CYoebm4AAAAOpnltbLcz9gKNyK89dVj0VIdSR0gySrliRO4xZlN%2FdITdSGdNoyBRd%2FdtYrTex8cRmpJVO4ny9lUvdYlTdr449hpjOHmprKU%2BndHdPa2yQoP9VA4wv7froDYx5aKfkbcFwWcW3tDpmM0Gz5ty4NPIct9oYBBBiUvkxS3laUD9Y%2BpfWFxDp04%2BLGfCxFt65vd2Fempvrv499yhdP2GLGVR7Uyyk23aLV8zjLenAhbR9fFf04vwcnzQry5JuRw5ECwByH27a9emaPpy&acctmode=0&pass_ticket=hBu4tw0p85ewC1UTco5Xlw5o7FpSh3qToh5%2B3r5%2Fg0AitbTg2CSuyWJKb2YUaYEolyZr6JqvBchBGOw6xLrVEw%3D%3D&wx_header=1&fontgear=2",target:"_blank",rel:"noopener noreferrer"}},[t._v("文档地址"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"配置https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置https"}},[t._v("#")]),t._v(" 配置Https 😄")]),t._v(" "),s("h3",{attrs:{id:"_1-参考文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-参考文档"}},[t._v("#")]),t._v(" 1. 参考文档")]),t._v(" "),s("p",[t._v("nginx配置https访问：")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://blog.csdn.net/qd2013498006/article/details/122159653",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考文档一"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.jb51.net/article/241538.htm",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考文档二"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.cnblogs.com/xiaoyaodijun/p/15744066.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考文档三"),s("OutboundLink")],1),t._v(" 🚗")]),t._v(" "),s("h3",{attrs:{id:"_2-问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-问题"}},[t._v("#")]),t._v(" 2. 问题")]),t._v(" "),s("h4",{attrs:{id:"问题一-没有配置ssl模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题一-没有配置ssl模块"}},[t._v("#")]),t._v(" 问题一: 没有配置ssl模块")]),t._v(" "),s("p",[t._v("解决"),s("a",{attrs:{href:"https://so.csdn.net/so/search?q=nginx&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"}},[t._v("nginx"),s("OutboundLink")],1),t._v(': [emerg] the "ssl" parameter requires ngx_http_ssl_module in /usr/local/nginx的问题?')]),t._v(" "),s("p",[s("a",{attrs:{href:"https://blog.csdn.net/guo_qiangqiang/article/details/95622649",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nginx如果未开启SSL模块，配置Https时提示错误"),s("OutboundLink")],1),t._v(" 🚗")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.cnblogs.com/bq-med/articles/17121317.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("已经编译的nginx添加with-http_ssl_module模块 "),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("./configure "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--prefix")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/develop/nginx/sbin/nginx --with-http_stub_status_module --with-http_ssl_module\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("blockquote",[s("p",[t._v("获取重新安装删除之前配置的nginx目录，使用nginx源码重新配置（./configure时候，添加上边配置）")])]),t._v(" "),s("h3",{attrs:{id:"_3-配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置"}},[t._v("#")]),t._v(" 3. 配置")]),t._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("  # 免费证书")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    server")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("         # SSL 访问端口号为 443")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("         listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("443 ssl;")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("         # 填写绑定证书的域名")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("         server_name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("ts.cnlxc.cn;")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("         # 替换成已上传的证书文件的目录和名称。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("         ssl_certificate")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/opt/develop/ssl/9570621_ts.cnlxc.cn.pem;  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("         # 替换成已上传的证书私钥文件的目录和名称。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("         ssl_certificate_key")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/opt/develop/ssl/9570621_ts.cnlxc.cn.key; ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("         ssl_session_timeout")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("5m;")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("         # 请按照以下套件配置，配置加密套件，写法遵循 openssl 标准。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("         ssl_ciphers")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("         # 请按照以下协议配置")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("         ssl_protocols")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("TLSv1.1 TLSv1.2 TLSv1.3;")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("         ssl_prefer_server_ciphers")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("on;")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("         if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("($host != 'ts.cnlxc.cn') {")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("            rewrite")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("^/(.*)$ https://ts.cnlxc.cn/$1 permanent;")]),t._v("\n         }\n       \n       \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        # /vue/dist/ 打包后的dist目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        root")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/opt/project/static/document;")]),t._v("\n       \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        # 文件代理")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        location")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/upFiles/ {")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("            alias")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/opt/project/upFiles/;")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("\t        add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("'Access-Control-Allow-Origin' '*';")]),t._v("\n        }\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    }")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v(" ")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    # 网站")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    server")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("      80;")]),t._v("\n        \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        # 配置https")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        server_name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("ts.cnlxc.cn;")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        #将请求转成https")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("        rewrite")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("^(.*)$ https://$host$1 permanent;")]),t._v("\n        \n    \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        # http 配置")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        # server_name  localhost;")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        # root   /opt/project/static/document;")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        # location / {")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        #    try_files $uri $uri/ /index.html;  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        # }")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        # location @rewrites {")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        #   rewrite ^(.+)$ /index.html last;")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        # }")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        # error_page   500 502 503 504  /50x.html;")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        # location = /50x.html {")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        #     root   html;")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("        # }")]),t._v("\n    }\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br"),s("span",{staticClass:"line-number"},[t._v("48")]),s("br"),s("span",{staticClass:"line-number"},[t._v("49")]),s("br"),s("span",{staticClass:"line-number"},[t._v("50")]),s("br"),s("span",{staticClass:"line-number"},[t._v("51")]),s("br"),s("span",{staticClass:"line-number"},[t._v("52")]),s("br"),s("span",{staticClass:"line-number"},[t._v("53")]),s("br"),s("span",{staticClass:"line-number"},[t._v("54")]),s("br"),s("span",{staticClass:"line-number"},[t._v("55")]),s("br"),s("span",{staticClass:"line-number"},[t._v("56")]),s("br"),s("span",{staticClass:"line-number"},[t._v("57")]),s("br"),s("span",{staticClass:"line-number"},[t._v("58")]),s("br"),s("span",{staticClass:"line-number"},[t._v("59")]),s("br"),s("span",{staticClass:"line-number"},[t._v("60")]),s("br"),s("span",{staticClass:"line-number"},[t._v("61")]),s("br"),s("span",{staticClass:"line-number"},[t._v("62")]),s("br")])]),s("h2",{attrs:{id:"开启http-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开启http-2"}},[t._v("#")]),t._v(" 开启HTTP/2")]),t._v(" "),s("h3",{attrs:{id:"配置验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置验证"}},[t._v("#")]),t._v(" 配置验证")]),t._v(" "),s("p",[t._v("HTTP/2标准是从Google的SPDY上进行改进的，比起HTTP/1.1提升了不少性能，尤其是需要并行多个请求的时候可以显著减少延迟。在现在的网络上，一个网页平均需要请求几十次，而在 HTTP 1.1 时代浏览器能做的就是多开几个TCP连接（通常是 6 个）进行并行HTTP请求，而 HTTP 2 中可以在一个TCP连接中进行多个HTTP请求。HTTP 2 原生支持多个并行请求，因此大大减少了顺序执行的请求的往返程，可以首要考虑开启。")]),t._v(" "),s("blockquote",[s("p",[t._v("HTTP是基于TCP上的协议，每一次HTTP请求都需要先建立一次TCP。到了HTTP/2，一个TCP可以发送多个HTTP请求")])]),t._v(" "),s("p",[s("strong",[t._v("1.在 Nginx 中开启 HTTP 2.0 非常简单，只需要增加一个 http2 标志即可")])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("listen 443 ssl;\n# 改为\nlisten 443 ssl http2;\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("blockquote",[s("p",[t._v("如果你担心你的用户用的是旧的客户端，比如 Python 的 requests，暂时还不支持 HTTP 2 的话，那么其实不用担心。如果用户的客户端不支持 HTTP 2，那么连接会自动降级为 HTTP 1.1，保持了后向兼容。因此，所有使用旧 Client 的用户，仍然不受影响，而新的客户端则可以享受 HTTP/2 的新特性")])]),t._v(" "),s("p",[s("strong",[t._v("2.确认你的网站或者 API 开启了 HTTP 2")])]),t._v(" "),s("p",[t._v("在 Chrome 中打开开发者工具，点开 Protocol 之后在所有的请求中都可以看到请求用的协议了。如果 protocol 这列的值是 h2 的话，那么用的就是 HTTP 2 了")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/202304121351429.png",alt:"image-20230412135115308"}})]),t._v(" "),s("blockquote",[s("p",[t._v("h2协议：表示配置http2成功")]),t._v(" "),s("p",[t._v("http/1.1：是使用阿里云OSS云存储，后形成的连接。跟配置的nginx不同。")])]),t._v(" "),s("h3",{attrs:{id:"问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[t._v("#")]),t._v(" 问题")]),t._v(" "),s("h4",{attrs:{id:"问题一-开启http2失败"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题一-开启http2失败"}},[t._v("#")]),t._v(" 问题一：开启http2失败")]),t._v(" "),s("p",[t._v('nginx: [emerg] the "http2" parameter requires ngx_http_v2_module in /opt/develop/nginx/conf/nginx.conf:54')]),t._v(" "),s("p",[t._v("参考文档：")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://nginx.org/en/docs/http/ngx_http_v2_module.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网文档"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://blog.csdn.net/u013810234/article/details/114905554",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nginx配置开启HTTP2支持"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("--with-http_v2_module："),s("a",{attrs:{href:"https://blog.csdn.net/qubes/article/details/120546123",target:"_blank",rel:"noopener noreferrer"}},[t._v("需要http2模块"),s("OutboundLink")],1),t._v(" 🚗")]),t._v(" "),s("blockquote",[s("p",[t._v("注意：版本在1.9.5以上 ，")]),t._v(" "),s("ul",[s("li",[t._v("重新安装添加此模块："),s("a",{attrs:{href:"https://blog.csdn.net/guo_qiangqiang/article/details/95622649",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考配置"),s("OutboundLink")],1)])]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("./configure "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--prefix")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/develop/nginx/sbin/nginx --with-http_v2_module\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ul",[s("li",[t._v("删除之前解压后的文件，重新安装 🚗")])]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("./configure "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--prefix")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/develop/nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--sbin-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/develop/nginx/sbin/nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--modules-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/develop/nginx/modules "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--conf-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/develop/nginx/conf/nginx.conf "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--error-log-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/develop/nginx/logs/error.log "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--http-log-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/develop/nginx/logs/access.log "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--pid-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/develop/nginx/logs/nginx.pid "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--lock-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/develop/nginx/logs/nginx.lock "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_stub_status_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_ssl_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_v2_module\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])])]),t._v(" "),s("h2",{attrs:{id:"限流"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#限流"}},[t._v("#")]),t._v(" 限流 😄")]),t._v(" "),s("h3",{attrs:{id:"_1-参考文章"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-参考文章"}},[t._v("#")]),t._v(" 1. 参考文章")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://blog.csdn.net/wangmourena/article/details/109569068",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nginx的限流策略"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://huaweicloud.csdn.net/63561b63d3efff3090b5a7d7.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nginx限流"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://blog.csdn.net/hanjinjuan/article/details/119701523",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nginx 如何限流和访问控制（详解）"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"_2-问题-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-问题-2"}},[t._v("#")]),t._v(" 2. 问题")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://blog.csdn.net/fenlin88l/article/details/90475854",target:"_blank",rel:"noopener noreferrer"}},[t._v('对nginx的imit_conn_zone理解配置_"zero size shared memory zone "perip"_'),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"_3-配置-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置-2"}},[t._v("#")]),t._v(" 3. 配置")]),t._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("http")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    # 限流设置")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    # 这只是设置流量限制和共享内存区域的参数，但实际上并不限制请求速率。具体的限制需要定义具体的url")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    limit_req_zone")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("$binary_remote_addr zone=contentRateLimit:10m rate=2r/s;")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    # 根据IP地址来限制，存储内存大小10M")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    limit_conn_zone")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("$server_name zone=perip:10m;   # $binary_remote_addr是限制同一客户端ip地址；")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    limit_conn_zone")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("$server_name zone=perserver:10m; # 限制同一server最大并发数；")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    location")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/ {")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("               # 使用限流配 ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("               # 配合limit_req_zone配置使用------平均每秒允许不超过2个请求，突发不超过4个请求，并且处理突发4个请求的时候，没有延迟，等到完成之后，按照正常的速率处理。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("               limit_req")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("zone=contentRateLimit burst=4 nodelay;")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("               # 限制并发连接数：配合limit_conn_zone使用------单个客户端ip与服务器的连接数．")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("               limit_conn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("perip 2;")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("               # 限制并发连接数：配合limit_conn_zone使用------限制与服务器的总连接数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("               limit_conn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("perserver 20; ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("               # 限制下载速度：限速为 100KB/秒")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("               # 是对每个连接限速100k。这里是对连接限速，而不是对IP限速！如果一个IP允许两个并发连接，那么这个IP就是限速limit_rate * 2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("               limit_rate")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("100k; ")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("               index")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("index.html index.htm;")]),t._v("\n    }\n}\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br")])])])}),[],!1,null,null,null);s.default=n.exports}}]);