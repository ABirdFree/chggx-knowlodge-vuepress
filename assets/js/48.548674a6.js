(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{395:function(t,a,s){"use strict";s.r(a);var n=s(2),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"threadpool线程池"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#threadpool线程池"}},[t._v("#")]),t._v(" ThreadPool线程池")]),t._v(" "),a("h2",{attrs:{id:"_1-线程池简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-线程池简介"}},[t._v("#")]),t._v(" 1. 线程池简介")]),t._v(" "),a("h3",{attrs:{id:"_1-1-线程池概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-线程池概述"}},[t._v("#")]),t._v(" 1.1 线程池概述")]),t._v(" "),a("p",[t._v("线程池（英语：thread pool）：一种线程使用模式。线程过多会带来调度开销，进而影响缓存局部性和整体性能。而线程池维护着多个线程，等待着监督管理者分配可并发执行的任务。这避免了在处理短时间任务时创建与销毁线程的代价。线程池不仅能够保证内核的充分利用，还能防止过分调度。")]),t._v(" "),a("p",[a("strong",[t._v("线程池的优势：")])]),t._v(" "),a("p",[t._v("线程池做的工作只要是控制运行的线程数量，处理过程中将任务放入队列，然后在线程创建后启动这些任务，如果线程数量超过了最大数量，超出数量的线程排队等候，等其他线程执行完毕，再从队列中取出任务来执行。")]),t._v(" "),a("p",[a("strong",[t._v("特点：")])]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("降低资源消耗")]),t._v(": 通过重复利用已创建的线程降低线程创建和销毁造成的销耗。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("提高响应速度")]),t._v(": 当任务到达时，任务可以不需要等待线程创建就能立即执行。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("提高线程的可管理性")]),t._v(": 线程是稀缺资源，如果无限制的创建，不仅会销耗系统资源，还会降低系统的稳定性，使用线程池可以进行统一的分配，调优和监控。")])])]),t._v(" "),a("h3",{attrs:{id:"_1-2-线程池架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-线程池架构"}},[t._v("#")]),t._v(" 1.2 线程池架构")]),t._v(" "),a("blockquote",[a("p",[t._v("Java 中的线程池是通过"),a("code",[t._v("Executor框架")]),t._v("实现的，该框架中用到了"),a("a",{attrs:{href:"https://www.matools.com/file/manual/jdk_api_1.8_google/java/util/concurrent/Executor.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Executor"),a("OutboundLink")],1),t._v(", "),a("a",{attrs:{href:"https://www.matools.com/file/manual/jdk_api_1.8_google/java/util/concurrent/Executors.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Executors"),a("OutboundLink")],1),t._v("，"),a("a",{attrs:{href:"https://www.matools.com/file/manual/jdk_api_1.8_google/java/util/concurrent/ExecutorService.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ExecutorService"),a("OutboundLink")],1),t._v("，"),a("a",{attrs:{href:"https://www.matools.com/file/manual/jdk_api_1.8_google/java/util/concurrent/ThreadPoolExecutor.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ThreadPoolExecutor"),a("OutboundLink")],1),t._v(" 这几个类")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/202303251828645.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"_2-线程池的种类与创建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-线程池的种类与创建"}},[t._v("#")]),t._v(" 2. 线程池的种类与创建 😆")]),t._v(" "),a("h3",{attrs:{id:"_2-1-newcachedthreadpool-一池可扩容线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-newcachedthreadpool-一池可扩容线程"}},[t._v("#")]),t._v(" 2.1 newCachedThreadPool 😄 "),a("code",[t._v("一池可扩容线程")])]),t._v(" "),a("p",[a("strong",[t._v("作用")]),t._v("：")]),t._v(" "),a("p",[t._v("创建一个可缓存线程池，如果线程池长度超过处理需要，可灵活回收空闲线程，若无可回收，则新建线程.")]),t._v(" "),a("p",[a("strong",[t._v("特点：")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("线程池中数量没有固定，可达到最大值（"),a("code",[t._v("Interger. MAX_VALUE")]),t._v("）")])]),t._v(" "),a("li",[a("p",[t._v("线程池中的线程可进行缓存重复利用和回收（回收默认时间为 1 分钟）")])]),t._v(" "),a("li",[a("p",[t._v("当线程池中，没有可用线程，会重新创建一个线程")])])]),t._v(" "),a("p",[a("strong",[t._v("场景:")])]),t._v(" "),a("p",[t._v("适用于创建一个可无限扩大的线程池，服务器负载压力较轻，执行时间较短，任务多的场景")]),t._v(" "),a("p",[a("strong",[t._v("线程创建：")])]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadPoolDemo1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一池可扩容线程")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExecutorService")]),t._v(" threadPool "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("newCachedThreadPool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//10个顾客请求")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//执行")]),t._v("\n                threadPool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentThread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" 办理业务"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//关闭")]),t._v("\n            threadPool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br")])]),a("p",[t._v("结果：")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("点击查看")]),t._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-8")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-7")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-9")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-8")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-7")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-9")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-10")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br")])])]),t._v(" "),a("h3",{attrs:{id:"_2-2-newfixedthreadpool-一池n线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-newfixedthreadpool-一池n线程"}},[t._v("#")]),t._v(" 2.2 newFixedThreadPool 😄 "),a("code",[t._v("一池N线程")])]),t._v(" "),a("p",[a("strong",[t._v("作用")]),t._v("：")]),t._v(" "),a("p",[t._v("创建一个可重用固定线程数的线程池，以共享的无界队列方式来运行这些线程。在任意点，在大多数线程会处于处理任务的活动状态。如果在所有线程处于活动状态时提交附加任务，则在有可用线程之前，附加任务将在队列中等待。如果在关闭前的执行期间由于失败而导致任何线程终止，那么一个新线程将代替它执行后续的任务（如果需要）。在某个线程被显式地关闭之前，池中的线程将一直存在。")]),t._v(" "),a("p",[a("strong",[t._v("特征：")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("线程池中的线程处于一定的量，可以很好的控制线程的并发量 （比如银行办理业务的窗口）")])]),t._v(" "),a("li",[a("p",[t._v("线程可以重复被使用，在显示关闭之前，都将一直存在")])]),t._v(" "),a("li",[a("p",[t._v("超出一定量的线程被提交时候需在队列中等待")])])]),t._v(" "),a("p",[a("strong",[t._v("场景:")])]),t._v(" "),a("p",[t._v("适用于可以预测线程数量的业务中，或者服务器负载较重，对线程数有严格限制的场景")]),t._v(" "),a("p",[a("strong",[t._v("线程创建：")])]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadPoolDemo1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一池五线程")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExecutorService")]),t._v(" threadPool "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("newFixedThreadPool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//5个窗口")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//10个顾客请求")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//执行")]),t._v("\n                threadPool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentThread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" 办理业务"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//关闭")]),t._v("\n            threadPool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br")])]),a("p",[t._v("结果：")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("点击查看")]),t._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])])]),t._v(" "),a("h3",{attrs:{id:"_2-3-newsinglethreadexecutor-一池一线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-newsinglethreadexecutor-一池一线程"}},[t._v("#")]),t._v(" 2.3 newSingleThreadExecutor 😄 "),a("code",[t._v("一池一线程")])]),t._v(" "),a("p",[a("strong",[t._v("作用")]),t._v("：")]),t._v(" "),a("p",[t._v("创建一个使用单个 worker 线程的 Executor，以无界队列方式来运行该线程。（注意，如果因为在关闭前的执行期间出现失败而终止了此单个线程，那么如果需要，一个新线程将代替它执行后续的任务）。可保证顺序地执行各个任务，并且在任意给定的时间不会有多个线程是活动的。与其他等效的newFixedThreadPool 不同，可保证无需重新配置此方法所返回的执行程序即可使用其他的线程。")]),t._v(" "),a("p",[a("strong",[t._v("特征：")])]),t._v(" "),a("p",[t._v("线程池中最多执行1个线程，之后提交的线程活动将会排在队列中以此执行")]),t._v(" "),a("p",[a("strong",[t._v("场景:")])]),t._v(" "),a("p",[t._v("适用于需要保证顺序执行各个任务，并且在任意时间点，不会同时有多个线程的场景")]),t._v(" "),a("p",[a("strong",[t._v("线程创建：")])]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadPoolDemo1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一池一线程")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExecutorService")]),t._v(" threadPool "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("newSingleThreadExecutor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//一个窗口")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//10个顾客请求")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//执行")]),t._v("\n                threadPool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentThread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" 办理业务"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//关闭")]),t._v("\n            threadPool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br")])]),a("p",[t._v("结果：")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("点击查看")]),t._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])])]),t._v(" "),a("h3",{attrs:{id:"_2-4-newschedulethreadpool"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-newschedulethreadpool"}},[t._v("#")]),t._v(" 2.4 newScheduleThreadPool")]),t._v(" "),a("p",[a("strong",[t._v("作用:")])]),t._v(" "),a("p",[t._v("线程池支持定时以及周期性执行任务，创建一个 corePoolSize 为传入参数，最大线程数为整形的最大数的线程池**")]),t._v(" "),a("p",[a("strong",[t._v("特征:")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("线程池中具有指定数量的线程，即便是空线程也将保留 （")])]),t._v(" "),a("li",[a("p",[t._v("可定时或者延迟执行线程活动")])])]),t._v(" "),a("p",[a("strong",[t._v("场景:")])]),t._v(" "),a("p",[t._v("适用于需要多个后台线程执行周期任务的场景")]),t._v(" "),a("h3",{attrs:{id:"_2-5-newworkstealingpool"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-newworkstealingpool"}},[t._v("#")]),t._v(" 2.5 newWorkStealingPool")]),t._v(" "),a("p",[t._v("jdk1.8 提供的线程池，底层使用的是 ForkJoinPool 实现，创建一个拥有多个任务队列的线程池，可以减少连接数，创建当前可用 cpu 核数的线程来并行执行任务")]),t._v(" "),a("p",[a("strong",[t._v("场景:")]),t._v(" 适用于大耗时，可并行执行的场景")]),t._v(" "),a("h2",{attrs:{id:"_3-线程池底层工作原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-线程池底层工作原理"}},[t._v("#")]),t._v(" 3. 线程池底层工作原理 😄")]),t._v(" "),a("h3",{attrs:{id:"_3-1-七个常用参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-七个常用参数"}},[t._v("#")]),t._v(" 3.1 七个常用参数 😈")]),t._v(" "),a("p",[a("code",[t._v("newFixedThreadPool")]),t._v("、"),a("code",[t._v("newSingleThreadExecutor")]),t._v("、"),a("code",[t._v("newCachedThreadPool")]),t._v("线程池的创建都是通过"),a("code",[t._v("ThreadPoolExecutor")]),t._v(". 下面介绍其中的参数")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("corePoolSize")]),t._v(" 线程池的核心线程数 🚗")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("maximumPoolSize")]),t._v(" 能容纳的最大线程数 🚗")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("keepAliveTime")]),t._v(" 空闲线程存活时间")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("unit")]),t._v(" 存活的时间单位")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("workQueue")]),t._v(" 存放提交但未执行任务的队列(阻塞队列) 🚗")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("threadFactory")]),t._v(" 创建线程的工厂类")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("handler")]),t._v(" 等待队列满后的拒绝策略")])])]),t._v(" "),a("p",[t._v("线程池中，有三个重要的参数，决定影响了拒绝策略：corePoolSize - 核心线程数，也即最小的线程数。workQueue - 阻塞队列 。 maximumPoolSize -最大线程数")]),t._v(" "),a("p",[t._v("当提交任务数大于 corePoolSize 的时候，会优先将任务放到 workQueue 阻塞队列中。当阻塞队列饱和后，会扩充线程池中线程数，直到达到maximumPoolSize 最大线程数配置。此时，再多余的任务，则会触发线程池的拒绝策略了。")]),t._v(" "),a("blockquote",[a("p",[t._v("总结："),a("strong",[t._v("当提交的任务数大于（workQueue.size() +")]),t._v(" "),a("strong",[t._v("maximumPoolSize ），就会触发线程池的拒绝策略")]),t._v("。")])]),t._v(" "),a("h3",{attrs:{id:"_3-2-工作流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-工作流程"}},[t._v("#")]),t._v(" 3.2 工作流程")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/202303251842876.png",alt:""}})]),t._v(" "),a("ol",[a("li",[a("p",[t._v("在创建了线程池后，线程池中的线程数为零")])]),t._v(" "),a("li",[a("p",[t._v("当调用 execute()方法添加一个请求任务时，线程池会做出如下判断：")]),t._v(" "),a("ul",[a("li",[t._v("如果正在运行的线程数量小于 corePoolSize，那么马上创建线程运行这个任务；")]),t._v(" "),a("li",[t._v("如果正在运行的线程数量大于或等于 corePoolSize，那么将这个任务放入队列；")]),t._v(" "),a("li",[t._v("如果这个时候队列满了且正在运行的线程数量还小于maximumPoolSize，那么还是要创建非核心线程立刻运行这个任务；")]),t._v(" "),a("li",[t._v("如果队列满了且正在运行的线程数量大于或等于 maximumPoolSize，那么线程池会启动饱和拒绝策略来执行。")])])]),t._v(" "),a("li",[a("p",[t._v("当一个线程完成任务时，它会从队列中取下一个任务来执行")])]),t._v(" "),a("li",[a("p",[t._v("当一个线程无事可做超过一定的时间（keepAliveTime）时，线程会判断：")]),t._v(" "),a("ul",[a("li",[t._v("如果当前运行的线程数大于 corePoolSize，那么这个线程就被停掉。")]),t._v(" "),a("li",[t._v("所以线程池的所有任务完成后，它最终会收缩到 corePoolSize 的大小。")])])])]),t._v(" "),a("h3",{attrs:{id:"_3-3-拒绝策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-拒绝策略"}},[t._v("#")]),t._v(" 3.3  拒绝策略 😈")]),t._v(" "),a("blockquote",[a("p",[t._v("工作流程中的第四步：RejectedExecutionHandler")])]),t._v(" "),a("p",[a("code",[t._v("AbortPolicy")]),t._v(" (默认): 丢弃任务，并抛出拒绝执行 RejectedExecutionException 异常信息。线程池默认的拒绝策略。必须处理好抛出的异常，否则会打断当前的执行流程，影响后续的任务执行。")]),t._v(" "),a("p",[a("code",[t._v("CallerRunsPolicy")]),t._v(": 当触发拒绝策略，只要线程池没有关闭的话，则使用调用线程直接运行任务。一般并发比较小，性能要求不高，不允许失败。但是，由于调用者自己运行任务，如果任务提交速度过快，可能导致程序阻塞，性能效率上必然的损失较大")]),t._v(" "),a("p",[a("code",[t._v("DiscardPolicy")]),t._v(": 直接丢弃，其他啥都没有")]),t._v(" "),a("p",[a("code",[t._v("DiscardOldestPolicy")]),t._v(": 当触发拒绝策略，只要线程池没有关闭的话，丢弃阻塞队列 workQueue 中最老的一个任务，并将新任务加入")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/202303251843428.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"_4-自定义线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-自定义线程"}},[t._v("#")]),t._v(" 4. 自定义线程 😈")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//自定义线程池创建")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadPoolDemo2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExecutorService")]),t._v(" threadPool "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadPoolExecutor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 线程池的核心线程数")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 能容纳的最大线程数")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2L")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 空闲线程存活时间")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SECONDS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 存活的时间单位")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayBlockingQueue")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 存放提交但未执行任务的队列")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defaultThreadFactory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建线程的工厂类")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadPoolExecutor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AbortPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 等待队列满后的拒绝策略")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 10个顾客请求")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行")]),t._v("\n                threadPool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentThread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" 办理业务"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//关闭")]),t._v("\n            threadPool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br")])]),a("p",[t._v("结果：")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("点击查看")]),t._v(" "),a("p",[t._v("当顾客小于等于5时候")]),t._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("当顾客大于5时候：超过线程做大线程数，触发拒绝策略。")]),t._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("pool-1-thread-5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("办理业务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("java.util.concurrent.RejectedExecutionException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("Task cn.cnlxc.pool.ThreadPoolDemo2$$Lambda$1/1096979270@7ba4f24f rejected from java.util.concurrent.ThreadPoolExecutor@3b9a45b3[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 8]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("\tat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("java.util.concurrent.ThreadPoolExecutor$AbortPolicy.rejectedExecution(ThreadPoolExecutor.java:2063)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("\tat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:830)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("\tat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1379)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("\tat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("cn.cnlxc.pool.ThreadPoolDemo2.main(ThreadPoolDemo2.java:22)")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])])]),t._v(" "),a("h2",{attrs:{id:"_5-注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-注意事项"}},[t._v("#")]),t._v(" 5. 注意事项😄")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("项目中创建多线程时，使用常见的三种线程池创建方式，单一、可变、定长都有一定问题，原因是 FixedThreadPool 和 "),a("code",[t._v("SingleThreadExecutor")]),t._v(" 底层都是用"),a("code",[t._v("LinkedBlockingQueue")]),t._v("实现的，这个队列最大长度为 Integer.MAX_VALUE，容易导致 OOM。所以实际生产一般自己通过"),a("code",[t._v("ThreadPoolExecutor")]),t._v("的 7 个参数，自定义线程池")])]),t._v(" "),a("li",[a("p",[t._v("创建线程池推荐适用"),a("code",[t._v("ThreadPoolExecutor")]),t._v("及其 7 个参数手动创建")]),t._v(" "),a("ul",[a("li",[t._v("corePoolSize 线程池的核心线程数")]),t._v(" "),a("li",[t._v("maximumPoolSize 能容纳的最大线程数")]),t._v(" "),a("li",[t._v("keepAliveTime 空闲线程存活时间")]),t._v(" "),a("li",[t._v("unit 存活的时间单位")]),t._v(" "),a("li",[t._v("workQueue 存放提交但未执行任务的队列")]),t._v(" "),a("li",[t._v("threadFactory 创建线程的工厂类")]),t._v(" "),a("li",[t._v("handler 等待队列满后的拒绝策略")])])]),t._v(" "),a("li",[a("p",[t._v("为什么不允许适用不允许"),a("code",[t._v("Executors")]),t._v("的方式手动创建线程池,如下图")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/202303251854937.png",alt:""}})])])}),[],!1,null,null,null);a.default=e.exports}}]);