<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/logo/logo-0.2.5.1.png" type="image/png" sizes="16x16"><meta name="referrer" content="no-referrer"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,maximum-scale=2"><title>SpringCloud Alibaba 官网 | chggx Konwledge</title><meta name="description" content="晨光向的知识库">
    <link rel="modulepreload" href="/chggx-knowlodge-vuepress/assets/app.099ebd34.js"><link rel="modulepreload" href="/chggx-knowlodge-vuepress/assets/2.SpringCloud Alibaba介绍.html.954edee6.js"><link rel="modulepreload" href="/chggx-knowlodge-vuepress/assets/2.SpringCloud Alibaba介绍.html.4df72d19.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/index.html.7965f4da.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/index.html.2f2f1f94.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/index.html.ae2ce70a.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/index.html.ac2b8553.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/index.html.e14c572b.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/index.html.f78e20f6.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/index.html.aa654337.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/时序数据库-influxdb1.x 快速入门.html.79d75c4c.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/时序数据库-influxdb2.x 快速入门.html.0f3fe687.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/ElasticSearch7.6.1快速入门.html.4e5590bc.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/1.Redis入门.html.72bd8315.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/2.Redis数据类型.html.1dca25a7.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/3.Redis事务.html.d6541a87.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/4.Redis实现乐观锁.html.0fccfc6b.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/5.Redis-Jedis.html.e0339753.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/6.SpringBoot整合.html.4f6d0361.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/7.Redis的配置文件详解.html.3f71e5f7.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/Redis面试必备.html.565f37a4.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/1.SpringBoot基础.html.addd68ab.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/2.SpringBoot整合RabbitMQ.html.2130697f.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/1.SpringCloud.H基础.html.579c7733.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/0.Java设计模式-内容介绍.html.4c64431b.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/1.Java设计模式-设计模式七大原则.html.f7724ac0.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/2.Java设计模式-UML类图.html.dd535d53.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/3.Java设计模式-设计模式概述.html.578ab5c8.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/4.Java设计模式-单例模式.html.8e694f61.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/5.Java设计模式-工厂模式.html.f2d2a3e8.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/6.Java设计模式-原型模式.html.96389af1.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/7.Java设计模式-建造者模式.html.6c1164f4.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/0.反射_注解.html.915ba1a7.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/1.Spring基础.html.09d5c115.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/1.JVM-JVM与Java体系结构.html.20b97bab.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/10.JVM-对象的实例化内存布局与访问定位.html.e0452d45.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/12.JVM-执行引擎.html.09a5fcdb.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/13.JVM-StringTable.html.9c6fa66b.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/14.JVM-垃圾回收概述.html.f24da324.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/15.JVM-垃圾回收相关算法.html.6c1eee28.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/16.JVM-垃圾回收相关概念.html.555ad5c8.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/2.JVM-类加载子系统.html.d23d9307.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/3.JVM-运行时数据区概述及线程.html.73115a90.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/4.JVM-程序计数器(PC寄存器).html.eaa43a7a.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/5.JVM-虚拟机栈.html.4a5da7d1.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/6.JVM-本地方法接口.html.6202cb8b.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/7.JVM-本地方法栈.html.fbe12cb8.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/8.JVM-堆.html.2a6f83f4.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/9.JVM-方法区.html.6b2c2b0c.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/2.Java8新特性-Stream流.html.eec6de9c.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/3.Java8新特性-日期.html.b8efb717.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/1.SVN基础.html.68038d62.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/2.Git常用命令.html.44d60505.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/404.html.c3e557d0.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/index.html.18b0ea6d.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/index.html.ee108be9.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/index.html.0bf44c21.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/index.html.fdfeec7c.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/index.html.f615de6f.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/index.html.656af16d.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/index.html.e6fe2efc.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/时序数据库-influxdb1.x 快速入门.html.2aa4ca42.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/时序数据库-influxdb2.x 快速入门.html.2064eebc.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/ElasticSearch7.6.1快速入门.html.98f907c0.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/1.Redis入门.html.a0317cb6.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/2.Redis数据类型.html.f9096454.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/3.Redis事务.html.a99f54a2.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/4.Redis实现乐观锁.html.fbfdb9f3.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/5.Redis-Jedis.html.75dfaa97.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/6.SpringBoot整合.html.b6c0ae73.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/7.Redis的配置文件详解.html.ed363f3e.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/Redis面试必备.html.cffad8a6.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/1.SpringBoot基础.html.e574f8aa.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/2.SpringBoot整合RabbitMQ.html.3234b0ce.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/1.SpringCloud.H基础.html.16addf58.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/0.Java设计模式-内容介绍.html.d767132a.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/1.Java设计模式-设计模式七大原则.html.b750374f.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/2.Java设计模式-UML类图.html.62fef168.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/3.Java设计模式-设计模式概述.html.80544a2f.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/4.Java设计模式-单例模式.html.1b36b209.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/5.Java设计模式-工厂模式.html.d9a560e8.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/6.Java设计模式-原型模式.html.c16662fa.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/7.Java设计模式-建造者模式.html.4ffa1cf2.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/0.反射_注解.html.8c8a5821.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/1.Spring基础.html.8e907486.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/1.JVM-JVM与Java体系结构.html.def8831c.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/10.JVM-对象的实例化内存布局与访问定位.html.c1bc7c3f.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/12.JVM-执行引擎.html.a86974db.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/13.JVM-StringTable.html.592c3824.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/14.JVM-垃圾回收概述.html.c3c69a48.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/15.JVM-垃圾回收相关算法.html.8a87682e.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/16.JVM-垃圾回收相关概念.html.97355adf.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/2.JVM-类加载子系统.html.c51da7a2.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/3.JVM-运行时数据区概述及线程.html.e550b9a4.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/4.JVM-程序计数器(PC寄存器).html.5f49930d.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/5.JVM-虚拟机栈.html.fe4052e4.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/6.JVM-本地方法接口.html.2ca30aed.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/7.JVM-本地方法栈.html.ff1e6b43.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/8.JVM-堆.html.c6130241.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/9.JVM-方法区.html.60bc82f0.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/2.Java8新特性-Stream流.html.b14b4cf6.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/3.Java8新特性-日期.html.30ca8164.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/1.SVN基础.html.d1d6cb97.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/2.Git常用命令.html.1a2dc50b.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/404.html.3e165de1.js">
    <link rel="stylesheet" href="/chggx-knowlodge-vuepress/assets/style.19ddbf83.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/chggx-knowlodge-vuepress/" class=""><img class="logo" src="/chggx-knowlodge-vuepress/logo/logo-1.5.2.png" alt="chggx Konwledge"><span class="site-name can-hide">chggx Konwledge</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/chggx-knowlodge-vuepress/" class="" aria-label="  首页  "><!--[--><!--]-->   首页   <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="  JAVA  "><span class="title">  JAVA  </span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="  JAVA  "><span class="title">  JAVA  </span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/java/java-base/" class="" aria-label="Java基础"><!--[--><!--]--> Java基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/java/java-advence/" class="" aria-label="Java进阶"><!--[--><!--]--> Java进阶 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/java/framework/" class="router-link-active" aria-label="框架"><!--[--><!--]--> 框架 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/java/until/" class="" aria-label="工具"><!--[--><!--]--> 工具 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="  数据库  "><span class="title">  数据库  </span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="  数据库  "><span class="title">  数据库  </span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/sql/mysql" class="" aria-label="mysql"><!--[--><!--]--> mysql <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Redis</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/redis/1.Redis%E5%85%A5%E9%97%A8.html" class="" aria-label="Redis入门"><!--[--><!--]--> Redis入门 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/redis/2.Redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html" class="" aria-label="Redis数据类型"><!--[--><!--]--> Redis数据类型 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/redis/3.Redis%E4%BA%8B%E5%8A%A1.html" class="" aria-label="Redis事务"><!--[--><!--]--> Redis事务 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/redis/4.Redis%E5%AE%9E%E7%8E%B0%E4%B9%90%E8%A7%82%E9%94%81.html" class="" aria-label="Redis实现乐观锁"><!--[--><!--]--> Redis实现乐观锁 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/redis/5.Redis-Jedis.html" class="" aria-label="Redis-Jedis"><!--[--><!--]--> Redis-Jedis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/redis/6.SpringBoot%E6%95%B4%E5%90%88.html" class="" aria-label="SpringBoot整合"><!--[--><!--]--> SpringBoot整合 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/redis/7.Redis%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3.html" class="" aria-label="Redis的配置文件详解"><!--[--><!--]--> Redis的配置文件详解 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/redis/Redis%E9%9D%A2%E8%AF%95%E5%BF%85%E5%A4%87.html" class="" aria-label="Redis面试必备"><!--[--><!--]--> Redis面试必备 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>influxdb</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/influxdb/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93-influxdb1.x%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html" class="" aria-label="时序数据库-influxdb1.x 快速入门"><!--[--><!--]--> 时序数据库-influxdb1.x 快速入门 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/influxdb/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93-influxdb2.x%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html" class="" aria-label="时序数据库-influxdb2.x 快速入门"><!--[--><!--]--> 时序数据库-influxdb2.x 快速入门 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="  搜索引擎  "><span class="title">  搜索引擎  </span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="  搜索引擎  "><span class="title">  搜索引擎  </span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ElasticSearch</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/search/elasticSearch/ElasticSearch7.6.1%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html" class="" aria-label="ElasticSearch7.6.1快速入门"><!--[--><!--]--> ElasticSearch7.6.1快速入门 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="  中间件  "><span class="title">  中间件  </span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="  中间件  "><span class="title">  中间件  </span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/mq/mysql" class="" aria-label="RabbitMQ"><!--[--><!--]--> RabbitMQ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="  部署运维  "><span class="title">  部署运维  </span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="  部署运维  "><span class="title">  部署运维  </span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/mq/mysql" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/mq/mysql" class="" aria-label="虚拟机"><!--[--><!--]--> 虚拟机 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/mq/mysql" class="" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="  问题汇总  "><span class="title">  问题汇总  </span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="  问题汇总  "><span class="title">  问题汇总  </span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/mq/mysql" class="" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/mq/mysql" class="" aria-label="数据库"><!--[--><!--]--> 数据库 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/mq/mysql" class="" aria-label="部署"><!--[--><!--]--> 部署 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="  前端  "><span class="title">  前端  </span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="  前端  "><span class="title">  前端  </span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/vue/" class="" aria-label="vue"><!--[--><!--]--> vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/node/" class="" aria-label="node"><!--[--><!--]--> node <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/chggx-knowlodge-vuepress/" class="" aria-label="  首页  "><!--[--><!--]-->   首页   <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="  JAVA  "><span class="title">  JAVA  </span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="  JAVA  "><span class="title">  JAVA  </span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/java/java-base/" class="" aria-label="Java基础"><!--[--><!--]--> Java基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/java/java-advence/" class="" aria-label="Java进阶"><!--[--><!--]--> Java进阶 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/java/framework/" class="router-link-active" aria-label="框架"><!--[--><!--]--> 框架 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/java/until/" class="" aria-label="工具"><!--[--><!--]--> 工具 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="  数据库  "><span class="title">  数据库  </span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="  数据库  "><span class="title">  数据库  </span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/sql/mysql" class="" aria-label="mysql"><!--[--><!--]--> mysql <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Redis</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/redis/1.Redis%E5%85%A5%E9%97%A8.html" class="" aria-label="Redis入门"><!--[--><!--]--> Redis入门 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/redis/2.Redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html" class="" aria-label="Redis数据类型"><!--[--><!--]--> Redis数据类型 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/redis/3.Redis%E4%BA%8B%E5%8A%A1.html" class="" aria-label="Redis事务"><!--[--><!--]--> Redis事务 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/redis/4.Redis%E5%AE%9E%E7%8E%B0%E4%B9%90%E8%A7%82%E9%94%81.html" class="" aria-label="Redis实现乐观锁"><!--[--><!--]--> Redis实现乐观锁 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/redis/5.Redis-Jedis.html" class="" aria-label="Redis-Jedis"><!--[--><!--]--> Redis-Jedis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/redis/6.SpringBoot%E6%95%B4%E5%90%88.html" class="" aria-label="SpringBoot整合"><!--[--><!--]--> SpringBoot整合 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/redis/7.Redis%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3.html" class="" aria-label="Redis的配置文件详解"><!--[--><!--]--> Redis的配置文件详解 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/redis/Redis%E9%9D%A2%E8%AF%95%E5%BF%85%E5%A4%87.html" class="" aria-label="Redis面试必备"><!--[--><!--]--> Redis面试必备 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>influxdb</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/influxdb/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93-influxdb1.x%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html" class="" aria-label="时序数据库-influxdb1.x 快速入门"><!--[--><!--]--> 时序数据库-influxdb1.x 快速入门 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/sql/influxdb/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93-influxdb2.x%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html" class="" aria-label="时序数据库-influxdb2.x 快速入门"><!--[--><!--]--> 时序数据库-influxdb2.x 快速入门 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="  搜索引擎  "><span class="title">  搜索引擎  </span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="  搜索引擎  "><span class="title">  搜索引擎  </span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ElasticSearch</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/chggx-knowlodge-vuepress/search/elasticSearch/ElasticSearch7.6.1%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html" class="" aria-label="ElasticSearch7.6.1快速入门"><!--[--><!--]--> ElasticSearch7.6.1快速入门 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="  中间件  "><span class="title">  中间件  </span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="  中间件  "><span class="title">  中间件  </span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/mq/mysql" class="" aria-label="RabbitMQ"><!--[--><!--]--> RabbitMQ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="  部署运维  "><span class="title">  部署运维  </span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="  部署运维  "><span class="title">  部署运维  </span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/mq/mysql" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/mq/mysql" class="" aria-label="虚拟机"><!--[--><!--]--> 虚拟机 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/mq/mysql" class="" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="  问题汇总  "><span class="title">  问题汇总  </span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="  问题汇总  "><span class="title">  问题汇总  </span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/mq/mysql" class="" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/mq/mysql" class="" aria-label="数据库"><!--[--><!--]--> 数据库 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/mq/mysql" class="" aria-label="部署"><!--[--><!--]--> 部署 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="  前端  "><span class="title">  前端  </span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="  前端  "><span class="title">  前端  </span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/vue/" class="" aria-label="vue"><!--[--><!--]--> vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/chggx-knowlodge-vuepress/node/" class="" aria-label="node"><!--[--><!--]--> node <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">Spring <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/chggx-knowlodge-vuepress/java/framework/spring/0.%E5%8F%8D%E5%B0%84&amp;%E6%B3%A8%E8%A7%A3.html" class="sidebar-item" aria-label="反射&amp;注解"><!--[--><!--]--> 反射&amp;注解 <!--[--><!--]--></a><!----></li><li><a href="/chggx-knowlodge-vuepress/java/framework/spring/1.Spring%E5%9F%BA%E7%A1%80.html" class="sidebar-item" aria-label="Spring基础"><!--[--><!--]--> Spring基础 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">SpringBoot <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/chggx-knowlodge-vuepress/java/framework/springboot/1.SpringBoot%E5%9F%BA%E7%A1%80.html" class="sidebar-item" aria-label="SpringBoot基础"><!--[--><!--]--> SpringBoot基础 <!--[--><!--]--></a><!----></li><li><a href="/chggx-knowlodge-vuepress/java/framework/springboot/2.SpringBoot%E6%95%B4%E5%90%88RabbitMQ.html" class="sidebar-item" aria-label="SpringBoot整合RabbitMQ"><!--[--><!--]--> SpringBoot整合RabbitMQ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active collapsible">SpringCloud <span class="down arrow"></span></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/chggx-knowlodge-vuepress/java/framework/springcloud/1.SpringCloud.H%E5%9F%BA%E7%A1%80.html" class="sidebar-item" aria-label="SpringCloud.H基础"><!--[--><!--]--> SpringCloud.H基础 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="SpringCloud Alibaba 官网"><!--[--><!--]--> SpringCloud Alibaba 官网 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_1-springcloud-alibaba入门简介" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. SpringCloud Alibaba入门简介"><!--[--><!--]--> 1. SpringCloud Alibaba入门简介 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_1-为什么出现springcloud-alibaba" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.  为什么出现SpringCloud Alibaba"><!--[--><!--]--> 1.  为什么出现SpringCloud Alibaba <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_2-alibaba-能干什么" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. alibaba  能干什么?"><!--[--><!--]--> 2. alibaba  能干什么? <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_2-springcloud-alibaba-nacos-服务注册和配置中心" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. SpringCloud Alibaba Nacos 服务注册和配置中心 😄"><!--[--><!--]--> 2. SpringCloud Alibaba Nacos 服务注册和配置中心 😄 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_1-概述" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. 概述"><!--[--><!--]--> 1. 概述 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_2-nacos服务注册中心-官方文档" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. Nacos服务注册中心 官方文档"><!--[--><!--]--> 2. Nacos服务注册中心 官方文档 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_3-nacos作为服务配置中心-等同-eureka-config-bus" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. Nacos作为服务配置中心  ==等同: eureka+config+bus=="><!--[--><!--]--> 3. Nacos作为服务配置中心  ==等同: eureka+config+bus== <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_4-nacos集群和持久化" class="router-link-active router-link-exact-active sidebar-item" aria-label="4. Nacos集群和持久化"><!--[--><!--]--> 4. Nacos集群和持久化 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_3-springcloud-alibaba-sentinel-实现熔断与限流" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. SpringCloud Alibaba Sentinel 实现熔断与限流 😄"><!--[--><!--]--> 3. SpringCloud Alibaba Sentinel 实现熔断与限流 😄 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_1-sentinel-代替了-hystrix" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. Sentinel 代替了 Hystrix"><!--[--><!--]--> 1. Sentinel 代替了 Hystrix <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_2-案例" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. 案例"><!--[--><!--]--> 2. 案例 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_3-流控规则-官网-方法细粒度" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. 流控规则 官网 方法细粒度"><!--[--><!--]--> 3. 流控规则 官网 方法细粒度 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_4-降级规则-官网-方法细粒度" class="router-link-active router-link-exact-active sidebar-item" aria-label="4. 降级规则 官网 方法细粒度"><!--[--><!--]--> 4. 降级规则 官网 方法细粒度 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_5-热点key限流-官网-方法细粒度" class="router-link-active router-link-exact-active sidebar-item" aria-label="5. 热点key限流 😄 官网 方法细粒度"><!--[--><!--]--> 5. 热点key限流 😄 官网 方法细粒度 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_6-系统规则-官网-系统-应用整体-从入口座整体" class="router-link-active router-link-exact-active sidebar-item" aria-label="6. 系统规则 官网 系统(应用整体,从入口座整体)"><!--[--><!--]--> 6. 系统规则 官网 系统(应用整体,从入口座整体) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_7-sentinelresource" class="router-link-active router-link-exact-active sidebar-item" aria-label="7. @SentinelResource"><!--[--><!--]--> 7. @SentinelResource <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_8-服务通断" class="router-link-active router-link-exact-active sidebar-item" aria-label="8. 服务通断"><!--[--><!--]--> 8. 服务通断 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_9-规则持久化" class="router-link-active router-link-exact-active sidebar-item" aria-label="9. 规则持久化"><!--[--><!--]--> 9. 规则持久化 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_4-springcloud-alibaba-seata-处理分布式事务" class="router-link-active router-link-exact-active sidebar-item" aria-label="4. SpringCloud Alibaba Seata 处理分布式事务"><!--[--><!--]--> 4. SpringCloud Alibaba Seata 处理分布式事务 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_1-seate概述-官网" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. seate概述 官网"><!--[--><!--]--> 1. seate概述 官网 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/chggx-knowlodge-vuepress/java/framework/springcloud/2.SpringCloud%20Alibaba%E4%BB%8B%E7%BB%8D.html#_2-案例-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. 案例"><!--[--><!--]--> 2. 案例 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="springcloud-alibaba-官网" tabindex="-1"><a class="header-anchor" href="#springcloud-alibaba-官网" aria-hidden="true">#</a> SpringCloud Alibaba <a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md" target="_blank" rel="noopener noreferrer">官网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h1><h2 id="_1-springcloud-alibaba入门简介" tabindex="-1"><a class="header-anchor" href="#_1-springcloud-alibaba入门简介" aria-hidden="true">#</a> 1. SpringCloud Alibaba入门简介</h2><h3 id="_1-为什么出现springcloud-alibaba" tabindex="-1"><a class="header-anchor" href="#_1-为什么出现springcloud-alibaba" aria-hidden="true">#</a> 1. 为什么出现SpringCloud Alibaba</h3><ul><li>SpringCloud Netflix 项目进入维护 2018.12.12</li><li>https://spring.io/blog/2018/12/12/spring-cloud-greenwich-rc1-available-now</li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160327.png" alt=""></p><h3 id="_2-alibaba-能干什么" tabindex="-1"><a class="header-anchor" href="#_2-alibaba-能干什么" aria-hidden="true">#</a> 2. alibaba 能干什么?</h3><h4 id="_1-主要技术" tabindex="-1"><a class="header-anchor" href="#_1-主要技术" aria-hidden="true">#</a> 1. 主要技术</h4><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160334.png" alt=""></p><ol><li><p>服务限流降级：默认支持Servlet、Feign、RestTemplate、Dubbo和RocketMQ限流降级功能的接入，可以在运行时通过控制台实时修改限流降级规则，还支持查看限流降级Metrics监控。</p></li><li><p>服务注册与发现：适配SpringCloud服务注册与发现标准，默认集成了Ribbon的支持。</p></li><li><p>分布式配置管理：支持分布式系统中的外部化配置，配置更改时自动刷新。</p></li><li><p>消息驱动能力：基于SpringCloud Stream为微服务应用构建消息驱动能力。</p></li><li><p>阿里云对象存储：阿里云提供的海量、安全、低成本、高可靠的云存储服务。支持在任何应用、任何时间、任何地点存储和访问任意类型的数据。</p></li><li><p>分布式任务调度：提供秒级、精准、高可靠、高可用的定时（基于Cron表达式）任务调度任务。同时提供分布式的任务执行模型，如网格任务。网格任务支持海量子任务均匀分配到所有Worker（schedulerx-client）上执行。</p></li></ol><h4 id="_2-依赖" tabindex="-1"><a class="header-anchor" href="#_2-依赖" aria-hidden="true">#</a> 2. 依赖</h4><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.0.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-组件" tabindex="-1"><a class="header-anchor" href="#_3-组件" aria-hidden="true">#</a> 3.. 组件</h4><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160340.png" alt=""></p><h4 id="_4-学习资料" tabindex="-1"><a class="header-anchor" href="#_4-学习资料" aria-hidden="true">#</a> 4. 学习资料</h4><p><a href="https://spring.io/projects/spring-cloud-alibaba#overview" target="_blank" rel="noopener noreferrer">SpringCloud官网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, <a href="https://github.com/alibaba/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, <a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html" target="_blank" rel="noopener noreferrer">文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, <a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md" target="_blank" rel="noopener noreferrer">中文官网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="_2-springcloud-alibaba-nacos-服务注册和配置中心" tabindex="-1"><a class="header-anchor" href="#_2-springcloud-alibaba-nacos-服务注册和配置中心" aria-hidden="true">#</a> 2. SpringCloud Alibaba Nacos 服务注册和配置中心 😄</h2><h3 id="_1-概述" tabindex="-1"><a class="header-anchor" href="#_1-概述" aria-hidden="true">#</a> 1. 概述</h3><ul><li>注册中心: eureka,zookeeper,consul,nacos</li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160346.png" alt=""></p><ul><li>前四个字母分别为Naming和Configuration的前两个字母，最后的s为Service。</li></ul><h4 id="_1-是什么" tabindex="-1"><a class="header-anchor" href="#_1-是什么" aria-hidden="true">#</a> 1. 是什么?</h4><p>一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。</p><ul><li>Nacos：Dynamic Naming and Configuration Service</li><li>Nacos就是 注册中心 + 配置中心的组合</li><li>==Nacos = Eureka + Config + Bus==</li></ul><h4 id="_2-能干嘛" tabindex="-1"><a class="header-anchor" href="#_2-能干嘛" aria-hidden="true">#</a> 2. 能干嘛?</h4><ul><li>替代Eureka做服务<strong>注册中心</strong></li><li>替代Config做服务<strong>配置中心</strong></li></ul><h4 id="_3-去哪里下" tabindex="-1"><a class="header-anchor" href="#_3-去哪里下" aria-hidden="true">#</a> 3. 去哪里下?</h4><p><a href="https://github.com/alibaba/Nacos" target="_blank" rel="noopener noreferrer">github<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> , <a href="https://nacos.io/zh-cn/index.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, <a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_config" target="_blank" rel="noopener noreferrer">学习手册<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="_4-安装运行" tabindex="-1"><a class="header-anchor" href="#_4-安装运行" aria-hidden="true">#</a> 4. 安装运行</h4><ol><li><p>本地Java8 + Maven环境已经OK</p></li><li><p>先从官网下载Nacos</p></li><li><p>解压安装包，直接运行bin目录下的startup.cmd</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160351.png" alt=""></p></li><li><p>运行成功后直接访问 https://localhost:8848/nacos 默认账号密码都是nacos</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160356.png" alt=""></p></li></ol><p>linux</p><ol><li><p>tar zxvf nacos-server-1.1.4.tar.gz</p></li><li><p>bash startup.sh -m standalone (启动命令(standalone代表着单机模式运行，非集群模式):</p><p>sh startup.sh -m standalone)</p></li><li><p><em># MySQL配置</em></p><p>spring.datasource.platform=mysql</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker run -p 3306:3306 --name mysql -v /root/mysql/conf:/etc/mysql/conf.d -v /root/mysql/logs:/logs -v /root/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=326868 -d mysql:5.7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>db.num=1</p><p>db.url.0=jdbc:mysql://116.196.118.167:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true</p><p>db.user=root</p><p>db.password=326868</p></li></ol><h3 id="_2-nacos服务注册中心-官方文档" tabindex="-1"><a class="header-anchor" href="#_2-nacos服务注册中心-官方文档" aria-hidden="true">#</a> 2. Nacos服务注册中心 <a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><h4 id="_1-服务端" tabindex="-1"><a class="header-anchor" href="#_1-服务端" aria-hidden="true">#</a> 1. 服务端</h4><h5 id="_1-依赖" tabindex="-1"><a class="header-anchor" href="#_1-依赖" aria-hidden="true">#</a> 1. 依赖</h5><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--父工程引入spring cloud alibaba 2.1.0.RELEASE--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--springcloud alibaba nacos--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Nacos自带ribbon</strong></p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160404.png" alt=""></p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-配置" tabindex="-1"><a class="header-anchor" href="#_2-配置" aria-hidden="true">#</a> 2. 配置</h5><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9001</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#配置Nacos地址</span>

<span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">&#39;*&#39;</span>  <span class="token comment">#监控</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-主启动类-enablediscoveryclient" tabindex="-1"><a class="header-anchor" href="#_3-主启动类-enablediscoveryclient" aria-hidden="true">#</a> 3. 主启动类 <code>@EnableDiscoveryClient</code></h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentMain9001</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">PaymentMain9001</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-controler" tabindex="-1"><a class="header-anchor" href="#_4-controler" aria-hidden="true">#</a> 4. controler</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${server.port}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> serverPort<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/payment/nacos/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPayment</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;******result: &quot;</span><span class="token operator">+</span>serverPort<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;nacos registry,serverPort: &quot;</span><span class="token operator">+</span> serverPort<span class="token operator">+</span><span class="token string">&quot;\t id&quot;</span><span class="token operator">+</span>id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5-效果" tabindex="-1"><a class="header-anchor" href="#_5-效果" aria-hidden="true">#</a> 5. 效果</h5><p>nacos</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160410.png" alt=""></p><ul><li>新建9002 实现负载均衡</li><li>不想新建(采用下面方法)</li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160416.png" alt=""></p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160420.png" alt=""></p><h4 id="_2-客户端" tabindex="-1"><a class="header-anchor" href="#_2-客户端" aria-hidden="true">#</a> 2. 客户端</h4><h5 id="_1-配置" tabindex="-1"><a class="header-anchor" href="#_1-配置" aria-hidden="true">#</a> 1. 配置</h5><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">83</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>order<span class="token punctuation">-</span>consumer
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment"># 注册中心Nacos配置</span>

<span class="token comment">#消费者将要去访问的微服务名称（成功注册进nacos的微服务提供者），在这配置了访问的服务，业务类就不用在定义常量了</span>
<span class="token key atrule">service-url</span><span class="token punctuation">:</span>
  <span class="token key atrule">nacos-user-service</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-启动类" tabindex="-1"><a class="header-anchor" href="#_2-启动类" aria-hidden="true">#</a> 2. 启动类</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderNacosMain83</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">OrderNacosMain83</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * RestTemplate结合Ribbon做负载均衡一定要加@LoadBalanced
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@LoadBalanced</span>
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">getRestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-controller" tabindex="-1"><a class="header-anchor" href="#_3-controller" aria-hidden="true">#</a> 3. controller</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderNacosController</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 因为在yml中配置了service-url.nacos-user-service，
     * 这里不需要再定义要访问微服务名常量，而是通过boot直接读出来
     */</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${service-url.nacos-user-service}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> serverURL<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * Nacos测试Ribbon
     * http://localhost:83/consumer/payment/nacos/1
     * <span class="token keyword">@param</span> <span class="token parameter">id</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/payment/nacos/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">paymentInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;******serverURL: {}, id: {}&quot;</span> <span class="token operator">+</span> serverURL<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>serverURL <span class="token operator">+</span> <span class="token string">&quot;/payment/nacos/&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-结果" tabindex="-1"><a class="header-anchor" href="#_4-结果" aria-hidden="true">#</a> 4. 结果</h5><p>http://localhost:83/consumer/payment/nacos/1</p><p>轮询访问 9001,9002,9011</p><h4 id="_3-服务中心的对比" tabindex="-1"><a class="header-anchor" href="#_3-服务中心的对比" aria-hidden="true">#</a> 3. 服务中心的对比</h4><h5 id="_1-nacos" tabindex="-1"><a class="header-anchor" href="#_1-nacos" aria-hidden="true">#</a> 1. nacos</h5><p>Nacos地图</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160428.jpg" alt=""></p><p><strong>Nacos生态图</strong></p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160432.png" alt=""></p><p>如 Nacos 全景图所示，Nacos 无缝支持一些主流的开源生态，例如</p><ul><li><a href="https://nacos.io/en-us/docs/quick-start-spring-cloud.html" target="_blank" rel="noopener noreferrer">Spring Cloud<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://nacos.io/zh-cn/docs/xx" target="_blank" rel="noopener noreferrer">Apache Dubbo and Dubbo Mesh TODO<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://nacos.io/zh-cn/docs/xx" target="_blank" rel="noopener noreferrer">Kubernetes and CNCF TODO<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</li><li>......</li></ul><h5 id="_2-对比" tabindex="-1"><a class="header-anchor" href="#_2-对比" aria-hidden="true">#</a> 2. 对比</h5><p>Nacos与其他注册中心特性对比</p><table><thead><tr><th></th><th>Nacos</th><th>Eureka</th><th>Consul</th><th>Zookeeper</th><th>CoreDNS</th></tr></thead><tbody><tr><td>一致性协议</td><td>CP+AP</td><td>AP</td><td>CP</td><td>CP</td><td>/</td></tr><tr><td>健康状态</td><td>TCP/HTTP/MYSQL/Client Beat</td><td>Client Beat</td><td>TCP/HTTPgRPC</td><td>Client Beat</td><td>/</td></tr><tr><td>负载均衡</td><td>权重/DSL/metadata/CMDB</td><td>Ribbon</td><td>Fabio</td><td>/</td><td>RR</td></tr><tr><td>雪崩效应</td><td>支持</td><td>支持</td><td>不支持</td><td>不支持</td><td>不支持</td></tr><tr><td>自动注销实例</td><td>支持</td><td>支持</td><td>不支持</td><td>支持</td><td>不支持</td></tr><tr><td>访问协议</td><td>HTTP/DNS/UDP</td><td>HTTP</td><td>HTTP/DNS</td><td>TCP</td><td>DNS</td></tr><tr><td>监听支持</td><td>支持</td><td>支持</td><td>支持</td><td>支持</td><td>不支持</td></tr><tr><td>多数据中心</td><td>支持</td><td>支持</td><td>支持</td><td>不支持</td><td>不支持</td></tr><tr><td>跨注册中心</td><td>支持</td><td>不支持</td><td>支持</td><td>不支持</td><td>不支持</td></tr><tr><td>SpringCloud集成</td><td>支持</td><td>支持</td><td>支持</td><td>不支持</td><td>不支持</td></tr><tr><td>Dubbo集成</td><td>支持</td><td>不支持</td><td>不支持</td><td>支持</td><td>不支持</td></tr><tr><td>K8s集成</td><td>支持</td><td>不支持</td><td>支持</td><td>不支持</td><td>支持</td></tr></tbody></table><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160438.jpg" alt=""></p><h5 id="_3-nacos的ap与cp切换" tabindex="-1"><a class="header-anchor" href="#_3-nacos的ap与cp切换" aria-hidden="true">#</a> 3. Nacos的AP与CP切换 😄</h5><p>==C是所有节点在同一时间看到的数据是一致的；而A的定义是所有的请求都会受到响应。==</p><p>何时选择使用何种模式？</p><p>一般来说，如果不需要存储服务级别的信息且服务实例是通过nacos-client注册，并能够保持心跳上报，那么就可以选择AP模式。当前主流的服务如SpringCloud和Dubbo服务，都适用与AP模式，AP模式为了服务的可能性而减弱了一致性，因此==AP模式下只支持注册临时实例。==</p><p>如果需要在服务级别编辑或存储配置信息，那么CP是必须，K8S服务和DNS服务则适用于CP模式。==CP模式下则支持注册持久化实例，==此时则是以Raft协议为集群运行模式，该模式下注册实例之前必须先注册服务，如果服务不出存在，则会返回错误。</p><p>==<strong>模式的切换</strong>==</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>用下面命令切换
curl <span class="token operator">-</span><span class="token class-name">X</span> <span class="token constant">PUT</span> &#39;$<span class="token constant">NACOS_SERVER</span><span class="token operator">:</span><span class="token number">8848</span><span class="token operator">/</span>nacos<span class="token operator">/</span>v1<span class="token operator">/</span>ns<span class="token operator">/</span>operator<span class="token operator">/</span>switches<span class="token operator">?</span>entry<span class="token operator">=</span>serverMode<span class="token operator">&amp;</span>value<span class="token operator">=</span><span class="token constant">CP</span>&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-nacos作为服务配置中心-等同-eureka-config-bus" tabindex="-1"><a class="header-anchor" href="#_3-nacos作为服务配置中心-等同-eureka-config-bus" aria-hidden="true">#</a> 3. Nacos作为服务配置中心 ==<sup>等同: eureka+config+bus</sup>==</h3><h4 id="_1-基础配置操作" tabindex="-1"><a class="header-anchor" href="#_1-基础配置操作" aria-hidden="true">#</a> 1. 基础配置操作</h4><ol><li>依赖</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>配置文件(同SpringCloud Config bootstrap.yml 和 application.yml) <ul><li>Nacos同springcloud-config一样，在项目初始化时，要保证先从配置中心进行配置拉取，拉取配置后，才能保证项目的正常启动。</li><li>SpringCloud中配置文件的加载是存在优先级顺序的，bootstrap优先级高于application</li></ul></li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">#application.yml  [bootstrap.yml 优先级高于 application.yml]</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment">#开发环境</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">#bootstrap.xml</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3377</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>client
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#Nacos服务注册中心地址</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#Nacos作为配置中心地址</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yml  <span class="token comment">#指定yaml格式的配置</span>

<span class="token comment"># ${spring.application.name}-${spring.profile.active}.${spring.cloud.nacos.config.file.extension}</span>
<span class="token comment"># nacos-config-client-dev.yml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>启动类</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosConfigClientMain3377</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">NacosConfigClientMain3377</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>业务 <code>@RefreshScope </code> SpringCloud原生注解 支持Nacos的动态刷新功能</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Slf4j
@RestController
@RefreshScope 
public class ConfigClientController {

    @Value(&quot;${config.info}&quot;)
    private String configInfo;

    @GetMapping(&quot;/config/info&quot;)
    public String getConfigInfo(){
        log.info(&quot;******configInfo: {}, time: {}&quot;,configInfo,new Date());
        return configInfo;
    }
    
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li><p>启动前</p><ul><li><p>保证yaml启动文件有</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160445.png" alt=""></p></li><li><p>运行启动类</p></li></ul></li><li><p>结果</p></li></ol><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160451.png" alt=""></p><p>结果: 当修改配置文件时候,刷新页面==自动刷新配置信息==(没有SpringCloud Config的一系列解决[Config+Bus])</p><h4 id="_2-在nacos中添加配置信息" tabindex="-1"><a class="header-anchor" href="#_2-在nacos中添加配置信息" aria-hidden="true">#</a> 2. 在Nacos中添加配置信息</h4><p><code>理论：Nacos中的匹配规则 </code> <a href="https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html" target="_blank" rel="noopener noreferrer">官网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> Nacos中的dataid的组成格式及与SpringBoot配置文件中的匹配规则</p><p>在 Nacos Spring Cloud 中，<code>dataId</code> 的完整格式如下：</p><div class="language-plain ext-plain line-numbers-mode"><pre class="language-plain"><code>${prefix}-${spring.profile.active}.${file-extension}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><code>prefix</code> 默认为 <code>spring.application.name</code> 的值，也可以通过配置项 <code>spring.cloud.nacos.config.prefix</code>来配置。</li><li><code>spring.profile.active</code> 即为当前环境对应的 profile，详情可以参考 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-profiles.html#boot-features-profiles" target="_blank" rel="noopener noreferrer">Spring Boot文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。 <strong>注意：当 <code>spring.profile.active</code> 为空时，对应的连接符 <code>-</code> 也将不存在，dataId 的拼接格式变成 <code>${prefix}.${file-extension}</code></strong></li><li><code>file-exetension</code> 为配置内容的数据格式，可以通过配置项 <code>spring.cloud.nacos.config.file-extension</code> 来配置。目前只支持 <code>properties</code> 和 <code>yaml</code> 类型。</li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160456.png" alt=""></p><p>Nacos中配置</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160501.png" alt=""></p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160513.png" alt=""><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160517.png" alt=""></p><h4 id="_3-分类配置" tabindex="-1"><a class="header-anchor" href="#_3-分类配置" aria-hidden="true">#</a> 3. 分类配置</h4><h5 id="_1-多环境多项目管理" tabindex="-1"><a class="header-anchor" href="#_1-多环境多项目管理" aria-hidden="true">#</a> 1. 多环境多项目管理</h5><ul><li>问题1： 实际开发中，通常一个系统会准备dev开发环境、test测试环境、prod生产环境，如何保证指定环境启动时服务能正确读取到Nacos上相应环境的配置文件呢？</li><li>问题2： 一个大型分布式微服务系统会有很多微服务子项目，每个微服务项目又会有相应的开发环境、测试环境、预发环境、正式环境…那怎么对这些微服务配置进行管理呢？</li></ul><h5 id="_2-nacos界面" tabindex="-1"><a class="header-anchor" href="#_2-nacos界面" aria-hidden="true">#</a> 2. Nacos界面</h5><p>配置管理</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160527.png" alt=""></p><p>命名空间</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160534.png" alt=""></p><h5 id="_3-namespace-group-data-id三者关系-为什么这么设计" tabindex="-1"><a class="header-anchor" href="#_3-namespace-group-data-id三者关系-为什么这么设计" aria-hidden="true">#</a> 3. Namespace + Group + Data ID三者关系？为什么这么设计？</h5><h6 id="_1-是什么-1" tabindex="-1"><a class="header-anchor" href="#_1-是什么-1" aria-hidden="true">#</a> 1. 是什么?</h6><p>类似Java中的package名和类名 ==最外层的namespace是可以用于区分部署环境的，Group和DataID逻辑上区分两个目标对象==</p><h6 id="_2-三者情况" tabindex="-1"><a class="header-anchor" href="#_2-三者情况" aria-hidden="true">#</a> 2. 三者情况</h6><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160540.png" alt=""></p><p>默认情况： ==Namespace=public，Group=DEFAULT_GROUP，默认Cluster是DEFAULT==</p><ul><li><p><strong>Nacos默认的命名空间是public</strong>，Namespace主要用来实现==<strong>隔离设计</strong>== 比方说我们现在有三个环境：开发、测试、生产环境，我们就可以创建三个Namespace，不同的Namespace之间是隔离的。</p></li><li><p>Group默认是DEFAULT_GROUP，Group可以把不同的微服务划分到同一个分组里面去</p></li><li><p><strong>Service就是微服务</strong>，一个Service可以包含多个Cluster（集群）,Nacos默认Cluster是DEFAULT，Cluster是对指定微服务的一个虚拟划分 比方说为了容灾，将Service微服务分别部署在了杭州机房和广州机房，这时就可以给杭州机房的Service微服务起一个集群名称（HZ）给广州机房的Service微服务起一个集群名称（GZ），还可以尽量让同一个机房的微服务互相调用，以提升性能。(划片划分)</p></li></ul><p>最后是Instance，就是微服务的实例。</p><h4 id="_4-三种方案-分类配置" tabindex="-1"><a class="header-anchor" href="#_4-三种方案-分类配置" aria-hidden="true">#</a> 4. 三种方案 (分类配置)</h4><h5 id="_1-dataid方案" tabindex="-1"><a class="header-anchor" href="#_1-dataid方案" aria-hidden="true">#</a> 1. DataID方案</h5><ul><li><p>指定spring.profile.active和配置文件的DataID来使不同环境下读取不同的配置</p></li><li><p>默认空间 + 默认分组 + 新建dev和test两个DataID</p></li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160546.png" alt=""></p><ul><li>修改application.yml</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">#application.yml  [bootstrap.yml 优先级高于 application.yml]</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
<span class="token comment">#    active: dev #开发环境</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> test <span class="token comment">#测试环境</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>测试 (配置什么,加载什么)</li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160553.png" alt=""></p><h5 id="_2-group方案" tabindex="-1"><a class="header-anchor" href="#_2-group方案" aria-hidden="true">#</a> 2. Group方案</h5><ul><li>通过Group实现环境区分</li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160602.png" alt=""></p><ul><li>配置修改</li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160608.png" alt=""></p><ul><li>测试</li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160613.png" alt=""></p><h5 id="_3-namespace-方案" tabindex="-1"><a class="header-anchor" href="#_3-namespace-方案" aria-hidden="true">#</a> 3. Namespace 方案</h5><ol><li>新增命名空间</li></ol><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160620.png" alt=""></p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160624.png" alt=""></p><ol start="2"><li>配置config</li></ol><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160629.png" alt=""></p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160637.png" alt=""></p><ul><li><p>测试</p></li><li><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>file-extension: yml  #指定yaml格式的配置
group: TEST_GROUP # 指定组名
namespace: af21dbe7-d7d7-45ac-866f-c9d49370c213 # 指定命名空间 dev: af21dbe7-d7d7-45ac-866f-c9d49370c213
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="_5-扩展id" tabindex="-1"><a class="header-anchor" href="#_5-扩展id" aria-hidden="true">#</a> 5. 扩展ID</h4><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160642.png" alt=""></p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160653.png" alt=""></p><h3 id="_4-nacos集群和持久化" tabindex="-1"><a class="header-anchor" href="#_4-nacos集群和持久化" aria-hidden="true">#</a> 4. Nacos集群和持久化</h3><h4 id="_1-集群" tabindex="-1"><a class="header-anchor" href="#_1-集群" aria-hidden="true">#</a> 1. <a href="https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html" target="_blank" rel="noopener noreferrer"> 集群<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h5 id="" tabindex="-1"><a class="header-anchor" href="#" aria-hidden="true">#</a> <img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160657.png" alt=""></h5><p>**默认Nacos使用嵌入式数据库（derby）**实现数据的存储。所以，如果启动多个默认配置下的Nacos节点，数据存储是存在一致性问题的。 为了解决这个问题，==<strong>Nacos采用了集中式存储的方式来支持集群化部署，目前只支持Mysql的存储。</strong>==</p><p><a href="https://nacos.io/zh-cn/docs/deployment.html" target="_blank" rel="noopener noreferrer">Nacos支持三种部署模式<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><ul><li>单机模式：用于测试和单机试用</li><li>集群模式：用于生产环境，确保高可用</li><li>多集群模式：用于多数据中心场景</li></ul><h4 id="_2-持久化切换配置" tabindex="-1"><a class="header-anchor" href="#_2-持久化切换配置" aria-hidden="true">#</a> 2. 持久化切换配置</h4><ul><li>默认Nacos使用嵌入式数据库（derby)</li></ul><h5 id="_1-derby到mysql切换配置步骤" tabindex="-1"><a class="header-anchor" href="#_1-derby到mysql切换配置步骤" aria-hidden="true">#</a> 1. derby到mysql切换配置步骤</h5><ol><li>nacos-server-1.1.4\nacos\conf 目录下执行sql脚本 <code>nacos-mysql.sql</code></li><li>nacos-server-1.1.4\nacos\conf 目录下找到<code>application.properties</code>，添加配置：</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>spring.datasource.platform=mysql
db.num=1
db.url.0=jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true
db.user=xxx
db.password=xxx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-mysql生产环境配置" tabindex="-1"><a class="header-anchor" href="#_2-mysql生产环境配置" aria-hidden="true">#</a> 2. MYSQL生产环境配置</h5><h6 id="_1-预计需要-1个ngnix-3个nacos注册中心-1个mysql" tabindex="-1"><a class="header-anchor" href="#_1-预计需要-1个ngnix-3个nacos注册中心-1个mysql" aria-hidden="true">#</a> 1. 预计需要,1个ngnix+3个nacos注册中心+1个MySQL</h6><h6 id="_2-配置nacos-linux" tabindex="-1"><a class="header-anchor" href="#_2-配置nacos-linux" aria-hidden="true">#</a> 2. 配置nacos(linux)</h6><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160705.png" alt=""></p><h6 id="_3-配置" tabindex="-1"><a class="header-anchor" href="#_3-配置" aria-hidden="true">#</a> 3. 配置</h6><ul><li><p>linux上MYSQL配置</p></li><li><p>application.properties配置</p></li><li><p>linux上的nacos的集群配置cluster.conf</p><ul><li>三台nacos,不同端口号</li><li>复制出cluster.conf</li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160712.png" alt=""></p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160721.png" alt=""></p><ul><li><p>内容</p><p>在 &quot;/mynacos/nacos/bin “ 目录下startup.sh</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160729.png" alt=""></p><p>修改</p></li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/alibaba-Nacos34.png?x-oss-process=style/shuiyin_1" alt=""></p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/alibaba-Nacos35.png?x-oss-process=style/shuiyin_1" alt=""></p><p>结果 ==修改 &quot;#&quot; 为 &quot; $&quot;==</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160746.png" alt=""></p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160749.png" alt=""></p></li></ul><p>​ 执行方式</p><p>​ ./startup.sh -p 3333 Ubuntu : bash startup.sh -p 3333</p><p>​ <img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160755.png" alt=""></p><h6 id="_4-ngnix配置-负载均衡" tabindex="-1"><a class="header-anchor" href="#_4-ngnix配置-负载均衡" aria-hidden="true">#</a> 4. ngnix配置 负载均衡</h6><p>/opt/nginx-1.17.9/conf</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160800.png" alt=""></p><p>启动</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./ngnix <span class="token parameter variable">-c</span> /opt/nginx-1.17.9/conf/ngnix.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h6 id="_5-测试" tabindex="-1"><a class="header-anchor" href="#_5-测试" aria-hidden="true">#</a> 5. 测试</h6><ul><li><p>nacos 集群启动</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160807.png" alt=""></p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160812.png" alt=""></p></li><li><p>ngnix启动 https://www.cnblogs.com/gede/p/11011693.html</p></li></ul><div class="language-conf ext-conf line-numbers-mode"><pre class="language-conf"><code>nginx文件安装完成之后的文件位置：

/usr/sbin/nginx：主程序
/etc/nginx：存放配置文件
/usr/share/nginx：存放静态文件
/var/log/nginx：存放日志

# 彻底卸载nginx
apt-get --purge autoremove nginx

service nginx start


# naccos集群配置
    upstream cluster{
        server 116.196.118.167:3333;
        server 116.196.118.167:4444;
        server 116.196.118.167:5555;
    }


    server {
        listen       1111;
        server_name  16.196.118.167;

        location / {
            #root   html;
            #index  index.html index.htm;
            proxy_pass http://cluster;
        }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>结果</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160830.png" alt="">*</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160834.png" alt=""></p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160838.png" alt=""></p></li></ul><p>linux http://116.196.118.167:1111/nacos/ (测试3台Nacos+1台Ngnix+1台MySQL)</p><p>客户端访问先访问NGINX.</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160843.png" alt=""></p><hr><h2 id="_3-springcloud-alibaba-sentinel-实现熔断与限流" tabindex="-1"><a class="header-anchor" href="#_3-springcloud-alibaba-sentinel-实现熔断与限流" aria-hidden="true">#</a> 3. SpringCloud Alibaba Sentinel 实现熔断与限流 😄</h2><h3 id="_1-sentinel-代替了-hystrix" tabindex="-1"><a class="header-anchor" href="#_1-sentinel-代替了-hystrix" aria-hidden="true">#</a> 1. <a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">Sentinel<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 代替了 Hystrix</h3><ul><li><p><a href="https://github.com/alibaba/Sentinel/releases" target="_blank" rel="noopener noreferrer">下载地址<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="https://blog.csdn.net/qq_29635485/article/details/103100251?depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-2&amp;utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-2" target="_blank" rel="noopener noreferrer">linux docker安装<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p>==面向云原生微服务的<strong>高可用流控防护组件</strong>==</p></li><li><p>==分布式系统的流量防卫兵==</p></li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160851.png" alt=""></p><h4 id="_1-sentinel" tabindex="-1"><a class="header-anchor" href="#_1-sentinel" aria-hidden="true">#</a> 1. Sentinel</h4><p>特性</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160856.png" alt=""></p><ul><li>服务雪崩</li><li>服务降级</li><li>服务熔断</li><li>服务限流</li></ul><p>生态图</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160901.png" alt=""></p><h4 id="_2-sentinel分为两个部分" tabindex="-1"><a class="header-anchor" href="#_2-sentinel分为两个部分" aria-hidden="true">#</a> 2. Sentinel分为两个部分：</h4><ul><li><strong>核心库</strong>（Java客户端）不依赖任何框架/库，能够运行于所有Java运行时环境，同时对Dubbo/Spring Cloud等框架也有较好的支持。</li><li><strong>控制台</strong>（Dashboard）基于SpringBoot开发，打包后可以直接运行，不需要额外的Tomcat等应用容器。</li></ul><h4 id="_3-sentinel下载" tabindex="-1"><a class="header-anchor" href="#_3-sentinel下载" aria-hidden="true">#</a> 3. sentinel下载</h4><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>java <span class="token punctuation">-</span>jar sentinel<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>1.7.1.jar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160907.png" alt=""></p><p>访问</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160912.png" alt=""></p><p>用户: sentinel 密码: sentinel</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160918.png" alt=""></p><p>容错,限流,监控平台成功.(比Hystrix方便)</p><h3 id="_2-案例" tabindex="-1"><a class="header-anchor" href="#_2-案例" aria-hidden="true">#</a> 2. 案例</h3><h4 id="_1-依赖-1" tabindex="-1"><a class="header-anchor" href="#_1-依赖-1" aria-hidden="true">#</a> 1. 依赖</h4><ul><li>springcloud alibaba sentinel</li></ul><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--springcloud alibaba nacos--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--springcloud alibaba sentinel-datasource-nacos 后续做持久化用到--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--springcloud alibaba sentinel--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-准备" tabindex="-1"><a class="header-anchor" href="#_2-准备" aria-hidden="true">#</a> 2. 准备</h4><ul><li>注册中心</li><li>sentinel启动</li></ul><h4 id="_3-测试" tabindex="-1"><a class="header-anchor" href="#_3-测试" aria-hidden="true">#</a> 3 测试</h4><ol><li><p>启动后,空空如也 ==sentinel采用了<strong>懒加载</strong>==</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160931.png" alt=""></p></li><li><p>需要执行一次访问,才能访问?</p><ul><li>http://localhost:8401/testA</li><li>http://localhost:8401/testB</li></ul></li></ol><p>​ <img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160936.png" alt=""></p><ol start="3"><li>sentinel8080正在监控8401</li></ol><h3 id="_3-流控规则-官网-方法细粒度" tabindex="-1"><a class="header-anchor" href="#_3-流控规则-官网-方法细粒度" aria-hidden="true">#</a> 3. 流控规则 官网 <sup>方法细粒度</sup></h3><ul><li>流量限制,控制</li></ul><h4 id="_1-基本介绍" tabindex="-1"><a class="header-anchor" href="#_1-基本介绍" aria-hidden="true">#</a> 1. 基本介绍</h4><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160941.png" alt=""></p><ol><li><p>资源名：唯一名称，默认请求路径</p></li><li><p>针对来源：Sentinel可以针对调用者进行限流，填写微服务名，默认default（不区分来源）</p></li><li><p>阈值类型/单机阈值：</p><ul><li>QPS（每秒钟的请求数量）：当调用该api的QPS达到阈值的时候，进行限流</li><li>线程数：当调用该api的线程数达到阈值的时候，进行限流</li></ul></li><li><p>是否集群：（不）需要集群</p></li><li><p>流控模式：</p><ul><li>直接：api达到限流条件时，直接限流</li><li>关联：当关联的资源达到阈值时，就限流自己</li><li>链路：只记录指定链路上的流量（指定资源从入口资源进来的流量，如果达到阈值，就进行限流）</li></ul></li><li><p>流控效果：</p><ul><li>快速失败：直接失败，抛异常</li><li>Warm Up：根据codeFactor（冷加载因子，默认3）的值，从阈值/codeFactor，经过预热时长，才达到设置的QPS阈值。</li><li>排队等待：匀速排队，让请求以匀速的速度通过，阈值类型必须设置为QPS。否则无效。</li></ul></li></ol><h4 id="_2-流控模式-官网-方法细粒度" tabindex="-1"><a class="header-anchor" href="#_2-流控模式-官网-方法细粒度" aria-hidden="true">#</a> 2. 流控模式 <a href="https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6" target="_blank" rel="noopener noreferrer">官网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <sup>方法细粒度</sup></h4><h5 id="_1-流控模式——直接-默认" tabindex="-1"><a class="header-anchor" href="#_1-流控模式——直接-默认" aria-hidden="true">#</a> 1. 流控模式——直接(默认)</h5><h6 id="_1-qps" tabindex="-1"><a class="header-anchor" href="#_1-qps" aria-hidden="true">#</a> 1. QPS</h6><ul><li><p>快速失败</p></li><li><p>规则: 每秒只能访问1次,超过一次==限流==</p></li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160946.png" alt=""></p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160951.png" alt=""></p><p>思考: 直接调用默认的报错信息,技术方面OK,但是,是否应哎呦我们自己的后续处理? 类似于Hystrix的==fallback的兜底方法==?</p><h6 id="_2-线程数" tabindex="-1"><a class="header-anchor" href="#_2-线程数" aria-hidden="true">#</a> 2. 线程数：</h6><ul><li>直接失败</li></ul><p>当调用该api的线程数达到阈值的时候，进行限流</p><h5 id="_2-关联-快速失败" tabindex="-1"><a class="header-anchor" href="#_2-关联-快速失败" aria-hidden="true">#</a> 2. 关联 -<strong>快速失败</strong></h5><ul><li>支付下订单: 支付达到峰值,让下订单系统降级</li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160956.png" alt=""></p><p>postman测试</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161000.png" alt=""></p><ul><li>当有大量并发请求打到B上，A就限流自己。</li></ul><h4 id="_3-流控效果-官网" tabindex="-1"><a class="header-anchor" href="#_3-流控效果-官网" aria-hidden="true">#</a> 3. 流控效果 <a href="https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6" target="_blank" rel="noopener noreferrer">官网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h5 id="_1-直接" tabindex="-1"><a class="header-anchor" href="#_1-直接" aria-hidden="true">#</a> 1. 直接</h5><h5 id="_2-warm-up-预热" tabindex="-1"><a class="header-anchor" href="#_2-warm-up-预热" aria-hidden="true">#</a> 2. Warm Up(预热)</h5><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161007.png" alt=""></p><h5 id="_3-排队等待" tabindex="-1"><a class="header-anchor" href="#_3-排队等待" aria-hidden="true">#</a> 3. 排队等待</h5><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161012.png" alt=""></p><h3 id="_4-降级规则-官网-方法细粒度" tabindex="-1"><a class="header-anchor" href="#_4-降级规则-官网-方法细粒度" aria-hidden="true">#</a> 4. 降级规则 <a href="https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7" target="_blank" rel="noopener noreferrer">官网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <sup>方法细粒度</sup></h3><ul><li>==同Hystrix==</li></ul><h4 id="_1-基本使用" tabindex="-1"><a class="header-anchor" href="#_1-基本使用" aria-hidden="true">#</a> 1. 基本使用</h4><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161017.png" alt=""></p><ol><li>RT (平均时间,秒级) <ul><li>平均响应时间<strong>超出阈值</strong>,且在<strong>时间窗口内通过的请求&gt;=5</strong>,两个条件同时满足后出发==降级==,窗口期过后关闭断路器</li><li>RT最大4900(跟大的需要通过-Dcsp.sentinel.statistic.max.rt=xxxx才能生效)</li></ul></li><li>异常比例(秒级) <ul><li>QPS &gt;= 5 且 异常比例(秒级统计)超过阈值,出发降级;时间窗口结束后,关闭降级</li></ul></li><li>异常数(分钟级) <ul><li>异常数(分钟统计)超过阈值是,触发降级;时间窗口结束后,关闭降级.</li></ul></li></ol><h4 id="_2-进一步说明" tabindex="-1"><a class="header-anchor" href="#_2-进一步说明" aria-hidden="true">#</a> 2. 进一步说明</h4><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161023.png" alt=""></p><ul><li>sentinel的短路器是没有半开状态的(Hystrix有三个)</li></ul><h4 id="_3-测试-1" tabindex="-1"><a class="header-anchor" href="#_3-测试-1" aria-hidden="true">#</a> 3. 测试</h4><h5 id="_1" tabindex="-1"><a class="header-anchor" href="#_1" aria-hidden="true">#</a> 1.</h5><p>平均响应时间 (<code>DEGRADE_GRADE_RT</code>)：当 1s 内持续进入 5 个请求，对应时刻的平均响应时间（秒级）均超过阈值（<code>count</code>，以 ms 为单位），那么在接下的时间窗口（<code>DegradeRule</code> 中的 <code>timeWindow</code>，以 s 为单位）之内，对这个方法的调用都会自动地熔断（抛出 <code>DegradeException</code>）。注意 Sentinel 默认统计的 RT 上限是 4900 ms，<strong>超出此阈值的都会算作 4900 ms</strong>，若需要变更此上限可以通过启动配置项 <code>-Dcsp.sentinel.statistic.max.rt=xxx</code> 来配置</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161028.png" alt=""></p><ul><li>配置</li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161033.png" alt=""></p><p>....</p><h3 id="_5-热点key限流-官网-方法细粒度" tabindex="-1"><a class="header-anchor" href="#_5-热点key限流-官网-方法细粒度" aria-hidden="true">#</a> 5. 热点key限流 😄 <a href="https://github.com/alibaba/Sentinel/wiki/%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81" target="_blank" rel="noopener noreferrer">官网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <sup>方法细粒度</sup></h3><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161039.png" alt=""></p><p>何为热点？热点即经常访问的数据。很多时候我们希望统计某个热点数据中访问频次最高的 Top K 数据，并对其访问进行限制。比如：</p><ul><li>商品 ID 为参数，统计一段时间内最常购买的商品 ID 并进行限制</li><li>用户 ID 为参数，针对一段时间内频繁访问的用户 ID 进行限制</li></ul><h4 id="_1-之前方法" tabindex="-1"><a class="header-anchor" href="#_1-之前方法" aria-hidden="true">#</a> 1. 之前方法</h4><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161045.png" alt=""></p><p>==BlockException==</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>package com.alibaba.csp.sentinel.slots.block;

public abstract class BlockException extends Exception {

    public static final String BLOCK_EXCEPTION_FLAG = &quot;SentinelBlockException&quot;;
    /**
     * &lt;p&gt;this constant RuntimeException has no stack trace, just has a message
     * {@link #BLOCK_EXCEPTION_FLAG} that marks its name.
     * &lt;/p&gt;
     * &lt;p&gt;
     * Use {@link #isBlockException(Throwable)} to check whether one Exception
     * Sentinel Blocked Exception.
     * &lt;/p&gt;
     */
    public static RuntimeException THROW_OUT_EXCEPTION = new RuntimeException(BLOCK_EXCEPTION_FLAG);

    public static StackTraceElement[] sentinelStackTrace = new StackTraceElement[] {
        new StackTraceElement(BlockException.class.getName(), &quot;block&quot;, &quot;BlockException&quot;, 0)
    };

    static {
        THROW_OUT_EXCEPTION.setStackTrace(sentinelStackTrace);
    }

    protected AbstractRule rule;
    private String ruleLimitApp;

    public BlockException(String ruleLimitApp) {
        super();
        this.ruleLimitApp = ruleLimitApp;
    }

    public BlockException(String ruleLimitApp, AbstractRule rule) {
        super();
        this.ruleLimitApp = ruleLimitApp;
        this.rule = rule;
    }

    public BlockException(String message, Throwable cause) {
        super(message, cause);
    }

    public BlockException(String ruleLimitApp, String message) {
        super(message);
        this.ruleLimitApp = ruleLimitApp;
    }

    public BlockException(String ruleLimitApp, String message, AbstractRule rule) {
        super(message);
        this.ruleLimitApp = ruleLimitApp;
        this.rule = rule;
    }

    @Override
    public Throwable fillInStackTrace() {
        return this;
    }

    public String getRuleLimitApp() {
        return ruleLimitApp;
    }

    public void setRuleLimitApp(String ruleLimitApp) {
        this.ruleLimitApp = ruleLimitApp;
    }

    /**
     * Check whether the exception is sentinel blocked exception. One exception is sentinel blocked
     * exception only when:
     * &lt;ul&gt;
     * &lt;li&gt;the exception or its (sub-)cause is {@link BlockException}, or&lt;/li&gt;
     * &lt;li&gt;the exception&#39;s message is or any of its sub-cause&#39;s message equals to {@link #BLOCK_EXCEPTION_FLAG}&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * @param t the exception.
     * @return return true if the exception marks sentinel blocked exception.
     */
    public static boolean isBlockException(Throwable t) {
        if (null == t) {
            return false;
        }

        int counter = 0;
        Throwable cause = t;
        while (cause != null &amp;&amp; counter++ &lt; 50) {
            if ((cause instanceof BlockException) || (BLOCK_EXCEPTION_FLAG.equals(cause.getMessage()))) {
                return true;
            }
            cause = cause.getCause();
        }

        return false;
    }

    public AbstractRule getRule() {
        return rule;
    }
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-案例-自定义处理" tabindex="-1"><a class="header-anchor" href="#_2-案例-自定义处理" aria-hidden="true">#</a> 2. 案例--自定义处理</h4><ul><li>配置文件</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloudalibaba<span class="token punctuation">-</span>sentinel<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token comment"># Nacos服务注册中心地址</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">transport</span><span class="token punctuation">:</span>
        <span class="token comment"># sentinel dashboard 地址</span>
        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span>
        <span class="token comment"># 默认为8719，如果被占用会自动+1，直到找到为止</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8719</span>
      <span class="token comment"># 流控规则持久化到nacos</span>
      <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">dsl</span><span class="token punctuation">:</span>
          <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
            <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
            <span class="token key atrule">data-id</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>
            <span class="token key atrule">group-id</span><span class="token punctuation">:</span> DEFAULT_GROUP
            <span class="token key atrule">data-type</span><span class="token punctuation">:</span> json
            <span class="token key atrule">rule-type</span><span class="token punctuation">:</span> flow
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>业务</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 热点限流
 *  @SentinelResource(value = &quot;testHotKey&quot;,blockHandler = &quot;deal_testHotKey&quot;)
 *  value: 资源名
 *  blockHandler: 兜底方法
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testHotKey&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;testHotKey&quot;</span><span class="token punctuation">,</span>blockHandler <span class="token operator">=</span> <span class="token string">&quot;deal_testHotKey&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testHotKey</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;p1&quot;</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> p1<span class="token punctuation">,</span>
                         <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;p1&quot;</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> p2<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;testHotKey&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">deal_testHotKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> p1<span class="token punctuation">,</span> <span class="token class-name">String</span> p2<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;---------------deal_testHotKey,o(╥﹏╥)o&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>测试</li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161056.png" alt=""></p><p>sentinel</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161100.png" alt=""></p><p>选取方式</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161108.png" alt=""></p><ul><li>结果 ==QPS 超过一次,降级处理==</li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161117.png" alt=""></p><h4 id="_3-参数例外项" tabindex="-1"><a class="header-anchor" href="#_3-参数例外项" aria-hidden="true">#</a> 3. 参数例外项</h4><ul><li>上述案例,QPS&gt;1,马上限流</li></ul><ol><li><p>特例</p><ul><li>普通: 超过一秒之后,达到阈值1后,马上被限流</li><li>我么期望P1参数,当它为某个特殊值时,它的限流和平时不一样</li><li>==特例: 加入当p1的值为5时,它的阈值可以达到200==</li></ul></li><li><p>配置</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161122.png" alt=""></p></li><li><p>结果</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161126.png" alt=""></p></li></ol><p>==前提: 热点的参数必须为基本类型/string==</p><h4 id="_4-注意点" tabindex="-1"><a class="header-anchor" href="#_4-注意点" aria-hidden="true">#</a> 4. 注意点</h4><p><strong>@SentinelResource</strong>:</p><p>处理的是Sentinel控制台配置的违规情况,有BlockHandler方法配置的兜底处理</p><p><strong>@RuntimeException</strong>:</p><p>int age = 10/0,这个是java运行时报出的运行时异常,@SentinelResource不处理</p><p>==<strong>总结: @SentinelResource主管配置出错,运行出错该走异常走异常</strong>==</p><h3 id="_6-系统规则-官网-系统-应用整体-从入口座整体" tabindex="-1"><a class="header-anchor" href="#_6-系统规则-官网-系统-应用整体-从入口座整体" aria-hidden="true">#</a> 6. 系统规则 <a href="https://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81" target="_blank" rel="noopener noreferrer">官网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <sup>系统(应用整体,从入口座整体)</sup></h3><h4 id="_1-系统规则" tabindex="-1"><a class="header-anchor" href="#_1-系统规则" aria-hidden="true">#</a> 1. 系统规则</h4><p>系统保护规则是从应用级别的入口流量进行控制，从单台机器的 load、CPU 使用率、平均 RT、入口 QPS 和并发线程数等几个维度监控应用指标，让系统尽可能跑在最大吞吐量的同时保证系统整体的稳定性。</p><p>系统保护规则是应用整体维度的，而不是资源维度的，并且<strong>仅对入口流量生效</strong>。入口流量指的是进入应用的流量（<code>EntryType.IN</code>），比如 Web 服务或 Dubbo 服务端接收的请求，都属于入口流量。</p><p>系统规则支持以下的模式：</p><ul><li><strong>Load 自适应</strong>（仅对 Linux/Unix-like 机器生效）：系统的 load1 作为启发指标，进行自适应系统保护。当系统 load1 超过设定的启发值，且系统当前的并发线程数超过估算的系统容量时才会触发系统保护（BBR 阶段）。系统容量由系统的 <code>maxQps * minRt</code> 估算得出。设定参考值一般是 <code>CPU cores * 2.5</code>。</li><li><strong>CPU usage</strong>（1.5.0+ 版本）：当系统 CPU 使用率超过阈值即触发系统保护（取值范围 0.0-1.0），比较灵敏。</li><li><strong>平均 RT</strong>：当单台机器上所有入口流量的平均 RT 达到阈值即触发系统保护，单位是毫秒。</li><li><strong>并发线程数</strong>：当单台机器上所有入口流量的并发线程数达到阈值即触发系统保护。</li><li><strong>入口 QPS</strong>：当单台机器上所有入口流量的 QPS 达到阈值即触发系统保护。</li></ul><h3 id="_7-sentinelresource" tabindex="-1"><a class="header-anchor" href="#_7-sentinelresource" aria-hidden="true">#</a> 7. @SentinelResource</h3><h4 id="_1-按照资源名称限流-后续处理" tabindex="-1"><a class="header-anchor" href="#_1-按照资源名称限流-后续处理" aria-hidden="true">#</a> 1. 按照资源名称限流+后续处理</h4><ul><li><p>nacos启动</p></li><li><p>sentinel启动</p></li><li><p>依赖</p></li><li><p>代码</p></li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 按资源名称限流
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/byResource&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;byResource&quot;</span><span class="token punctuation">,</span>blockHandler <span class="token operator">=</span> <span class="token string">&quot;handlerException&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">byResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">&quot;按资源名称限流测试OK&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span><span class="token number">2020L</span><span class="token punctuation">,</span><span class="token string">&quot;serial001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * 兜底方法
 */</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">handlerException</span><span class="token punctuation">(</span><span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span>exception<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t 服务不可用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>结果: ==此种方法是<strong>临时的</strong>,关闭服务后,sentinel控制台的流控消失==</li></ul><h4 id="_2-按照url地址称限流-后续处理" tabindex="-1"><a class="header-anchor" href="#_2-按照url地址称限流-后续处理" aria-hidden="true">#</a> 2. 按照url地址称限流+后续处理</h4><p>....</p><h4 id="_3-上面兜底方案面临的问题-hystrix" tabindex="-1"><a class="header-anchor" href="#_3-上面兜底方案面临的问题-hystrix" aria-hidden="true">#</a> 3. 上面兜底方案面临的问题 (Hystrix)</h4><ul><li>系统默认的,没有体现我们的业务要求</li><li>依照现有条件,我们自定义的处理方法有何业务<strong>代码耦合</strong>在一块,不直观</li><li>每个业务方法都添加兜底,那<strong>代码膨胀</strong>加剧</li><li><strong>全局统一的处理方法没有体现</strong></li></ul><h4 id="_4-客户自定义限流处理逻辑" tabindex="-1"><a class="header-anchor" href="#_4-客户自定义限流处理逻辑" aria-hidden="true">#</a> 4. 客户自定义限流处理逻辑</h4><ul><li>跟业务代码解耦</li></ul><ol><li>自定义限流处理逻辑 customerBlockHandler</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/rateLimit/customerBlockHandler&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;customerBlockHandler&quot;</span><span class="token punctuation">,</span>
                  <span class="token comment">// 那个类</span>
        blockHandlerClass <span class="token operator">=</span> <span class="token class-name">CustomerBlockHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
                  <span class="token comment">// 那个方法</span>
        blockHandler <span class="token operator">=</span> <span class="token string">&quot;handlerException2&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">customerBlockHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">&quot;按客户自定义&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span><span class="token number">2020L</span><span class="token punctuation">,</span><span class="token string">&quot;serial002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerBlockHandler</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CommonResult</span> <span class="token function">handlerException</span><span class="token punctuation">(</span><span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">4444</span><span class="token punctuation">,</span><span class="token string">&quot;按客户自定义，global handlerException-----1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CommonResult</span> <span class="token function">handlerException2</span><span class="token punctuation">(</span><span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">4444</span><span class="token punctuation">,</span><span class="token string">&quot;按客户自定义，global handlerException-----2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161134.png" alt=""></p><h4 id="_5-更多注解属性说明-官网" tabindex="-1"><a class="header-anchor" href="#_5-更多注解属性说明-官网" aria-hidden="true">#</a> 5. 更多注解属性说明 <a href="https://github.com/alibaba/Sentinel/wiki/%E6%B3%A8%E8%A7%A3%E6%94%AF%E6%8C%81" target="_blank" rel="noopener noreferrer">官网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h5 id="_1-sentinel核心api" tabindex="-1"><a class="header-anchor" href="#_1-sentinel核心api" aria-hidden="true">#</a> 1. sentinel核心API</h5><ul><li>sphu定义资源</li><li>trace定义统计</li><li>contextUtil定义了上下文</li></ul><h3 id="_8-服务通断" tabindex="-1"><a class="header-anchor" href="#_8-服务通断" aria-hidden="true">#</a> 8. 服务通断</h3><h4 id="_1-sentinel整合ribbon-openfeign-fallback" tabindex="-1"><a class="header-anchor" href="#_1-sentinel整合ribbon-openfeign-fallback" aria-hidden="true">#</a> 1. sentinel整合ribbon+openfeign+fallback</h4><p>ribbon: 9003/9004 消费者 84</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">#激活sentinel对feign的支持</span>
<span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>feign</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;nacos-payment-provider&quot;</span><span class="token punctuation">,</span>fallback <span class="token operator">=</span> <span class="token class-name">PaymentFallbackService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PaymentService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/paymentSQL/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">paymentSQL</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentFallbackService</span> <span class="token keyword">implements</span> <span class="token class-name">PaymentService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">paymentSQL</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span><span class="token string">&quot;服务降级返回，------------PaymentFallbackService&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span><span class="token string">&quot;errorSerial&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CircleBreakerController</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SERVICE_URL</span> <span class="token operator">=</span> <span class="token string">&quot;http://nacos-payment-provider&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/fallback/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//    @SentinelResource(value = &quot;fallback&quot;) //没有配置</span>
<span class="token comment">//    @SentinelResource(value = &quot;fallback&quot;,fallback = &quot;handlerFallback&quot;) //配置了fallback的，fallback只负责业务异常</span>
<span class="token comment">//    @SentinelResource(value = &quot;fallback&quot;,blockHandler = &quot;blockHandler&quot;) // 配置了blockHandler，只负责sentinel控制台配置违规</span>
    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;fallback&quot;</span><span class="token punctuation">,</span>fallback <span class="token operator">=</span> <span class="token string">&quot;handlerFallback&quot;</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">&quot;blockHandler&quot;</span><span class="token punctuation">,</span>
            exceptionsToIgnore <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">IllegalArgumentException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 配置了blockHandler和fallback</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">fallback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> commonResult <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token constant">SERVICE_URL</span> <span class="token operator">+</span> <span class="token string">&quot;/paymentSQL/&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">,</span> <span class="token class-name">CommonResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;IllegalArgumentException,非法参数异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>commonResult<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token string">&quot;NullPointerException,该ID没有记录，空指针异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> commonResult<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 本例是fallback</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">handlerFallback</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Payment</span> payment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span> <span class="token string">&quot;兜底异常handler，exception内容&quot;</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">blockHandler</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Payment</span> payment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">445</span><span class="token punctuation">,</span> <span class="token string">&quot;blockHandler-sentinel 限流，无此流水号：blockException&quot;</span> <span class="token operator">+</span> exception<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// --------------- open feign---------</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">PaymentService</span> paymentService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/paymentSQL/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">paymentSQL</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> paymentService<span class="token punctuation">.</span><span class="token function">paymentSQL</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>结果</p></li></ul><p>==1. 既要配置sentinel(blockHandler),又要配置fallback.两种兜底方法==</p><p>==sentinel: 管理sentinel控制台的违规出错,不管运行时异常==</p><p>==fallback: 管理运行时异常==</p><p>==2. 当blockHandler和fallback都进行了配置,则被限流而降级抛出BlockException时,只会进行<strong>blockHandler处理逻辑</strong>==</p><p>==3. feign配置fallback防止,被调用的服务方宕机,消费方活活耗死==</p><h4 id="_2-异常忽略属性-exceptionstoignore" tabindex="-1"><a class="header-anchor" href="#_2-异常忽略属性-exceptionstoignore" aria-hidden="true">#</a> 2. 异常忽略属性 exceptionsToIgnore</h4><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161142.png" alt=""></p><p>这个属性,在有异常时,不在有fallback方法兜底,没有降级效果了.</p><h3 id="_9-规则持久化" tabindex="-1"><a class="header-anchor" href="#_9-规则持久化" aria-hidden="true">#</a> 9. 规则持久化</h3><ul><li>关闭服务,sentinel控制台的流控规则消失?????,是持久???是临时???</li></ul><h4 id="_1-是什么-2" tabindex="-1"><a class="header-anchor" href="#_1-是什么-2" aria-hidden="true">#</a> 1. 是什么</h4><ul><li>一旦重启,sentinel规则将消失,生产环境需要降配置规则进行<strong>持久化</strong></li></ul><h4 id="_2-怎么玩" tabindex="-1"><a class="header-anchor" href="#_2-怎么玩" aria-hidden="true">#</a> 2. 怎么玩?</h4><ul><li>将限流配置规则==<strong>持久化进Nacos保存</strong>==,只要刷新8401某个rest地址,sentinel控制台的流控规则就能看到,只要Nacos里面的配置不删除,针对8401上的sentinel上的流控规则持续有效.</li></ul><h4 id="_3-实现步骤" tabindex="-1"><a class="header-anchor" href="#_3-实现步骤" aria-hidden="true">#</a> 3. 实现步骤</h4><ol><li><p>依赖</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--sentinel-datasource-nacos 后续持久化用--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>配置</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloudalibaba<span class="token punctuation">-</span>sentinel<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token comment"># Nacos服务注册中心地址</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">transport</span><span class="token punctuation">:</span>
        <span class="token comment"># sentinel dashboard 地址</span>
        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span>
        <span class="token comment"># 默认为8719，如果被占用会自动+1，直到找到为止</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8719</span>
      <span class="token comment"># 流控规则持久化到nacos</span>
      <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">dsl</span><span class="token punctuation">:</span>
          <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
            <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
            <span class="token comment"># data-id: ${spring.application.name}</span>
            <span class="token key atrule">data-id</span><span class="token punctuation">:</span> cloudalibaba<span class="token punctuation">-</span>sentinel<span class="token punctuation">-</span>service
            <span class="token key atrule">group-id</span><span class="token punctuation">:</span> DEFAULT_GROUP
            <span class="token key atrule">data-type</span><span class="token punctuation">:</span> json
            <span class="token key atrule">rule-type</span><span class="token punctuation">:</span> flow
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>nacos配置</p><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161149.png" alt=""></p></li></ol><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;resource&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/rateLime/byUrl&quot;</span><span class="token punctuation">,</span> # 资源名称
        <span class="token property">&quot;limitApp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> # 来源应用
        <span class="token property">&quot;grade&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> # 阈值类型<span class="token punctuation">,</span><span class="token number">0</span>表示线程数<span class="token punctuation">,</span><span class="token number">1</span>表示QPS
        <span class="token property">&quot;count&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> # 单级阈值
        <span class="token property">&quot;strategy&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> # 流控模式<span class="token punctuation">,</span><span class="token number">0</span>表示直接<span class="token punctuation">,</span><span class="token number">1</span>表示关联<span class="token punctuation">,</span><span class="token number">2</span>表示链路
        <span class="token property">&quot;controlBehavior&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> # 流控效果<span class="token punctuation">,</span><span class="token number">1</span>表示Warm Up<span class="token punctuation">,</span><span class="token number">2</span>表示排队等待
        <span class="token property">&quot;clusterModer&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> # 是否集群
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>注意事项 <ul><li>重启后多次调用</li></ul></li></ol><h2 id="_4-springcloud-alibaba-seata-处理分布式事务" tabindex="-1"><a class="header-anchor" href="#_4-springcloud-alibaba-seata-处理分布式事务" aria-hidden="true">#</a> 4. SpringCloud Alibaba Seata 处理分布式事务</h2><p><strong>分布式问题：</strong></p><p>单体应用被拆分成微服务应用，原来的三个模块被拆分成三个独立的应用，分别使用三个独立的数据源，业务操作需要调用三个服务来完成。此时每个服务内部的数据一致性由本地事务来保证，但是全局的数据一致性问题没法保证</p><h3 id="_1-seate概述-官网" tabindex="-1"><a class="header-anchor" href="#_1-seate概述-官网" aria-hidden="true">#</a> 1. seate概述 <a href="https://seata.io/zh-cn/" target="_blank" rel="noopener noreferrer">官网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>Seata是一款开源的分布式事务解决方案，致力于在微服务架构下提供高性能和简单易用的分布式事务服务。</p><h4 id="_1-能干啥" tabindex="-1"><a class="header-anchor" href="#_1-能干啥" aria-hidden="true">#</a> 1. 能干啥?</h4><p>分布式事务处理过程的一ID+三组件模型：</p><table><thead><tr><th><strong>Transaction ID XID</strong></th><th><strong>全局唯一的事务ID</strong></th></tr></thead><tbody><tr><td>Transaction Coordinator(TC)</td><td>==事务协调器==，维护全局事务的运行状态，负责协调并驱动事务的提交或回滚</td></tr><tr><td>Transaction Manager(TM )</td><td>==事务管理器,==控制全局事务的边界，负责开启一个全局事务，并最终发起全局提交或全局回滚的决议</td></tr><tr><td>Resource Manager(RM)</td><td>==资源管理器==控制分支事务，负责分支注册、状态汇报，并接收事务协调器的指令，驱动分支(本地)事务的提交或回滚</td></tr></tbody></table><p>处理过程：RM:</p><ol><li>TM向TC申请开启一个全局事务，全局事务创建成功并生成一个全局唯一的XID</li><li>XID在微服务调用链路的上下文中传播</li><li>RM向TC注册分支事务，将其纳入XID对应全局事务的管辖</li><li>TM向TC发起针对XID的全局提交或回滚决议</li><li>TC调度XID下管辖的全部分支事务完成提交或回滚</li></ol><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161154.png" alt=""></p><h4 id="_2-下载" tabindex="-1"><a class="header-anchor" href="#_2-下载" aria-hidden="true">#</a> 2. <a href="https://seata.io/zh-cn/blog/download.html" target="_blank" rel="noopener noreferrer">下载<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h4 id="_3-怎么玩" tabindex="-1"><a class="header-anchor" href="#_3-怎么玩" aria-hidden="true">#</a> 3. 怎么玩</h4><ul><li><p>以前事务 @Transactional</p></li><li><p>现在 ==@GlobalTransactional==</p></li></ul><h4 id="_5-seate配置" tabindex="-1"><a class="header-anchor" href="#_5-seate配置" aria-hidden="true">#</a> 5. seate配置</h4><ul><li>自定义事务组名称+事务日志存储模式为db+数据库连接信息</li></ul><h5 id="_1-file-conf-service模块" tabindex="-1"><a class="header-anchor" href="#_1-file-conf-service模块" aria-hidden="true">#</a> 1. file.conf service模块</h5><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161200.png" alt=""></p><ul><li>store模块</li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161205.png" alt=""></p><ul><li>db</li></ul><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161209.png" alt=""></p><h5 id="_2-数据控库表" tabindex="-1"><a class="header-anchor" href="#_2-数据控库表" aria-hidden="true">#</a> 2. 数据控库表</h5><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- the table to store GlobalSession data</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> <span class="token identifier"><span class="token punctuation">`</span>global_table<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>global_table<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>  <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>application_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_service_group<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>timeout<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>begin_time<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">key</span> <span class="token identifier"><span class="token punctuation">`</span>idx_gmt_modified_status<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">key</span> <span class="token identifier"><span class="token punctuation">`</span>idx_transaction_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">-- the table to store BranchSession data</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> <span class="token identifier"><span class="token punctuation">`</span>branch_table<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>branch_table<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>resource_group_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>lock_key<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>branch_type<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>client_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">key</span> <span class="token identifier"><span class="token punctuation">`</span>idx_xid<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">-- the table to store lock data</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> <span class="token identifier"><span class="token punctuation">`</span>lock_table<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>lock_table<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> long <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span> long<span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>pk<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-register-conf" tabindex="-1"><a class="header-anchor" href="#_3-register-conf" aria-hidden="true">#</a> 3. register.conf</h5><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161216.bmp" alt=""></p><h3 id="_2-案例-1" tabindex="-1"><a class="header-anchor" href="#_2-案例-1" aria-hidden="true">#</a> 2. 案例</h3><h4 id="_1-依赖-2" tabindex="-1"><a class="header-anchor" href="#_1-依赖-2" aria-hidden="true">#</a> 1. 依赖</h4><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161221.png" alt=""></p></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/chggx-knowlodge-vuepress/java/framework/springcloud/1.SpringCloud.H%E5%9F%BA%E7%A1%80.html" class="" aria-label="SpringCloud.H基础"><!--[--><!--]--> SpringCloud.H基础 <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/chggx-knowlodge-vuepress/assets/app.099ebd34.js" defer></script>
  </body>
</html>
