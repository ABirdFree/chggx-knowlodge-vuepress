<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SpringCloud Alibaba介绍 | chggx-knowledge</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/chggx-knowlodge-vuepress/img/favicon.ico">
    <meta name="description" content="一个基于VuePress的 知识管理&amp;博客 主题">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/chggx-knowlodge-vuepress/assets/css/0.styles.2ef74c7b.css" as="style"><link rel="preload" href="/chggx-knowlodge-vuepress/assets/js/app.4bb66daa.js" as="script"><link rel="preload" href="/chggx-knowlodge-vuepress/assets/js/2.796b80a3.js" as="script"><link rel="preload" href="/chggx-knowlodge-vuepress/assets/js/91.487b1df3.js" as="script"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/10.d931881c.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/100.90f1b044.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/101.4bfc3a79.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/102.309b1f1f.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/103.6615ef18.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/104.4272da4c.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/105.96f4b39f.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/106.1997839e.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/107.88987358.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/108.9130315c.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/11.3129265d.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/12.5d554c82.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/13.1eb3a13b.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/14.2f36f7fe.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/15.aff17ecc.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/16.d13394b5.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/17.b4382cbf.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/18.6d75b999.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/19.e92231e1.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/20.8571efe0.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/21.c6396fe4.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/22.302ccd08.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/23.922d5af3.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/24.6d1a4981.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/25.85fcc05d.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/26.5d75e71d.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/27.c9b2afa2.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/28.a422313a.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/29.80d95b5f.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/3.82d8f896.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/30.0d27c741.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/31.e1c45fa1.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/32.fd3dbda7.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/33.ea85c33c.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/34.77117408.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/35.985312bc.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/36.cf909541.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/37.3c62f3ae.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/38.0573a653.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/39.39924048.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/4.1abb0fb3.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/40.82d4299d.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/41.340b3b09.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/42.abc8e666.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/43.2f8510af.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/44.40989577.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/45.68e5089c.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/46.2e420d15.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/47.c9bfe03d.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/48.205e18ef.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/49.5338bafc.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/5.611bb8b1.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/50.dcdcd801.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/51.e554d613.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/52.2222db4d.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/53.fe4dc8df.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/54.58a21ec9.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/55.417a8dc0.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/56.50b303bb.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/57.fe80bd75.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/58.fe59d9d5.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/59.944554fb.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/6.5730c3e8.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/60.43dc1590.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/61.7bea5573.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/62.22b6e96f.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/63.7ecb7100.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/64.c1c78355.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/65.895d78f1.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/66.57ece92f.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/67.a1b6ef42.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/68.dfafb342.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/69.49614350.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/7.676b4330.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/70.ab001da9.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/71.bd8dc17e.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/72.9a6620f5.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/73.4d1481db.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/74.1ed2cd4b.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/75.99accb4e.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/76.c0e87e32.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/77.75d5fd56.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/78.c70c4e29.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/79.620a8bfe.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/8.4c9a1ddf.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/80.d2a7203d.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/81.02547d23.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/82.8833a5a5.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/83.1f8a83c0.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/84.934e1fae.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/85.3b05b369.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/86.96adbf4b.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/87.742fa2c1.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/88.88b66b9a.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/89.76a80ea4.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/9.c16e6e51.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/90.e0829368.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/92.cd8fef3f.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/93.9a1655ca.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/94.0f1850b1.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/95.c69337db.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/96.b69f8d34.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/97.3e65955d.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/98.1c45f758.js"><link rel="prefetch" href="/chggx-knowlodge-vuepress/assets/js/99.dcf036ea.js">
    <link rel="stylesheet" href="/chggx-knowlodge-vuepress/assets/css/0.styles.2ef74c7b.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/chggx-knowlodge-vuepress/" class="home-link router-link-active"><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/202302271042851.png" alt="chggx-knowledge" class="logo"> <span class="site-name can-hide">chggx-knowledge</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/chggx-knowlodge-vuepress/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言" class="dropdown-title"><a href="/chggx-knowlodge-vuepress/pages/ec1391/" class="link-title">语言</a> <span class="title" style="display:none;">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>JAVA语言</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/ec1391/" class="nav-link">语言基础</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/9faa36/" class="nav-link">JVM</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">并发&amp;多线程</a></li></ul></li><li class="dropdown-item"><h4>C语言</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/40db50/" class="nav-link">语言基础</a></li></ul></li><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/29740f/" class="nav-link">MySQL基础</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">MySQL高级</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/ff9a50/" class="nav-link">Influxdb</a></li></ul></li><li class="dropdown-item"><h4>前端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">三大件</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">基础库</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程基础" class="dropdown-title"><a href="/chggx-knowlodge-vuepress/pages/febdf1/" class="link-title">编程基础</a> <span class="title" style="display:none;">编程基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据结构和算法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/febdf1/" class="nav-link">数据结构</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">算法</a></li></ul></li><li class="dropdown-item"><!----> <a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">操作系统</a></li><li class="dropdown-item"><!----> <a href="/chggx-knowlodge-vuepress/pages/391852/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><a href="/chggx-knowlodge-vuepress/pages/6ad6ad/" class="link-title">开发工具</a> <span class="title" style="display:none;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>集成开发环境</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/6ad6ad/" class="nav-link">IDEA</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/d486f7/" class="nav-link">VSCode</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/17afa5/" class="nav-link">数据库工具</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/5082de/" class="nav-link">接口测试工具</a></li></ul></li><li class="dropdown-item"><!----> <a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">Linux系统</a></li><li class="dropdown-item"><h4>代码管理工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/00b1bb/" class="nav-link">Svn</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/d486f7/" class="nav-link">Git</a></li></ul></li><li class="dropdown-item"><h4>项目管理&amp;构建工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/020d30/" class="nav-link">Maven</a></li></ul></li><li class="dropdown-item"><!----> <a href="/chggx-knowlodge-vuepress/pages/e8fc76/" class="nav-link">代码质量检查</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="应用框架" class="dropdown-title"><a href="/chggx-knowlodge-vuepress/pages/0705f0/" class="link-title">应用框架</a> <span class="title" style="display:none;">应用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring家族</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/0705f0/" class="nav-link">Spring</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">SpringMVC</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/c71dea/" class="nav-link">SpringBoot</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/0a5c18/" class="nav-link">SpringCloud</a></li></ul></li><li class="dropdown-item"><h4>服务器软件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/9e3fdb/" class="nav-link">Web服务器</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/62479e/" class="nav-link">应用服务器</a></li></ul></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/1db5d1/" class="nav-link">缓存</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/19fb99/" class="nav-link">消息队列</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">RPC架构</a></li></ul></li><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">ORM层框架</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">连接池</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">分库分表</a></li></ul></li><li class="dropdown-item"><h4>搜索引擎</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/6641bc/" class="nav-link">ElasticSearch</a></li></ul></li><li class="dropdown-item"><h4>模板框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">Thymeleaf</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">FreeMarker</a></li></ul></li><li class="dropdown-item"><h4>前端组件化框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/abd7cf/" class="nav-link">Node</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">VUE</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/chggx-knowlodge-vuepress/pages/b0e900/" class="nav-link">在线文档</a></div> <a href="https://github.com/ABirdFree" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/chggx-knowlodge-vuepress/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言" class="dropdown-title"><a href="/chggx-knowlodge-vuepress/pages/ec1391/" class="link-title">语言</a> <span class="title" style="display:none;">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>JAVA语言</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/ec1391/" class="nav-link">语言基础</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/9faa36/" class="nav-link">JVM</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">并发&amp;多线程</a></li></ul></li><li class="dropdown-item"><h4>C语言</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/40db50/" class="nav-link">语言基础</a></li></ul></li><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/29740f/" class="nav-link">MySQL基础</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">MySQL高级</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/ff9a50/" class="nav-link">Influxdb</a></li></ul></li><li class="dropdown-item"><h4>前端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">三大件</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">基础库</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程基础" class="dropdown-title"><a href="/chggx-knowlodge-vuepress/pages/febdf1/" class="link-title">编程基础</a> <span class="title" style="display:none;">编程基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据结构和算法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/febdf1/" class="nav-link">数据结构</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">算法</a></li></ul></li><li class="dropdown-item"><!----> <a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">操作系统</a></li><li class="dropdown-item"><!----> <a href="/chggx-knowlodge-vuepress/pages/391852/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><a href="/chggx-knowlodge-vuepress/pages/6ad6ad/" class="link-title">开发工具</a> <span class="title" style="display:none;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>集成开发环境</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/6ad6ad/" class="nav-link">IDEA</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/d486f7/" class="nav-link">VSCode</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/17afa5/" class="nav-link">数据库工具</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/5082de/" class="nav-link">接口测试工具</a></li></ul></li><li class="dropdown-item"><!----> <a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">Linux系统</a></li><li class="dropdown-item"><h4>代码管理工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/00b1bb/" class="nav-link">Svn</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/d486f7/" class="nav-link">Git</a></li></ul></li><li class="dropdown-item"><h4>项目管理&amp;构建工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/020d30/" class="nav-link">Maven</a></li></ul></li><li class="dropdown-item"><!----> <a href="/chggx-knowlodge-vuepress/pages/e8fc76/" class="nav-link">代码质量检查</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="应用框架" class="dropdown-title"><a href="/chggx-knowlodge-vuepress/pages/0705f0/" class="link-title">应用框架</a> <span class="title" style="display:none;">应用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Spring家族</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/0705f0/" class="nav-link">Spring</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">SpringMVC</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/c71dea/" class="nav-link">SpringBoot</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/0a5c18/" class="nav-link">SpringCloud</a></li></ul></li><li class="dropdown-item"><h4>服务器软件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/9e3fdb/" class="nav-link">Web服务器</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/62479e/" class="nav-link">应用服务器</a></li></ul></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/1db5d1/" class="nav-link">缓存</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/19fb99/" class="nav-link">消息队列</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">RPC架构</a></li></ul></li><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">ORM层框架</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">连接池</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">分库分表</a></li></ul></li><li class="dropdown-item"><h4>搜索引擎</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/6641bc/" class="nav-link">ElasticSearch</a></li></ul></li><li class="dropdown-item"><h4>模板框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">Thymeleaf</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">FreeMarker</a></li></ul></li><li class="dropdown-item"><h4>前端组件化框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/abd7cf/" class="nav-link">Node</a></li><li class="dropdown-subitem"><a href="/chggx-knowlodge-vuepress/pages/" class="nav-link router-link-active">VUE</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/chggx-knowlodge-vuepress/pages/b0e900/" class="nav-link">在线文档</a></div> <a href="https://github.com/ABirdFree" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Spring家族</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>SpringMVC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>SpringCloud</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/chggx-knowlodge-vuepress/pages/0a5c18/" class="sidebar-link">SpringCloud.H基础</a></li><li><a href="/chggx-knowlodge-vuepress/pages/f3ac37/" aria-current="page" class="active sidebar-link">SpringCloud Alibaba介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-springcloud-alibaba入门简介" class="sidebar-link">1. SpringCloud Alibaba入门简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-为什么出现springcloud-alibaba" class="sidebar-link">1.  为什么出现SpringCloud Alibaba</a></li><li class="sidebar-sub-header level3"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-alibaba-能干什么" class="sidebar-link">2. alibaba  能干什么?</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-主要技术" class="sidebar-link">1. 主要技术</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-依赖" class="sidebar-link">2. 依赖</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-组件" class="sidebar-link">3.. 组件</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_4-学习资料" class="sidebar-link">4. 学习资料</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-springcloud-alibaba-nacos-服务注册和配置中心" class="sidebar-link">2. SpringCloud Alibaba Nacos 服务注册和配置中心 😄</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-概述" class="sidebar-link">1. 概述</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-是什么" class="sidebar-link">1. 是什么?</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-能干嘛" class="sidebar-link">2. 能干嘛?</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-去哪里下" class="sidebar-link">3. 去哪里下?</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_4-安装运行" class="sidebar-link">4. 安装运行</a></li><li class="sidebar-sub-header level3"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-nacos服务注册中心-官方文档" class="sidebar-link">2. Nacos服务注册中心 官方文档</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-服务端" class="sidebar-link">1. 服务端</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-依赖" class="sidebar-link">1. 依赖</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-配置" class="sidebar-link">2. 配置</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-主启动类-enablediscoveryclient" class="sidebar-link">3. 主启动类 @EnableDiscoveryClient</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_4-controler" class="sidebar-link">4. controler</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_5-效果" class="sidebar-link">5. 效果</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-客户端" class="sidebar-link">2. 客户端</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-配置" class="sidebar-link">1. 配置</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-启动类" class="sidebar-link">2. 启动类</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-controller" class="sidebar-link">3. controller</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_4-结果" class="sidebar-link">4. 结果</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-服务中心的对比" class="sidebar-link">3. 服务中心的对比</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-nacos" class="sidebar-link">1. nacos</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-对比" class="sidebar-link">2.  对比</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-nacos的ap与cp切换" class="sidebar-link">3. Nacos的AP与CP切换 😄</a></li><li class="sidebar-sub-header level3"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-nacos作为服务配置中心-等同-eureka-config-bus" class="sidebar-link">3. Nacos作为服务配置中心  ====</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-基础配置操作" class="sidebar-link">1. 基础配置操作</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-在nacos中添加配置信息" class="sidebar-link">2. 在Nacos中添加配置信息</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-分类配置" class="sidebar-link">3. 分类配置</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-多环境多项目管理" class="sidebar-link">1. 多环境多项目管理</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-nacos界面" class="sidebar-link">2. Nacos界面</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-namespace-group-data-id三者关系-为什么这么设计" class="sidebar-link">3. Namespace + Group + Data ID三者关系？为什么这么设计？</a></li><li class="sidebar-sub-header level6"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-是什么-2" class="sidebar-link">1. 是什么?</a></li><li class="sidebar-sub-header level6"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-三者情况" class="sidebar-link">2. 三者情况</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_4-三种方案-分类配置" class="sidebar-link">4. 三种方案 (分类配置)</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-dataid方案" class="sidebar-link">1. DataID方案</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-group方案" class="sidebar-link">2. Group方案</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-namespace-方案" class="sidebar-link">3. Namespace 方案</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_5-扩展id" class="sidebar-link">5. 扩展ID</a></li><li class="sidebar-sub-header level3"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_4-nacos集群和持久化" class="sidebar-link">4. Nacos集群和持久化</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-集群" class="sidebar-link">1.  集群</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#https-chggx-typora-oss-cn-beijing-aliyuncs-com-typora-20210223160657-png" class="sidebar-link">![](https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160657.png)</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-持久化切换配置" class="sidebar-link">2.  持久化切换配置</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-derby到mysql切换配置步骤" class="sidebar-link">1.  derby到mysql切换配置步骤</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-mysql生产环境配置" class="sidebar-link">2.  MYSQL生产环境配置</a></li><li class="sidebar-sub-header level6"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-预计需要-1个ngnix-3个nacos注册中心-1个mysql" class="sidebar-link">1. 预计需要,1个ngnix+3个nacos注册中心+1个MySQL</a></li><li class="sidebar-sub-header level6"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-配置nacos-linux" class="sidebar-link">2. 配置nacos(linux)</a></li><li class="sidebar-sub-header level6"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-配置" class="sidebar-link">3.  配置</a></li><li class="sidebar-sub-header level6"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_4-ngnix配置-负载均衡" class="sidebar-link">4. ngnix配置  负载均衡</a></li><li class="sidebar-sub-header level6"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_5-测试" class="sidebar-link">5. 测试</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-springcloud-alibaba-sentinel-实现熔断与限流" class="sidebar-link">3. SpringCloud Alibaba Sentinel 实现熔断与限流 😄</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-sentinel-代替了-hystrix" class="sidebar-link">1. Sentinel 代替了 Hystrix</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-sentinel" class="sidebar-link">1. Sentinel</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-sentinel分为两个部分" class="sidebar-link">2. Sentinel分为两个部分：</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-sentinel下载" class="sidebar-link">3. sentinel下载</a></li><li class="sidebar-sub-header level3"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-案例" class="sidebar-link">2. 案例</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-依赖-2" class="sidebar-link">1.  依赖</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-准备" class="sidebar-link">2. 准备</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-测试" class="sidebar-link">3 测试</a></li><li class="sidebar-sub-header level3"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-流控规则-官网-方法细粒度" class="sidebar-link">3. 流控规则 官网</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-基本介绍" class="sidebar-link">1. 基本介绍</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-流控模式-官网-方法细粒度" class="sidebar-link">2. 流控模式  官网</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-流控模式-直接-默认" class="sidebar-link">1. 流控模式——直接(默认)</a></li><li class="sidebar-sub-header level6"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-qps" class="sidebar-link">1. QPS</a></li><li class="sidebar-sub-header level6"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-线程数" class="sidebar-link">2. 线程数：</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-关联-快速失败" class="sidebar-link">2.  关联 -快速失败</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-流控效果-官网" class="sidebar-link">3. 流控效果 官网</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-直接" class="sidebar-link">1.  直接</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-warm-up-预热" class="sidebar-link">2. Warm Up(预热)</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-排队等待" class="sidebar-link">3. 排队等待</a></li><li class="sidebar-sub-header level3"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_4-降级规则-官网-方法细粒度" class="sidebar-link">4. 降级规则 官网</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-基本使用" class="sidebar-link">1. 基本使用</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-进一步说明" class="sidebar-link">2.  进一步说明</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-测试-2" class="sidebar-link">3. 测试</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1" class="sidebar-link">1.</a></li><li class="sidebar-sub-header level3"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_5-热点key限流-官网-方法细粒度" class="sidebar-link">5. 热点key限流 😄 官网</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-之前方法" class="sidebar-link">1. 之前方法</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-案例-自定义处理" class="sidebar-link">2. 案例--自定义处理</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-参数例外项" class="sidebar-link">3. 参数例外项</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_4-注意点" class="sidebar-link">4. 注意点</a></li><li class="sidebar-sub-header level3"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_6-系统规则-官网-系统-应用整体-从入口座整体" class="sidebar-link">6. 系统规则 官网</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-系统规则" class="sidebar-link">1. 系统规则</a></li><li class="sidebar-sub-header level3"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_7-sentinelresource" class="sidebar-link">7. @SentinelResource</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-按照资源名称限流-后续处理" class="sidebar-link">1. 按照资源名称限流+后续处理</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-按照url地址称限流-后续处理" class="sidebar-link">2.  按照url地址称限流+后续处理</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-上面兜底方案面临的问题-hystrix" class="sidebar-link">3. 上面兜底方案面临的问题 (Hystrix)</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_4-客户自定义限流处理逻辑" class="sidebar-link">4. 客户自定义限流处理逻辑</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_5-更多注解属性说明-官网" class="sidebar-link">5.  更多注解属性说明 官网</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-sentinel核心api" class="sidebar-link">1. sentinel核心API</a></li><li class="sidebar-sub-header level3"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_8-服务通断" class="sidebar-link">8. 服务通断</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-sentinel整合ribbon-openfeign-fallback" class="sidebar-link">1. sentinel整合ribbon+openfeign+fallback</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-异常忽略属性-exceptionstoignore" class="sidebar-link">2. 异常忽略属性 exceptionsToIgnore</a></li><li class="sidebar-sub-header level3"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_9-规则持久化" class="sidebar-link">9. 规则持久化</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-是什么-3" class="sidebar-link">1. 是什么</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-怎么玩" class="sidebar-link">2. 怎么玩?</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-实现步骤" class="sidebar-link">3. 实现步骤</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_4-springcloud-alibaba-seata-处理分布式事务" class="sidebar-link">4. SpringCloud Alibaba Seata 处理分布式事务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-seate概述-官网" class="sidebar-link">1. seate概述 官网</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-能干啥" class="sidebar-link">1. 能干啥?</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-下载" class="sidebar-link">2. 下载</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-怎么玩" class="sidebar-link">3. 怎么玩</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_5-seate配置" class="sidebar-link">5. seate配置</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-file-conf-service模块" class="sidebar-link">1. file.conf service模块</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-数据控库表" class="sidebar-link">2. 数据控库表</a></li><li class="sidebar-sub-header level5"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_3-register-conf" class="sidebar-link">3.  register.conf</a></li><li class="sidebar-sub-header level3"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_2-案例-2" class="sidebar-link">2. 案例</a></li><li class="sidebar-sub-header level4"><a href="/chggx-knowlodge-vuepress/pages/f3ac37/#_1-依赖-3" class="sidebar-link">1. 依赖</a></li></ul></li></ul></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务器软件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>搜索引擎</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>模板框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端组件化框架</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/chggx-knowlodge-vuepress/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>应用框架</span></li><li data-v-06225672><span data-v-06225672>Spring家族</span></li><li data-v-06225672><span data-v-06225672>SpringCloud</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/ABirdFree" target="_blank" title="作者" class="beLink" data-v-06225672>晨光-向</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-03-15</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">SpringCloud Alibaba介绍<!----></h1> <div class="page-slot page-slot-top">
    <div class="wwads-cn wwads-horizontal page-wwads" data-id="136"></div>
    <style>
      .page-wwads{
        width:100%!important;
        min-height: 0;
        margin: 0;
      }
      .page-wwads .wwads-img img{
        width:80px!important;
      }
      .page-wwads .wwads-poweredby{
        width: 40px;
        position: absolute;
        right: 25px;
        bottom: 3px;
      }
      .wwads-content .wwads-text, .page-wwads .wwads-text{
        height: 100%;
        padding-top: 5px;
        display: block;
      }
  </style>
  </div> <div class="theme-vdoing-content content__default"><h1 id="springcloud-alibaba-官网"><a href="#springcloud-alibaba-官网" class="header-anchor">#</a> SpringCloud Alibaba <a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h1> <h2 id="_1-springcloud-alibaba入门简介"><a href="#_1-springcloud-alibaba入门简介" class="header-anchor">#</a> 1. SpringCloud Alibaba入门简介</h2> <h3 id="_1-为什么出现springcloud-alibaba"><a href="#_1-为什么出现springcloud-alibaba" class="header-anchor">#</a> 1.  为什么出现SpringCloud Alibaba</h3> <ul><li>SpringCloud Netflix 项目进入维护  2018.12.12</li> <li>https://spring.io/blog/2018/12/12/spring-cloud-greenwich-rc1-available-now</li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160327.png" alt=""></p> <h3 id="_2-alibaba-能干什么"><a href="#_2-alibaba-能干什么" class="header-anchor">#</a> 2. alibaba  能干什么?</h3> <h4 id="_1-主要技术"><a href="#_1-主要技术" class="header-anchor">#</a> 1. 主要技术</h4> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160334.png" alt=""></p> <ol><li><p>服务限流降级：默认支持Servlet、Feign、RestTemplate、Dubbo和RocketMQ限流降级功能的接入，可以在运行时通过控制台实时修改限流降级规则，还支持查看限流降级Metrics监控。</p></li> <li><p>服务注册与发现：适配SpringCloud服务注册与发现标准，默认集成了Ribbon的支持。</p></li> <li><p>分布式配置管理：支持分布式系统中的外部化配置，配置更改时自动刷新。</p></li> <li><p>消息驱动能力：基于SpringCloud Stream为微服务应用构建消息驱动能力。</p></li> <li><p>阿里云对象存储：阿里云提供的海量、安全、低成本、高可靠的云存储服务。支持在任何应用、任何时间、任何地点存储和访问任意类型的数据。</p></li> <li><p>分布式任务调度：提供秒级、精准、高可靠、高可用的定时（基于Cron表达式）任务调度任务。同时提供分布式的任务执行模型，如网格任务。网格任务支持海量子任务均匀分配到所有Worker（schedulerx-client）上执行。</p></li></ol> <h4 id="_2-依赖"><a href="#_2-依赖" class="header-anchor">#</a> 2. 依赖</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.0.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_3-组件"><a href="#_3-组件" class="header-anchor">#</a> 3.. 组件</h4> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160340.png" alt=""></p> <h4 id="_4-学习资料"><a href="#_4-学习资料" class="header-anchor">#</a> 4. 学习资料</h4> <p><a href="https://spring.io/projects/spring-cloud-alibaba#overview" target="_blank" rel="noopener noreferrer">SpringCloud官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://github.com/alibaba/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html" target="_blank" rel="noopener noreferrer">文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md" target="_blank" rel="noopener noreferrer">中文官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_2-springcloud-alibaba-nacos-服务注册和配置中心"><a href="#_2-springcloud-alibaba-nacos-服务注册和配置中心" class="header-anchor">#</a> 2. SpringCloud Alibaba Nacos 服务注册和配置中心 😄</h2> <h3 id="_1-概述"><a href="#_1-概述" class="header-anchor">#</a> 1. 概述</h3> <ul><li>注册中心: eureka,zookeeper,consul,nacos</li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160346.png" alt=""></p> <ul><li>前四个字母分别为Naming和Configuration的前两个字母，最后的s为Service。</li></ul> <h4 id="_1-是什么"><a href="#_1-是什么" class="header-anchor">#</a> 1. 是什么?</h4> <p>一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。</p> <ul><li>Nacos：Dynamic Naming and Configuration Service</li> <li>Nacos就是 注册中心 + 配置中心的组合</li> <li>==Nacos = Eureka + Config + Bus==</li></ul> <h4 id="_2-能干嘛"><a href="#_2-能干嘛" class="header-anchor">#</a> 2. 能干嘛?</h4> <ul><li>替代Eureka做服务<strong>注册中心</strong></li> <li>替代Config做服务<strong>配置中心</strong></li></ul> <h4 id="_3-去哪里下"><a href="#_3-去哪里下" class="header-anchor">#</a> 3. 去哪里下?</h4> <p><a href="https://github.com/alibaba/Nacos" target="_blank" rel="noopener noreferrer">github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> , <a href="https://nacos.io/zh-cn/index.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,  <a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_config" target="_blank" rel="noopener noreferrer">学习手册<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_4-安装运行"><a href="#_4-安装运行" class="header-anchor">#</a> 4. 安装运行</h4> <ol><li><p>本地Java8 + Maven环境已经OK</p></li> <li><p>先从官网下载Nacos</p></li> <li><p>解压安装包，直接运行bin目录下的startup.cmd</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160351.png" alt=""></p></li> <li><p>运行成功后直接访问 https://localhost:8848/nacos 默认账号密码都是nacos</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160356.png" alt=""></p></li></ol> <p>linux</p> <ol><li><p>tar zxvf nacos-server-1.1.4.tar.gz</p></li> <li><p>bash startup.sh -m standalone (启动命令(standalone代表着单机模式运行，非集群模式):</p> <p>sh startup.sh -m standalone)</p></li> <li><p><em># MySQL配置</em></p> <p>spring.datasource.platform=mysql</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run -p 3306:3306 --name mysql -v /root/mysql/conf:/etc/mysql/conf.d -v /root/mysql/logs:/logs -v /root/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=326868 -d mysql:5.7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>db.num=1</p> <p>db.url.0=jdbc:mysql://116.196.118.167:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true</p> <p>db.user=root</p> <p>db.password=326868</p></li></ol> <h3 id="_2-nacos服务注册中心-官方文档"><a href="#_2-nacos服务注册中心-官方文档" class="header-anchor">#</a> 2. Nacos服务注册中心 <a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <h4 id="_1-服务端"><a href="#_1-服务端" class="header-anchor">#</a> 1. 服务端</h4> <h5 id="_1-依赖"><a href="#_1-依赖" class="header-anchor">#</a> 1. 依赖</h5> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--父工程引入spring cloud alibaba 2.1.0.RELEASE--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--springcloud alibaba nacos--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>Nacos自带ribbon</strong></p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160404.png" alt=""></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="_2-配置"><a href="#_2-配置" class="header-anchor">#</a> 2. 配置</h5> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9001</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#配置Nacos地址</span>

<span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">'*'</span>  <span class="token comment">#监控</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h5 id="_3-主启动类-enablediscoveryclient"><a href="#_3-主启动类-enablediscoveryclient" class="header-anchor">#</a> 3. 主启动类 <code>@EnableDiscoveryClient</code></h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentMain9001</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">PaymentMain9001</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="_4-controler"><a href="#_4-controler" class="header-anchor">#</a> 4. controler</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${server.port}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> serverPort<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/payment/nacos/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPayment</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;******result: &quot;</span><span class="token operator">+</span>serverPort<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;nacos registry,serverPort: &quot;</span><span class="token operator">+</span> serverPort<span class="token operator">+</span><span class="token string">&quot;\t id&quot;</span><span class="token operator">+</span>id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="_5-效果"><a href="#_5-效果" class="header-anchor">#</a> 5. 效果</h5> <p>nacos</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160410.png" alt=""></p> <ul><li>新建9002 实现负载均衡</li> <li>不想新建(采用下面方法)</li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160416.png" alt=""></p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160420.png" alt=""></p> <h4 id="_2-客户端"><a href="#_2-客户端" class="header-anchor">#</a> 2. 客户端</h4> <h5 id="_1-配置"><a href="#_1-配置" class="header-anchor">#</a> 1. 配置</h5> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">83</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>order<span class="token punctuation">-</span>consumer
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment"># 注册中心Nacos配置</span>

<span class="token comment">#消费者将要去访问的微服务名称（成功注册进nacos的微服务提供者），在这配置了访问的服务，业务类就不用在定义常量了</span>
<span class="token key atrule">service-url</span><span class="token punctuation">:</span>
  <span class="token key atrule">nacos-user-service</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//nacos<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>provider
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="_2-启动类"><a href="#_2-启动类" class="header-anchor">#</a> 2. 启动类</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderNacosMain83</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">OrderNacosMain83</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * RestTemplate结合Ribbon做负载均衡一定要加@LoadBalanced
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@LoadBalanced</span>
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">getRestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h5 id="_3-controller"><a href="#_3-controller" class="header-anchor">#</a> 3. controller</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderNacosController</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 因为在yml中配置了service-url.nacos-user-service，
     * 这里不需要再定义要访问微服务名常量，而是通过boot直接读出来
     */</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${service-url.nacos-user-service}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> serverURL<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    <span class="token comment">/**
     * Nacos测试Ribbon
     * http://localhost:83/consumer/payment/nacos/1
     * @param id
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/payment/nacos/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">paymentInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;******serverURL: {}, id: {}&quot;</span> <span class="token operator">+</span> serverURL<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>serverURL <span class="token operator">+</span> <span class="token string">&quot;/payment/nacos/&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h5 id="_4-结果"><a href="#_4-结果" class="header-anchor">#</a> 4. 结果</h5> <p>http://localhost:83/consumer/payment/nacos/1</p> <p>轮询访问 9001,9002,9011</p> <h4 id="_3-服务中心的对比"><a href="#_3-服务中心的对比" class="header-anchor">#</a> 3. 服务中心的对比</h4> <h5 id="_1-nacos"><a href="#_1-nacos" class="header-anchor">#</a> 1. nacos</h5> <p>Nacos地图</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160428.jpg" alt=""></p> <p><strong>Nacos生态图</strong></p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160432.png" alt=""></p> <p>如 Nacos 全景图所示，Nacos 无缝支持一些主流的开源生态，例如</p> <ul><li><a href="https://nacos.io/en-us/docs/quick-start-spring-cloud.html" target="_blank" rel="noopener noreferrer">Spring Cloud<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://nacos.io/zh-cn/docs/xx" target="_blank" rel="noopener noreferrer">Apache Dubbo and Dubbo Mesh TODO<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://nacos.io/zh-cn/docs/xx" target="_blank" rel="noopener noreferrer">Kubernetes and CNCF TODO<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li> <li>......</li></ul> <h5 id="_2-对比"><a href="#_2-对比" class="header-anchor">#</a> 2.  对比</h5> <p>Nacos与其他注册中心特性对比</p> <table><thead><tr><th></th> <th>Nacos</th> <th>Eureka</th> <th>Consul</th> <th>Zookeeper</th> <th>CoreDNS</th></tr></thead> <tbody><tr><td>一致性协议</td> <td>CP+AP</td> <td>AP</td> <td>CP</td> <td>CP</td> <td>/</td></tr> <tr><td>健康状态</td> <td>TCP/HTTP/MYSQL/Client Beat</td> <td>Client Beat</td> <td>TCP/HTTPgRPC</td> <td>Client Beat</td> <td>/</td></tr> <tr><td>负载均衡</td> <td>权重/DSL/metadata/CMDB</td> <td>Ribbon</td> <td>Fabio</td> <td>/</td> <td>RR</td></tr> <tr><td>雪崩效应</td> <td>支持</td> <td>支持</td> <td>不支持</td> <td>不支持</td> <td>不支持</td></tr> <tr><td>自动注销实例</td> <td>支持</td> <td>支持</td> <td>不支持</td> <td>支持</td> <td>不支持</td></tr> <tr><td>访问协议</td> <td>HTTP/DNS/UDP</td> <td>HTTP</td> <td>HTTP/DNS</td> <td>TCP</td> <td>DNS</td></tr> <tr><td>监听支持</td> <td>支持</td> <td>支持</td> <td>支持</td> <td>支持</td> <td>不支持</td></tr> <tr><td>多数据中心</td> <td>支持</td> <td>支持</td> <td>支持</td> <td>不支持</td> <td>不支持</td></tr> <tr><td>跨注册中心</td> <td>支持</td> <td>不支持</td> <td>支持</td> <td>不支持</td> <td>不支持</td></tr> <tr><td>SpringCloud集成</td> <td>支持</td> <td>支持</td> <td>支持</td> <td>不支持</td> <td>不支持</td></tr> <tr><td>Dubbo集成</td> <td>支持</td> <td>不支持</td> <td>不支持</td> <td>支持</td> <td>不支持</td></tr> <tr><td>K8s集成</td> <td>支持</td> <td>不支持</td> <td>支持</td> <td>不支持</td> <td>支持</td></tr></tbody></table> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160438.jpg" alt=""></p> <h5 id="_3-nacos的ap与cp切换"><a href="#_3-nacos的ap与cp切换" class="header-anchor">#</a> 3. Nacos的AP与CP切换 😄</h5> <p>==C是所有节点在同一时间看到的数据是一致的；而A的定义是所有的请求都会受到响应。==</p> <p>何时选择使用何种模式？</p> <p>一般来说，如果不需要存储服务级别的信息且服务实例是通过nacos-client注册，并能够保持心跳上报，那么就可以选择AP模式。当前主流的服务如SpringCloud和Dubbo服务，都适用与AP模式，AP模式为了服务的可能性而减弱了一致性，因此==AP模式下只支持注册临时实例。==</p> <p>如果需要在服务级别编辑或存储配置信息，那么CP是必须，K8S服务和DNS服务则适用于CP模式。==CP模式下则支持注册持久化实例，==此时则是以Raft协议为集群运行模式，该模式下注册实例之前必须先注册服务，如果服务不出存在，则会返回错误。</p> <p>==<strong>模式的切换</strong>==</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>用下面命令切换
curl <span class="token operator">-</span><span class="token class-name">X</span> <span class="token constant">PUT</span> '$<span class="token constant">NACOS_SERVER</span><span class="token operator">:</span><span class="token number">8848</span><span class="token operator">/</span>nacos<span class="token operator">/</span>v1<span class="token operator">/</span>ns<span class="token operator">/</span>operator<span class="token operator">/</span>switches<span class="token operator">?</span>entry<span class="token operator">=</span>serverMode<span class="token operator">&amp;</span>value<span class="token operator">=</span><span class="token constant">CP</span>'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-nacos作为服务配置中心-等同-eureka-config-bus"><a href="#_3-nacos作为服务配置中心-等同-eureka-config-bus" class="header-anchor">#</a> 3. Nacos作为服务配置中心  ==<sup>等同: eureka+config+bus</sup>==</h3> <h4 id="_1-基础配置操作"><a href="#_1-基础配置操作" class="header-anchor">#</a> 1. 基础配置操作</h4> <ol><li>依赖</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="2"><li>配置文件(同SpringCloud Config bootstrap.yml 和 application.yml)
<ul><li>Nacos同springcloud-config一样，在项目初始化时，要保证先从配置中心进行配置拉取，拉取配置后，才能保证项目的正常启动。</li> <li>SpringCloud中配置文件的加载是存在优先级顺序的，bootstrap优先级高于application</li></ul></li></ol> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token comment">#application.yml  [bootstrap.yml 优先级高于 application.yml]</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment">#开发环境</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token comment">#bootstrap.xml</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3377</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>config<span class="token punctuation">-</span>client
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#Nacos服务注册中心地址</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#Nacos作为配置中心地址</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yml  <span class="token comment">#指定yaml格式的配置</span>

<span class="token comment"># ${spring.application.name}-${spring.profile.active}.${spring.cloud.nacos.config.file.extension}</span>
<span class="token comment"># nacos-config-client-dev.yml</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ol start="3"><li>启动类</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosConfigClientMain3377</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">NacosConfigClientMain3377</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="4"><li>业务  <code>@RefreshScope</code>  SpringCloud原生注解 支持Nacos的动态刷新功能</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Slf4j
@RestController
@RefreshScope 
public class ConfigClientController {

    @Value(&quot;${config.info}&quot;)
    private String configInfo;

    @GetMapping(&quot;/config/info&quot;)
    public String getConfigInfo(){
        log.info(&quot;******configInfo: {}, time: {}&quot;,configInfo,new Date());
        return configInfo;
    }
    
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="5"><li><p>启动前</p> <ul><li><p>保证yaml启动文件有</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160445.png" alt=""></p></li> <li><p>运行启动类</p></li></ul></li> <li><p>结果</p></li></ol> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160451.png" alt=""></p> <p>结果: 当修改配置文件时候,刷新页面==自动刷新配置信息==(没有SpringCloud Config的一系列解决[Config+Bus])</p> <h4 id="_2-在nacos中添加配置信息"><a href="#_2-在nacos中添加配置信息" class="header-anchor">#</a> 2. 在Nacos中添加配置信息</h4> <p><code>理论：Nacos中的匹配规则</code> <a href="https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
Nacos中的dataid的组成格式及与SpringBoot配置文件中的匹配规则</p> <p>在 Nacos Spring Cloud 中，<code>dataId</code> 的完整格式如下：</p> <div class="language-plain line-numbers-mode"><pre class="language-plain"><code>${prefix}-${spring.profile.active}.${file-extension}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>prefix</code> 默认为 <code>spring.application.name</code> 的值，也可以通过配置项 <code>spring.cloud.nacos.config.prefix</code>来配置。</li> <li><code>spring.profile.active</code> 即为当前环境对应的 profile，详情可以参考 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-profiles.html#boot-features-profiles" target="_blank" rel="noopener noreferrer">Spring Boot文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。 <strong>注意：当 <code>spring.profile.active</code> 为空时，对应的连接符 <code>-</code> 也将不存在，dataId 的拼接格式变成 <code>${prefix}.${file-extension}</code></strong></li> <li><code>file-exetension</code> 为配置内容的数据格式，可以通过配置项 <code>spring.cloud.nacos.config.file-extension</code> 来配置。目前只支持 <code>properties</code> 和 <code>yaml</code> 类型。</li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160456.png" alt=""></p> <p>Nacos中配置</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160501.png" alt=""></p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160513.png" alt=""><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160517.png" alt=""></p> <h4 id="_3-分类配置"><a href="#_3-分类配置" class="header-anchor">#</a> 3. 分类配置</h4> <h5 id="_1-多环境多项目管理"><a href="#_1-多环境多项目管理" class="header-anchor">#</a> 1. 多环境多项目管理</h5> <ul><li>问题1：
实际开发中，通常一个系统会准备dev开发环境、test测试环境、prod生产环境，如何保证指定环境启动时服务能正确读取到Nacos上相应环境的配置文件呢？</li> <li>问题2：
一个大型分布式微服务系统会有很多微服务子项目，每个微服务项目又会有相应的开发环境、测试环境、预发环境、正式环境…那怎么对这些微服务配置进行管理呢？</li></ul> <h5 id="_2-nacos界面"><a href="#_2-nacos界面" class="header-anchor">#</a> 2. Nacos界面</h5> <p>配置管理</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160527.png" alt=""></p> <p>命名空间</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160534.png" alt=""></p> <h5 id="_3-namespace-group-data-id三者关系-为什么这么设计"><a href="#_3-namespace-group-data-id三者关系-为什么这么设计" class="header-anchor">#</a> 3. Namespace + Group + Data ID三者关系？为什么这么设计？</h5> <h6 id="_1-是什么-2"><a href="#_1-是什么-2" class="header-anchor">#</a> 1. 是什么?</h6> <p>类似Java中的package名和类名
==最外层的namespace是可以用于区分部署环境的，Group和DataID逻辑上区分两个目标对象==</p> <h6 id="_2-三者情况"><a href="#_2-三者情况" class="header-anchor">#</a> 2. 三者情况</h6> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160540.png" alt=""></p> <p>默认情况：
==Namespace=public，Group=DEFAULT_GROUP，默认Cluster是DEFAULT==</p> <ul><li><p><strong>Nacos默认的命名空间是public</strong>，Namespace主要用来实现==<strong>隔离设计</strong>==
比方说我们现在有三个环境：开发、测试、生产环境，我们就可以创建三个Namespace，不同的Namespace之间是隔离的。</p></li> <li><p>Group默认是DEFAULT_GROUP，Group可以把不同的微服务划分到同一个分组里面去</p></li> <li><p><strong>Service就是微服务</strong>，一个Service可以包含多个Cluster（集群）,Nacos默认Cluster是DEFAULT，Cluster是对指定微服务的一个虚拟划分
比方说为了容灾，将Service微服务分别部署在了杭州机房和广州机房，这时就可以给杭州机房的Service微服务起一个集群名称（HZ）给广州机房的Service微服务起一个集群名称（GZ），还可以尽量让同一个机房的微服务互相调用，以提升性能。(划片划分)</p></li></ul> <p>最后是Instance，就是微服务的实例。</p> <h4 id="_4-三种方案-分类配置"><a href="#_4-三种方案-分类配置" class="header-anchor">#</a> 4. 三种方案 (分类配置)</h4> <h5 id="_1-dataid方案"><a href="#_1-dataid方案" class="header-anchor">#</a> 1. DataID方案</h5> <ul><li><p>指定spring.profile.active和配置文件的DataID来使不同环境下读取不同的配置</p></li> <li><p>默认空间 + 默认分组 + 新建dev和test两个DataID</p></li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160546.png" alt=""></p> <ul><li>修改application.yml</li></ul> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token comment">#application.yml  [bootstrap.yml 优先级高于 application.yml]</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
<span class="token comment">#    active: dev #开发环境</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> test <span class="token comment">#测试环境</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>测试 (配置什么,加载什么)</li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160553.png" alt=""></p> <h5 id="_2-group方案"><a href="#_2-group方案" class="header-anchor">#</a> 2. Group方案</h5> <ul><li>通过Group实现环境区分</li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160602.png" alt=""></p> <ul><li>配置修改</li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160608.png" alt=""></p> <ul><li>测试</li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160613.png" alt=""></p> <h5 id="_3-namespace-方案"><a href="#_3-namespace-方案" class="header-anchor">#</a> 3. Namespace 方案</h5> <ol><li>新增命名空间</li></ol> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160620.png" alt=""></p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160624.png" alt=""></p> <ol start="2"><li>配置config</li></ol> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160629.png" alt=""></p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160637.png" alt=""></p> <ul><li><p>测试</p></li> <li><div class="language-xml line-numbers-mode"><pre class="language-xml"><code>file-extension: yml  #指定yaml格式的配置
group: TEST_GROUP # 指定组名
namespace: af21dbe7-d7d7-45ac-866f-c9d49370c213 # 指定命名空间 dev: af21dbe7-d7d7-45ac-866f-c9d49370c213
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul> <h4 id="_5-扩展id"><a href="#_5-扩展id" class="header-anchor">#</a> 5. 扩展ID</h4> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160642.png" alt=""></p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160653.png" alt=""></p> <h3 id="_4-nacos集群和持久化"><a href="#_4-nacos集群和持久化" class="header-anchor">#</a> 4. Nacos集群和持久化</h3> <h4 id="_1-集群"><a href="#_1-集群" class="header-anchor">#</a> 1. <a href="https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html" target="_blank" rel="noopener noreferrer"> 集群<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <h5 id=""><a href="#" class="header-anchor">#</a> <img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160657.png" alt=""></h5> <p>**默认Nacos使用嵌入式数据库（derby）**实现数据的存储。所以，如果启动多个默认配置下的Nacos节点，数据存储是存在一致性问题的。
为了解决这个问题，==<strong>Nacos采用了集中式存储的方式来支持集群化部署，目前只支持Mysql的存储。</strong>==</p> <p><a href="https://nacos.io/zh-cn/docs/deployment.html" target="_blank" rel="noopener noreferrer">Nacos支持三种部署模式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>单机模式：用于测试和单机试用</li> <li>集群模式：用于生产环境，确保高可用</li> <li>多集群模式：用于多数据中心场景</li></ul> <h4 id="_2-持久化切换配置"><a href="#_2-持久化切换配置" class="header-anchor">#</a> 2.  持久化切换配置</h4> <ul><li>默认Nacos使用嵌入式数据库（derby)</li></ul> <h5 id="_1-derby到mysql切换配置步骤"><a href="#_1-derby到mysql切换配置步骤" class="header-anchor">#</a> 1.  derby到mysql切换配置步骤</h5> <ol><li>nacos-server-1.1.4\nacos\conf 目录下执行sql脚本 <code>nacos-mysql.sql</code></li> <li>nacos-server-1.1.4\nacos\conf 目录下找到<code>application.properties</code>，添加配置：</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>spring.datasource.platform=mysql
db.num=1
db.url.0=jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true
db.user=xxx
db.password=xxx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="_2-mysql生产环境配置"><a href="#_2-mysql生产环境配置" class="header-anchor">#</a> 2.  MYSQL生产环境配置</h5> <h6 id="_1-预计需要-1个ngnix-3个nacos注册中心-1个mysql"><a href="#_1-预计需要-1个ngnix-3个nacos注册中心-1个mysql" class="header-anchor">#</a> 1. 预计需要,1个ngnix+3个nacos注册中心+1个MySQL</h6> <h6 id="_2-配置nacos-linux"><a href="#_2-配置nacos-linux" class="header-anchor">#</a> 2. 配置nacos(linux)</h6> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160705.png" alt=""></p> <h6 id="_3-配置"><a href="#_3-配置" class="header-anchor">#</a> 3.  配置</h6> <ul><li><p>linux上MYSQL配置</p></li> <li><p>application.properties配置</p></li> <li><p>linux上的nacos的集群配置cluster.conf</p> <ul><li>三台nacos,不同端口号</li> <li>复制出cluster.conf</li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160712.png" alt=""></p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160721.png" alt=""></p> <ul><li><p>内容</p> <p>在 &quot;/mynacos/nacos/bin “ 目录下startup.sh</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160729.png" alt=""></p> <p>修改</p></li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/alibaba-Nacos34.png?x-oss-process=style/shuiyin_1" alt=""></p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/alibaba-Nacos35.png?x-oss-process=style/shuiyin_1" alt=""></p> <p>结果  ==修改 &quot;#&quot;  为 &quot; $&quot;==</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160746.png" alt=""></p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160749.png" alt=""></p></li></ul> <p>​              执行方式</p> <p>​						./startup.sh -p 3333  Ubuntu : bash startup.sh -p 3333</p> <p>​				      <img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160755.png" alt=""></p> <h6 id="_4-ngnix配置-负载均衡"><a href="#_4-ngnix配置-负载均衡" class="header-anchor">#</a> 4. ngnix配置  负载均衡</h6> <p>/opt/nginx-1.17.9/conf</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160800.png" alt=""></p> <p>启动</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>./ngnix <span class="token parameter variable">-c</span> /opt/nginx-1.17.9/conf/ngnix.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h6 id="_5-测试"><a href="#_5-测试" class="header-anchor">#</a> 5. 测试</h6> <ul><li><p>nacos 集群启动</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160807.png" alt=""></p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160812.png" alt=""></p></li> <li><p>ngnix启动  https://www.cnblogs.com/gede/p/11011693.html</p></li></ul> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code>nginx文件安装完成之后的文件位置：

/usr/sbin/nginx：主程序
/etc/nginx：存放配置文件
/usr/share/nginx：存放静态文件
/var/log/nginx：存放日志

<span class="token comment"># 彻底卸载nginx</span>
<span class="token key attr-name">apt-get</span> <span class="token value attr-value">--purge autoremove nginx</span>

<span class="token key attr-name">service</span> <span class="token value attr-value">nginx start</span>


<span class="token comment"># naccos集群配置</span>
<span class="token key attr-name">    upstream</span> <span class="token value attr-value">cluster{</span>
<span class="token key attr-name">        server</span> <span class="token value attr-value">116.196.118.167:3333;</span>
<span class="token key attr-name">        server</span> <span class="token value attr-value">116.196.118.167:4444;</span>
<span class="token key attr-name">        server</span> <span class="token value attr-value">116.196.118.167:5555;</span>
    }


<span class="token key attr-name">    server</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">        listen</span> <span class="token value attr-value">      1111;</span>
<span class="token key attr-name">        server_name</span> <span class="token value attr-value"> 16.196.118.167;</span>

<span class="token key attr-name">        location</span> <span class="token value attr-value">/ {</span>
<span class="token comment">            #root   html;</span>
<span class="token comment">            #index  index.html index.htm;</span>
<span class="token key attr-name">            proxy_pass</span> <span class="token value attr-value">http://cluster;</span>
        }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><ul><li><p>结果</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160830.png" alt="">*</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160834.png" alt=""></p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160838.png" alt=""></p></li></ul> <p>linux  http://116.196.118.167:1111/nacos/  (测试3台Nacos+1台Ngnix+1台MySQL)</p> <p>客户端访问先访问NGINX.</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160843.png" alt=""></p> <hr> <h2 id="_3-springcloud-alibaba-sentinel-实现熔断与限流"><a href="#_3-springcloud-alibaba-sentinel-实现熔断与限流" class="header-anchor">#</a> 3. SpringCloud Alibaba Sentinel 实现熔断与限流 😄</h2> <h3 id="_1-sentinel-代替了-hystrix"><a href="#_1-sentinel-代替了-hystrix" class="header-anchor">#</a> 1. <a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">Sentinel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 代替了 Hystrix</h3> <ul><li><p><a href="https://github.com/alibaba/Sentinel/releases" target="_blank" rel="noopener noreferrer">下载地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://blog.csdn.net/qq_29635485/article/details/103100251?depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-2&amp;utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-2" target="_blank" rel="noopener noreferrer">linux docker安装<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>==面向云原生微服务的<strong>高可用流控防护组件</strong>==</p></li> <li><p>==分布式系统的流量防卫兵==</p></li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160851.png" alt=""></p> <h4 id="_1-sentinel"><a href="#_1-sentinel" class="header-anchor">#</a> 1. Sentinel</h4> <p>特性</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160856.png" alt=""></p> <ul><li>服务雪崩</li> <li>服务降级</li> <li>服务熔断</li> <li>服务限流</li></ul> <p>生态图</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160901.png" alt=""></p> <h4 id="_2-sentinel分为两个部分"><a href="#_2-sentinel分为两个部分" class="header-anchor">#</a> 2. Sentinel分为两个部分：</h4> <ul><li><strong>核心库</strong>（Java客户端）不依赖任何框架/库，能够运行于所有Java运行时环境，同时对Dubbo/Spring Cloud等框架也有较好的支持。</li> <li><strong>控制台</strong>（Dashboard）基于SpringBoot开发，打包后可以直接运行，不需要额外的Tomcat等应用容器。</li></ul> <h4 id="_3-sentinel下载"><a href="#_3-sentinel下载" class="header-anchor">#</a> 3. sentinel下载</h4> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code>java <span class="token punctuation">-</span>jar sentinel<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>1.7.1.jar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160907.png" alt=""></p> <p>访问</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160912.png" alt=""></p> <p>用户: sentinel  密码: sentinel</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160918.png" alt=""></p> <p>容错,限流,监控平台成功.(比Hystrix方便)</p> <h3 id="_2-案例"><a href="#_2-案例" class="header-anchor">#</a> 2. 案例</h3> <h4 id="_1-依赖-2"><a href="#_1-依赖-2" class="header-anchor">#</a> 1.  依赖</h4> <ul><li>springcloud alibaba sentinel</li></ul> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--springcloud alibaba nacos--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--springcloud alibaba sentinel-datasource-nacos 后续做持久化用到--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--springcloud alibaba sentinel--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_2-准备"><a href="#_2-准备" class="header-anchor">#</a> 2. 准备</h4> <ul><li>注册中心</li> <li>sentinel启动</li></ul> <h4 id="_3-测试"><a href="#_3-测试" class="header-anchor">#</a> 3 测试</h4> <ol><li><p>启动后,空空如也   ==sentinel采用了<strong>懒加载</strong>==</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160931.png" alt=""></p></li> <li><p>需要执行一次访问,才能访问?</p> <ul><li>http://localhost:8401/testA</li> <li>http://localhost:8401/testB</li></ul></li></ol> <p>​     <img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160936.png" alt=""></p> <ol start="3"><li>sentinel8080正在监控8401</li></ol> <h3 id="_3-流控规则-官网-方法细粒度"><a href="#_3-流控规则-官网-方法细粒度" class="header-anchor">#</a> 3. 流控规则 官网 <sup>方法细粒度</sup></h3> <ul><li>流量限制,控制</li></ul> <h4 id="_1-基本介绍"><a href="#_1-基本介绍" class="header-anchor">#</a> 1. 基本介绍</h4> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160941.png" alt=""></p> <ol><li><p>资源名：唯一名称，默认请求路径</p></li> <li><p>针对来源：Sentinel可以针对调用者进行限流，填写微服务名，默认default（不区分来源）</p></li> <li><p>阈值类型/单机阈值：</p> <ul><li>QPS（每秒钟的请求数量）：当调用该api的QPS达到阈值的时候，进行限流</li> <li>线程数：当调用该api的线程数达到阈值的时候，进行限流</li></ul></li> <li><p>是否集群：（不）需要集群</p></li> <li><p>流控模式：</p> <ul><li>直接：api达到限流条件时，直接限流</li> <li>关联：当关联的资源达到阈值时，就限流自己</li> <li>链路：只记录指定链路上的流量（指定资源从入口资源进来的流量，如果达到阈值，就进行限流）</li></ul></li> <li><p>流控效果：</p> <ul><li>快速失败：直接失败，抛异常</li> <li>Warm Up：根据codeFactor（冷加载因子，默认3）的值，从阈值/codeFactor，经过预热时长，才达到设置的QPS阈值。</li> <li>排队等待：匀速排队，让请求以匀速的速度通过，阈值类型必须设置为QPS。否则无效。</li></ul></li></ol> <h4 id="_2-流控模式-官网-方法细粒度"><a href="#_2-流控模式-官网-方法细粒度" class="header-anchor">#</a> 2. 流控模式  <a href="https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <sup>方法细粒度</sup></h4> <h5 id="_1-流控模式-直接-默认"><a href="#_1-流控模式-直接-默认" class="header-anchor">#</a> 1. 流控模式——直接(默认)</h5> <h6 id="_1-qps"><a href="#_1-qps" class="header-anchor">#</a> 1. QPS</h6> <ul><li><p>快速失败</p></li> <li><p>规则: 每秒只能访问1次,超过一次==限流==</p></li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160946.png" alt=""></p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160951.png" alt=""></p> <p>思考: 直接调用默认的报错信息,技术方面OK,但是,是否应哎呦我们自己的后续处理? 类似于Hystrix的==fallback的兜底方法==?</p> <h6 id="_2-线程数"><a href="#_2-线程数" class="header-anchor">#</a> 2. 线程数：</h6> <ul><li>直接失败</li></ul> <p>当调用该api的线程数达到阈值的时候，进行限流</p> <h5 id="_2-关联-快速失败"><a href="#_2-关联-快速失败" class="header-anchor">#</a> 2.  关联 -<strong>快速失败</strong></h5> <ul><li>支付下订单: 支付达到峰值,让下订单系统降级</li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223160956.png" alt=""></p> <p>postman测试</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161000.png" alt=""></p> <ul><li>当有大量并发请求打到B上，A就限流自己。</li></ul> <h4 id="_3-流控效果-官网"><a href="#_3-流控效果-官网" class="header-anchor">#</a> 3. 流控效果 <a href="https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <h5 id="_1-直接"><a href="#_1-直接" class="header-anchor">#</a> 1.  直接</h5> <h5 id="_2-warm-up-预热"><a href="#_2-warm-up-预热" class="header-anchor">#</a> 2. Warm Up(预热)</h5> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161007.png" alt=""></p> <h5 id="_3-排队等待"><a href="#_3-排队等待" class="header-anchor">#</a> 3. 排队等待</h5> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161012.png" alt=""></p> <h3 id="_4-降级规则-官网-方法细粒度"><a href="#_4-降级规则-官网-方法细粒度" class="header-anchor">#</a> 4. 降级规则 <a href="https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <sup>方法细粒度</sup></h3> <ul><li>==同Hystrix==</li></ul> <h4 id="_1-基本使用"><a href="#_1-基本使用" class="header-anchor">#</a> 1. 基本使用</h4> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161017.png" alt=""></p> <ol><li>RT (平均时间,秒级)
<ul><li>平均响应时间<strong>超出阈值</strong>,且在<strong>时间窗口内通过的请求&gt;=5</strong>,两个条件同时满足后出发==降级==,窗口期过后关闭断路器</li> <li>RT最大4900(跟大的需要通过-Dcsp.sentinel.statistic.max.rt=xxxx才能生效)</li></ul></li> <li>异常比例(秒级)
<ul><li>QPS &gt;= 5 且 异常比例(秒级统计)超过阈值,出发降级;时间窗口结束后,关闭降级</li></ul></li> <li>异常数(分钟级)
<ul><li>异常数(分钟统计)超过阈值是,触发降级;时间窗口结束后,关闭降级.</li></ul></li></ol> <h4 id="_2-进一步说明"><a href="#_2-进一步说明" class="header-anchor">#</a> 2.  进一步说明</h4> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161023.png" alt=""></p> <ul><li>sentinel的短路器是没有半开状态的(Hystrix有三个)</li></ul> <h4 id="_3-测试-2"><a href="#_3-测试-2" class="header-anchor">#</a> 3. 测试</h4> <h5 id="_1"><a href="#_1" class="header-anchor">#</a> 1.</h5> <p>平均响应时间 (<code>DEGRADE_GRADE_RT</code>)：当 1s 内持续进入 5 个请求，对应时刻的平均响应时间（秒级）均超过阈值（<code>count</code>，以 ms 为单位），那么在接下的时间窗口（<code>DegradeRule</code> 中的 <code>timeWindow</code>，以 s 为单位）之内，对这个方法的调用都会自动地熔断（抛出 <code>DegradeException</code>）。注意 Sentinel 默认统计的 RT 上限是 4900 ms，<strong>超出此阈值的都会算作 4900 ms</strong>，若需要变更此上限可以通过启动配置项 <code>-Dcsp.sentinel.statistic.max.rt=xxx</code> 来配置</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161028.png" alt=""></p> <ul><li>配置</li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161033.png" alt=""></p> <p>....</p> <h3 id="_5-热点key限流-官网-方法细粒度"><a href="#_5-热点key限流-官网-方法细粒度" class="header-anchor">#</a> 5. 热点key限流 😄 <a href="https://github.com/alibaba/Sentinel/wiki/%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <sup>方法细粒度</sup></h3> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161039.png" alt=""></p> <p>何为热点？热点即经常访问的数据。很多时候我们希望统计某个热点数据中访问频次最高的 Top K 数据，并对其访问进行限制。比如：</p> <ul><li>商品 ID 为参数，统计一段时间内最常购买的商品 ID 并进行限制</li> <li>用户 ID 为参数，针对一段时间内频繁访问的用户 ID 进行限制</li></ul> <h4 id="_1-之前方法"><a href="#_1-之前方法" class="header-anchor">#</a> 1. 之前方法</h4> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161045.png" alt=""></p> <p>==BlockException==</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.alibaba.csp.sentinel.slots.block;

public abstract class BlockException extends Exception {

    public static final String BLOCK_EXCEPTION_FLAG = &quot;SentinelBlockException&quot;;
    /**
     * &lt;p&gt;this constant RuntimeException has no stack trace, just has a message
     * {@link #BLOCK_EXCEPTION_FLAG} that marks its name.
     * &lt;/p&gt;
     * &lt;p&gt;
     * Use {@link #isBlockException(Throwable)} to check whether one Exception
     * Sentinel Blocked Exception.
     * &lt;/p&gt;
     */
    public static RuntimeException THROW_OUT_EXCEPTION = new RuntimeException(BLOCK_EXCEPTION_FLAG);

    public static StackTraceElement[] sentinelStackTrace = new StackTraceElement[] {
        new StackTraceElement(BlockException.class.getName(), &quot;block&quot;, &quot;BlockException&quot;, 0)
    };

    static {
        THROW_OUT_EXCEPTION.setStackTrace(sentinelStackTrace);
    }

    protected AbstractRule rule;
    private String ruleLimitApp;

    public BlockException(String ruleLimitApp) {
        super();
        this.ruleLimitApp = ruleLimitApp;
    }

    public BlockException(String ruleLimitApp, AbstractRule rule) {
        super();
        this.ruleLimitApp = ruleLimitApp;
        this.rule = rule;
    }

    public BlockException(String message, Throwable cause) {
        super(message, cause);
    }

    public BlockException(String ruleLimitApp, String message) {
        super(message);
        this.ruleLimitApp = ruleLimitApp;
    }

    public BlockException(String ruleLimitApp, String message, AbstractRule rule) {
        super(message);
        this.ruleLimitApp = ruleLimitApp;
        this.rule = rule;
    }

    @Override
    public Throwable fillInStackTrace() {
        return this;
    }

    public String getRuleLimitApp() {
        return ruleLimitApp;
    }

    public void setRuleLimitApp(String ruleLimitApp) {
        this.ruleLimitApp = ruleLimitApp;
    }

    /**
     * Check whether the exception is sentinel blocked exception. One exception is sentinel blocked
     * exception only when:
     * &lt;ul&gt;
     * &lt;li&gt;the exception or its (sub-)cause is {@link BlockException}, or&lt;/li&gt;
     * &lt;li&gt;the exception's message is or any of its sub-cause's message equals to {@link #BLOCK_EXCEPTION_FLAG}&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * @param t the exception.
     * @return return true if the exception marks sentinel blocked exception.
     */
    public static boolean isBlockException(Throwable t) {
        if (null == t) {
            return false;
        }

        int counter = 0;
        Throwable cause = t;
        while (cause != null &amp;&amp; counter++ &lt; 50) {
            if ((cause instanceof BlockException) || (BLOCK_EXCEPTION_FLAG.equals(cause.getMessage()))) {
                return true;
            }
            cause = cause.getCause();
        }

        return false;
    }

    public AbstractRule getRule() {
        return rule;
    }
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br></div></div><h4 id="_2-案例-自定义处理"><a href="#_2-案例-自定义处理" class="header-anchor">#</a> 2. 案例--自定义处理</h4> <ul><li>配置文件</li></ul> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloudalibaba<span class="token punctuation">-</span>sentinel<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token comment"># Nacos服务注册中心地址</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">transport</span><span class="token punctuation">:</span>
        <span class="token comment"># sentinel dashboard 地址</span>
        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span>
        <span class="token comment"># 默认为8719，如果被占用会自动+1，直到找到为止</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8719</span>
      <span class="token comment"># 流控规则持久化到nacos</span>
      <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">dsl</span><span class="token punctuation">:</span>
          <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
            <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
            <span class="token key atrule">data-id</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>
            <span class="token key atrule">group-id</span><span class="token punctuation">:</span> DEFAULT_GROUP
            <span class="token key atrule">data-type</span><span class="token punctuation">:</span> json
            <span class="token key atrule">rule-type</span><span class="token punctuation">:</span> flow
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul><li>业务</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 热点限流
 *  @SentinelResource(value = &quot;testHotKey&quot;,blockHandler = &quot;deal_testHotKey&quot;)
 *  value: 资源名
 *  blockHandler: 兜底方法
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/testHotKey&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;testHotKey&quot;</span><span class="token punctuation">,</span>blockHandler <span class="token operator">=</span> <span class="token string">&quot;deal_testHotKey&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testHotKey</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;p1&quot;</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> p1<span class="token punctuation">,</span>
                         <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;p1&quot;</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> p2<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;testHotKey&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">deal_testHotKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> p1<span class="token punctuation">,</span> <span class="token class-name">String</span> p2<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;---------------deal_testHotKey,o(╥﹏╥)o&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>测试</li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161056.png" alt=""></p> <p>sentinel</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161100.png" alt=""></p> <p>选取方式</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161108.png" alt=""></p> <ul><li>结果  ==QPS 超过一次,降级处理==</li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161117.png" alt=""></p> <h4 id="_3-参数例外项"><a href="#_3-参数例外项" class="header-anchor">#</a> 3. 参数例外项</h4> <ul><li>上述案例,QPS&gt;1,马上限流</li></ul> <ol><li><p>特例</p> <ul><li>普通: 超过一秒之后,达到阈值1后,马上被限流</li> <li>我么期望P1参数,当它为某个特殊值时,它的限流和平时不一样</li> <li>==特例: 加入当p1的值为5时,它的阈值可以达到200==</li></ul></li> <li><p>配置</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161122.png" alt=""></p></li> <li><p>结果</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161126.png" alt=""></p></li></ol> <p>==前提: 热点的参数必须为基本类型/string==</p> <h4 id="_4-注意点"><a href="#_4-注意点" class="header-anchor">#</a> 4. 注意点</h4> <p><strong>@SentinelResource</strong>:</p> <p>处理的是Sentinel控制台配置的违规情况,有BlockHandler方法配置的兜底处理</p> <p><strong>@RuntimeException</strong>:</p> <p>int age = 10/0,这个是java运行时报出的运行时异常,@SentinelResource不处理</p> <p>==<strong>总结: @SentinelResource主管配置出错,运行出错该走异常走异常</strong>==</p> <h3 id="_6-系统规则-官网-系统-应用整体-从入口座整体"><a href="#_6-系统规则-官网-系统-应用整体-从入口座整体" class="header-anchor">#</a> 6. 系统规则 <a href="https://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <sup>系统(应用整体,从入口座整体)</sup></h3> <h4 id="_1-系统规则"><a href="#_1-系统规则" class="header-anchor">#</a> 1. 系统规则</h4> <p>系统保护规则是从应用级别的入口流量进行控制，从单台机器的 load、CPU 使用率、平均 RT、入口 QPS 和并发线程数等几个维度监控应用指标，让系统尽可能跑在最大吞吐量的同时保证系统整体的稳定性。</p> <p>系统保护规则是应用整体维度的，而不是资源维度的，并且<strong>仅对入口流量生效</strong>。入口流量指的是进入应用的流量（<code>EntryType.IN</code>），比如 Web 服务或 Dubbo 服务端接收的请求，都属于入口流量。</p> <p>系统规则支持以下的模式：</p> <ul><li><strong>Load 自适应</strong>（仅对 Linux/Unix-like 机器生效）：系统的 load1 作为启发指标，进行自适应系统保护。当系统 load1 超过设定的启发值，且系统当前的并发线程数超过估算的系统容量时才会触发系统保护（BBR 阶段）。系统容量由系统的 <code>maxQps * minRt</code> 估算得出。设定参考值一般是 <code>CPU cores * 2.5</code>。</li> <li><strong>CPU usage</strong>（1.5.0+ 版本）：当系统 CPU 使用率超过阈值即触发系统保护（取值范围 0.0-1.0），比较灵敏。</li> <li><strong>平均 RT</strong>：当单台机器上所有入口流量的平均 RT 达到阈值即触发系统保护，单位是毫秒。</li> <li><strong>并发线程数</strong>：当单台机器上所有入口流量的并发线程数达到阈值即触发系统保护。</li> <li><strong>入口 QPS</strong>：当单台机器上所有入口流量的 QPS 达到阈值即触发系统保护。</li></ul> <h3 id="_7-sentinelresource"><a href="#_7-sentinelresource" class="header-anchor">#</a> 7. @SentinelResource</h3> <h4 id="_1-按照资源名称限流-后续处理"><a href="#_1-按照资源名称限流-后续处理" class="header-anchor">#</a> 1. 按照资源名称限流+后续处理</h4> <ul><li><p>nacos启动</p></li> <li><p>sentinel启动</p></li> <li><p>依赖</p></li> <li><p>代码</p></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 按资源名称限流
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/byResource&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;byResource&quot;</span><span class="token punctuation">,</span>blockHandler <span class="token operator">=</span> <span class="token string">&quot;handlerException&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">byResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">&quot;按资源名称限流测试OK&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span><span class="token number">2020L</span><span class="token punctuation">,</span><span class="token string">&quot;serial001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 兜底方法
 */</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">handlerException</span><span class="token punctuation">(</span><span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span>exception<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t 服务不可用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>结果: ==此种方法是<strong>临时的</strong>,关闭服务后,sentinel控制台的流控消失==</li></ul> <h4 id="_2-按照url地址称限流-后续处理"><a href="#_2-按照url地址称限流-后续处理" class="header-anchor">#</a> 2.  按照url地址称限流+后续处理</h4> <p>....</p> <h4 id="_3-上面兜底方案面临的问题-hystrix"><a href="#_3-上面兜底方案面临的问题-hystrix" class="header-anchor">#</a> 3. 上面兜底方案面临的问题 (Hystrix)</h4> <ul><li>系统默认的,没有体现我们的业务要求</li> <li>依照现有条件,我们自定义的处理方法有何业务<strong>代码耦合</strong>在一块,不直观</li> <li>每个业务方法都添加兜底,那<strong>代码膨胀</strong>加剧</li> <li><strong>全局统一的处理方法没有体现</strong></li></ul> <h4 id="_4-客户自定义限流处理逻辑"><a href="#_4-客户自定义限流处理逻辑" class="header-anchor">#</a> 4. 客户自定义限流处理逻辑</h4> <ul><li>跟业务代码解耦</li></ul> <ol><li>自定义限流处理逻辑  customerBlockHandler</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/rateLimit/customerBlockHandler&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;customerBlockHandler&quot;</span><span class="token punctuation">,</span>
                  <span class="token comment">// 那个类</span>
        blockHandlerClass <span class="token operator">=</span> <span class="token class-name">CustomerBlockHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
                  <span class="token comment">// 那个方法</span>
        blockHandler <span class="token operator">=</span> <span class="token string">&quot;handlerException2&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">customerBlockHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">&quot;按客户自定义&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span><span class="token number">2020L</span><span class="token punctuation">,</span><span class="token string">&quot;serial002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerBlockHandler</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CommonResult</span> <span class="token function">handlerException</span><span class="token punctuation">(</span><span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">4444</span><span class="token punctuation">,</span><span class="token string">&quot;按客户自定义，global handlerException-----1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CommonResult</span> <span class="token function">handlerException2</span><span class="token punctuation">(</span><span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">4444</span><span class="token punctuation">,</span><span class="token string">&quot;按客户自定义，global handlerException-----2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161134.png" alt=""></p> <h4 id="_5-更多注解属性说明-官网"><a href="#_5-更多注解属性说明-官网" class="header-anchor">#</a> 5.  更多注解属性说明 <a href="https://github.com/alibaba/Sentinel/wiki/%E6%B3%A8%E8%A7%A3%E6%94%AF%E6%8C%81" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <h5 id="_1-sentinel核心api"><a href="#_1-sentinel核心api" class="header-anchor">#</a> 1. sentinel核心API</h5> <ul><li>sphu定义资源</li> <li>trace定义统计</li> <li>contextUtil定义了上下文</li></ul> <h3 id="_8-服务通断"><a href="#_8-服务通断" class="header-anchor">#</a> 8. 服务通断</h3> <h4 id="_1-sentinel整合ribbon-openfeign-fallback"><a href="#_1-sentinel整合ribbon-openfeign-fallback" class="header-anchor">#</a> 1. sentinel整合ribbon+openfeign+fallback</h4> <p>ribbon: 9003/9004 消费者 84</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token comment">#激活sentinel对feign的支持</span>
<span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><p>feign</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;nacos-payment-provider&quot;</span><span class="token punctuation">,</span>fallback <span class="token operator">=</span> <span class="token class-name">PaymentFallbackService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PaymentService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/paymentSQL/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">paymentSQL</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentFallbackService</span> <span class="token keyword">implements</span> <span class="token class-name">PaymentService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">paymentSQL</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span><span class="token string">&quot;服务降级返回，------------PaymentFallbackService&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span><span class="token string">&quot;errorSerial&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>controller</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CircleBreakerController</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SERVICE_URL</span> <span class="token operator">=</span> <span class="token string">&quot;http://nacos-payment-provider&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/fallback/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//    @SentinelResource(value = &quot;fallback&quot;) //没有配置</span>
<span class="token comment">//    @SentinelResource(value = &quot;fallback&quot;,fallback = &quot;handlerFallback&quot;) //配置了fallback的，fallback只负责业务异常</span>
<span class="token comment">//    @SentinelResource(value = &quot;fallback&quot;,blockHandler = &quot;blockHandler&quot;) // 配置了blockHandler，只负责sentinel控制台配置违规</span>
    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;fallback&quot;</span><span class="token punctuation">,</span>fallback <span class="token operator">=</span> <span class="token string">&quot;handlerFallback&quot;</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">&quot;blockHandler&quot;</span><span class="token punctuation">,</span>
            exceptionsToIgnore <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">IllegalArgumentException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 配置了blockHandler和fallback</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">fallback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> commonResult <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token constant">SERVICE_URL</span> <span class="token operator">+</span> <span class="token string">&quot;/paymentSQL/&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">,</span> <span class="token class-name">CommonResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;IllegalArgumentException,非法参数异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>commonResult<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token string">&quot;NullPointerException,该ID没有记录，空指针异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> commonResult<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 本例是fallback</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">handlerFallback</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Payment</span> payment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span> <span class="token string">&quot;兜底异常handler，exception内容&quot;</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">blockHandler</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Payment</span> payment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">445</span><span class="token punctuation">,</span> <span class="token string">&quot;blockHandler-sentinel 限流，无此流水号：blockException&quot;</span> <span class="token operator">+</span> exception<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// --------------- open feign---------</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">PaymentService</span> paymentService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/paymentSQL/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">paymentSQL</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> paymentService<span class="token punctuation">.</span><span class="token function">paymentSQL</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div></li> <li><p>结果</p></li></ul> <p>==1. 既要配置sentinel(blockHandler),又要配置fallback.两种兜底方法==</p> <p>==sentinel: 管理sentinel控制台的违规出错,不管运行时异常==</p> <p>==fallback: 管理运行时异常==</p> <p>==2. 当blockHandler和fallback都进行了配置,则被限流而降级抛出BlockException时,只会进行<strong>blockHandler处理逻辑</strong>==</p> <p>==3. feign配置fallback防止,被调用的服务方宕机,消费方活活耗死==</p> <h4 id="_2-异常忽略属性-exceptionstoignore"><a href="#_2-异常忽略属性-exceptionstoignore" class="header-anchor">#</a> 2. 异常忽略属性 exceptionsToIgnore</h4> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161142.png" alt=""></p> <p>这个属性,在有异常时,不在有fallback方法兜底,没有降级效果了.</p> <h3 id="_9-规则持久化"><a href="#_9-规则持久化" class="header-anchor">#</a> 9. 规则持久化</h3> <ul><li>关闭服务,sentinel控制台的流控规则消失?????,是持久???是临时???</li></ul> <h4 id="_1-是什么-3"><a href="#_1-是什么-3" class="header-anchor">#</a> 1. 是什么</h4> <ul><li>一旦重启,sentinel规则将消失,生产环境需要降配置规则进行<strong>持久化</strong></li></ul> <h4 id="_2-怎么玩"><a href="#_2-怎么玩" class="header-anchor">#</a> 2. 怎么玩?</h4> <ul><li>将限流配置规则==<strong>持久化进Nacos保存</strong>==,只要刷新8401某个rest地址,sentinel控制台的流控规则就能看到,只要Nacos里面的配置不删除,针对8401上的sentinel上的流控规则持续有效.</li></ul> <h4 id="_3-实现步骤"><a href="#_3-实现步骤" class="header-anchor">#</a> 3. 实现步骤</h4> <ol><li><p>依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--sentinel-datasource-nacos 后续持久化用--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>配置</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloudalibaba<span class="token punctuation">-</span>sentinel<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token comment"># Nacos服务注册中心地址</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">transport</span><span class="token punctuation">:</span>
        <span class="token comment"># sentinel dashboard 地址</span>
        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span>
        <span class="token comment"># 默认为8719，如果被占用会自动+1，直到找到为止</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8719</span>
      <span class="token comment"># 流控规则持久化到nacos</span>
      <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">dsl</span><span class="token punctuation">:</span>
          <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
            <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
            <span class="token comment"># data-id: ${spring.application.name}</span>
            <span class="token key atrule">data-id</span><span class="token punctuation">:</span> cloudalibaba<span class="token punctuation">-</span>sentinel<span class="token punctuation">-</span>service
            <span class="token key atrule">group-id</span><span class="token punctuation">:</span> DEFAULT_GROUP
            <span class="token key atrule">data-type</span><span class="token punctuation">:</span> json
            <span class="token key atrule">rule-type</span><span class="token punctuation">:</span> flow
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></li> <li><p>nacos配置</p> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161149.png" alt=""></p></li></ol> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;resource&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/rateLime/byUrl&quot;</span><span class="token punctuation">,</span> # 资源名称
        <span class="token property">&quot;limitApp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> # 来源应用
        <span class="token property">&quot;grade&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> # 阈值类型<span class="token punctuation">,</span><span class="token number">0</span>表示线程数<span class="token punctuation">,</span><span class="token number">1</span>表示QPS
        <span class="token property">&quot;count&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> # 单级阈值
        <span class="token property">&quot;strategy&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> # 流控模式<span class="token punctuation">,</span><span class="token number">0</span>表示直接<span class="token punctuation">,</span><span class="token number">1</span>表示关联<span class="token punctuation">,</span><span class="token number">2</span>表示链路
        <span class="token property">&quot;controlBehavior&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> # 流控效果<span class="token punctuation">,</span><span class="token number">1</span>表示Warm Up<span class="token punctuation">,</span><span class="token number">2</span>表示排队等待
        <span class="token property">&quot;clusterModer&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> # 是否集群
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="4"><li>注意事项
<ul><li>重启后多次调用</li></ul></li></ol> <h2 id="_4-springcloud-alibaba-seata-处理分布式事务"><a href="#_4-springcloud-alibaba-seata-处理分布式事务" class="header-anchor">#</a> 4. SpringCloud Alibaba Seata 处理分布式事务</h2> <p><strong>分布式问题：</strong></p> <p>单体应用被拆分成微服务应用，原来的三个模块被拆分成三个独立的应用，分别使用三个独立的数据源，业务操作需要调用三个服务来完成。此时每个服务内部的数据一致性由本地事务来保证，但是全局的数据一致性问题没法保证</p> <h3 id="_1-seate概述-官网"><a href="#_1-seate概述-官网" class="header-anchor">#</a> 1. seate概述 <a href="https://seata.io/zh-cn/" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Seata是一款开源的分布式事务解决方案，致力于在微服务架构下提供高性能和简单易用的分布式事务服务。</p> <h4 id="_1-能干啥"><a href="#_1-能干啥" class="header-anchor">#</a> 1. 能干啥?</h4> <p>分布式事务处理过程的一ID+三组件模型：</p> <table><thead><tr><th><strong>Transaction ID XID</strong></th> <th><strong>全局唯一的事务ID</strong></th></tr></thead> <tbody><tr><td>Transaction Coordinator(TC)</td> <td>==事务协调器==，维护全局事务的运行状态，负责协调并驱动事务的提交或回滚</td></tr> <tr><td>Transaction Manager(TM )</td> <td>==事务管理器,==控制全局事务的边界，负责开启一个全局事务，并最终发起全局提交或全局回滚的决议</td></tr> <tr><td>Resource Manager(RM)</td> <td>==资源管理器==控制分支事务，负责分支注册、状态汇报，并接收事务协调器的指令，驱动分支(本地)事务的提交或回滚</td></tr></tbody></table> <p>处理过程：RM:</p> <ol><li>TM向TC申请开启一个全局事务，全局事务创建成功并生成一个全局唯一的XID</li> <li>XID在微服务调用链路的上下文中传播</li> <li>RM向TC注册分支事务，将其纳入XID对应全局事务的管辖</li> <li>TM向TC发起针对XID的全局提交或回滚决议</li> <li>TC调度XID下管辖的全部分支事务完成提交或回滚</li></ol> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161154.png" alt=""></p> <h4 id="_2-下载"><a href="#_2-下载" class="header-anchor">#</a> 2. <a href="https://seata.io/zh-cn/blog/download.html" target="_blank" rel="noopener noreferrer">下载<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <h4 id="_3-怎么玩"><a href="#_3-怎么玩" class="header-anchor">#</a> 3. 怎么玩</h4> <ul><li><p>以前事务 @Transactional</p></li> <li><p>现在 ==@GlobalTransactional==</p></li></ul> <h4 id="_5-seate配置"><a href="#_5-seate配置" class="header-anchor">#</a> 5. seate配置</h4> <ul><li>自定义事务组名称+事务日志存储模式为db+数据库连接信息</li></ul> <h5 id="_1-file-conf-service模块"><a href="#_1-file-conf-service模块" class="header-anchor">#</a> 1. file.conf service模块</h5> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161200.png" alt=""></p> <ul><li>store模块</li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161205.png" alt=""></p> <ul><li>db</li></ul> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161209.png" alt=""></p> <h5 id="_2-数据控库表"><a href="#_2-数据控库表" class="header-anchor">#</a> 2. 数据控库表</h5> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- the table to store GlobalSession data</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> <span class="token identifier"><span class="token punctuation">`</span>global_table<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>global_table<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>  <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>application_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_service_group<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>timeout<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>begin_time<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">key</span> <span class="token identifier"><span class="token punctuation">`</span>idx_gmt_modified_status<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">key</span> <span class="token identifier"><span class="token punctuation">`</span>idx_transaction_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">-- the table to store BranchSession data</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> <span class="token identifier"><span class="token punctuation">`</span>branch_table<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>branch_table<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>resource_group_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>lock_key<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>branch_type<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>client_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">key</span> <span class="token identifier"><span class="token punctuation">`</span>idx_xid<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">-- the table to store lock data</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> <span class="token identifier"><span class="token punctuation">`</span>lock_table<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token identifier"><span class="token punctuation">`</span>lock_table<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> long <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span> long<span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>pk<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h5 id="_3-register-conf"><a href="#_3-register-conf" class="header-anchor">#</a> 3.  register.conf</h5> <p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161216.bmp" alt=""></p> <h3 id="_2-案例-2"><a href="#_2-案例-2" class="header-anchor">#</a> 2. 案例</h3> <h4 id="_1-依赖-3"><a href="#_1-依赖-3" class="header-anchor">#</a> 1. 依赖</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><img src="https://chggx-typora.oss-cn-beijing.aliyuncs.com/typora/20210223161221.png" alt=""></p></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/03/16, 00:33:38</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/chggx-knowlodge-vuepress/pages/0a5c18/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">SpringCloud.H基础</div></a> <a href="/chggx-knowlodge-vuepress/pages/9e3fdb/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Nginx简介</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/chggx-knowlodge-vuepress/pages/0a5c18/" class="prev">SpringCloud.H基础</a></span> <span class="next"><a href="/chggx-knowlodge-vuepress/pages/9e3fdb/">Nginx简介</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:1348088236@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/ABirdFree" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>晨光向 | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/chggx-knowlodge-vuepress/assets/js/app.4bb66daa.js" defer></script><script src="/chggx-knowlodge-vuepress/assets/js/2.796b80a3.js" defer></script><script src="/chggx-knowlodge-vuepress/assets/js/91.487b1df3.js" defer></script>
  </body>
</html>
